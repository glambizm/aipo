#*
 * Aipo is a groupware program developed by TOWN, Inc.
 * Copyright (C) 2004-2015 TOWN, Inc.
 * http://www.aipo.com
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *#
## ---------------------------------------------------------------------------
#set ($indicator_id = "indicator-list-")
## ---------------------------------------------------------------------------
<div id="auiContentsArea" #if($clientVer && $clientVer == "5") style="margin-bottom:45px" #end><div id="auiContentsAreaInner">
<div id="auiThreeClumns">
<div id="auiThreeClumnsInner">

#AUISummaryDivHeader()
#AUISearchHeader("searchForm_" "searchForm_" "$!jslink.getPortletById($!portlet.ID)" "aimluck.io.postViewPage(this, '$!{portlet.ID}', 'search-${indicator_id}'); return false;")
<input type="hidden" name="template" value="BlogEntryListScreen"/>
#AUISearchInput("q$!{portlet.ID}" "keyword" "$!result.Keyword.toString()" "style='margin-right:5px;'")
#AUIButtonSearch("$l10n.COMMON_SEARCH")
#AUISearchIndicator()
#AUISearchFooter()
#AUISummaryDivFooter()

<div class="auiSummaryMeta clearfix">
#AUIsearchresult($!result.Keyword.toString())
#if ($result.List.size() != 0)
#AUIajaxpageview('BlogEntryListScreen' $result)
#end
</div>

#if($result.List.size() == 0)
#AUIEmptyMessage("icon-book" "$l10n.BLOG_EMPTY_SHORT_MESSAGE")
<div id="messageDivList_$!portlet.ID"></div>
#else
<div id="auiBlogEntries">
#foreach ($record in $result.List)
<div class="entry clearfix">
<div class="avatar">
<a href="$!utils.escapeXML($!jslink.getAction('controls.Maximize',$!portlet.ID).addQueryData('eventSubmit_doBlog_entry_list_user','1').addQueryData('view_uid',${record.OwnerId}).addQueryData('ownerid',${record.OwnerId}).addQueryData('view_month', 'none'))">
#if(${record.hasPhoto()})
<img src="$!utils.escapeXML($jslink.getTemplate("FileuploadFacePhotoScreen").addQueryData("uid", ${record.OwnerId}).addQueryData("t", ${record.PhotoModified}))" alt="${record.OwnerName}" width="50" height="50" />
#else
<img src="themes/default/images/common/icon_user100.png" alt="${record.OwnerName}" width="50" height="50" />
#end
</a>
</div>
<div class="entryBody">
<div class="entryHeader"><p><a href="javascript:void(0);" onclick="aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogDetailScreen").addQueryData("entityid",$record.EntryId))', '$!portlet.ID', aipo.blog.onLoadBlogDetailDialog );"> ${record.TitleHtml}#if($record.CommentsNum > 0)（${record.CommentsNum}）#end</a></p></div>
<div class='entryText'>${record.CompressedNote}</div>
<div class="entryFooter">
<div class="floatRight">${record.TitleDate}｜<a href="javascript: void(0)" onclick="aipo.message.popupProfile(${record.OwnerId},arguments[0])">${record.OwnerName}</a></div>
<a href="javascript:void(0);" class="subCaption" onclick="aipo.viewPage('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("themeid", $!record.ThemaId.toString()))', '$!portlet.ID');">$!record.ThemaNameHtml</a>

</div>
</div>
</div>
#end
</div>
<div id="messageDivList_$!portlet.ID"></div>
#end
<div class="auiSummaryMeta clearfix">
#if ($result.List.size() != 0)
#AUIajaxpageview('BlogEntryListScreen' $result)
#end
</div>
</div>
</div>
<div id="auiThreeColumnWidgets" #if(! $!result.hasBlogOtherAclList())style="display:none" #end>
<div class="auiWidget clearfix mb_hide">
<form class="auiForm">
<select name="groupId" onChange="aipo.viewPage(this.options[this.selectedIndex].value, '$!portlet.ID')" class="wide">
<option value="$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("groupid","LoginUser").addQueryData("target_user_id", "all"))">$l10n.BLOG_GROUP_LIST</option>
#foreach( $record in $!result.MyGroupList )
<option value="$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("groupid","$!{record.Name.toString()}"))" #if($!result.GroupId == $!record.Name.toString()) selected #set($groupName = $!record.Name) #end>$!record.AliasName</option>
#end
#if(($result.MyGroupList.size() > 0) && ($result.PostMap.size() > 0))
<option value="$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("groupid","LoginUser"))">----------</option>
#end
#foreach( $record in $!result.PostMap )
<option value="$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("groupid","$!{record.GroupName.toString()}"))" #if($!result.GroupId == $!record.GroupName.toString()) selected #set($groupName = $!record.GroupName) #end>$!record.PostName</option>
#end
</select>
</form>
<ul class="auiAvatarList">
#foreach($user in $!result.UserList)
<li#if ($!result.OwnerId == $!user.UserId.toString()) class="active"#end><a href="javascript:void(0);" onclick="aipo.viewPage('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("ownerid", $user.UserId))', '$!portlet.ID');">
#if($user.hasPhoto())
<img src="$!utils.escapeXML($jslink.getTemplate("FileuploadFacePhotoScreen").addQueryData("uid", ${user.UserId}).addQueryData("t", ${user.PhotoModified}))" width="32" height="32" alt="${user.AliasName}" />
#else
<img src="themes/default/images/common/icon_user100.png" alt="${user.AliasName}" width="32" height="32" />
#end
${user.AliasName}</a></li>
#end
</ul>
</div>
</div>
#AUIcontentsAreaFooter()
#parse("/portlets/html/blog-widgets.vm")
