dojo._xdResourceLoaded({depends:[["provide","aipo.calendar.weekly"],["require","aimluck.dnd.Draggable"],["require","aipo.widget.ToolTip"],["require","aipo.widget.MemberNormalSelectList"],["require","aipo.widget.GroupNormalSelectList"]],defineResource:function(b){if(!b._hasResource["aipo.calendar.weekly"]){b._hasResource["aipo.calendar.weekly"]=true;b.provide("aipo.calendar.weekly");b.require("aimluck.dnd.Draggable");b.require("aipo.widget.ToolTip");b.require("aipo.widget.MemberNormalSelectList");b.require("aipo.widget.GroupNormalSelectList");aipo.calendar.objectlist=Array();aipo.calendar.maximum_to=30;function a(f,e){return f.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}function c(f,e){if(!this.hasClass(f,e)){f.className+=" "+e}}function d(g,e){if(a(g,e)){var f=new RegExp("(\\s|^)"+e+"(\\s|$)");g.className=g.className.replace(f," ")}}aipo.calendar.changeDisypayPeriod=function(p,m){var g=b.byId("weeklyHeadRights-"+m).children;var j=b.byId("weeklyTermRights-"+m).children;var n=b.byId("weeklyRights-"+m).children;b.byId("view_type_"+m).value=p;var o=b.byId("indicateDate_"+m);for(var l=0;l<7;l++){var f=g[l];var h=n[l];var e=j[l];var q=b.byId("scheduleDivAdd0"+l+"_"+m);switch(p){case"1":if(o){o.innerHTML="<span>1日</span>"}h.className="weeklyRight";if(l==0){f.className="weeklyHeadRightR weeklyHeadRightborder"+l+"_"+m;f.style.width="100%";h.style.width="100%";e.style.width="100%";c(e,"weeklyTermRightR");q.style.width="100%"}else{f.className="weeklyHeadRight weeklyHeadRightborder"+l+"_"+m;f.style.width="0%";f.style.display="none";h.style.width="0%";h.style.display="none";e.style.width="0%";e.style.display="none";d(e,"weeklyTermRightR");q.style.width="0%";q.style.display="none"}break;case"4":if(o){o.innerHTML="<span>4日</span>"}if(l==0){d(e,"weeklyTermRightR")}if(l<=3){f.style.width="25%";f.style.left=l*25+"%";f.style.display="";h.style.width="25%";h.style.left=l*25+"%";h.style.display="";e.style.width="25%";e.style.left=l*25+"%";e.style.display="";q.style.width="25%";q.style.left=l*25+"%";q.style.display="";if(l<3){f.className="weeklyHeadRight weeklyHeadRightborder"+l+"_"+m}else{if(l==3){f.className="weeklyHeadRightR weeklyHeadRightborder"+l+"_"+m;h.className="weeklyRightR";c(e,"weeklyTermRightR")}}}else{f.className="weeklyHeadRight weeklyHeadRightborder"+l+"_"+m;f.style.width="0%";f.style.display="none";h.style.width="0%";h.style.display="none";e.style.width="0%";e.style.display="none";d(e,"weeklyTermRightR");q.style.width="0%";q.style.display="none"}break;case"7":if(o){o.innerHTML="<span>7日</span>"}f.style.left=l*(100/7)+"%";f.style.display="";f.style.width="14.2857%";h.style.left=l*(100/7)+"%";h.style.display="";h.style.width="14.2857%";e.style.left=l*(100/7)+"%";e.style.display="";e.style.width="14.2857%";q.style.left=l*(100/7)+"%";q.style.display="";q.style.width="14.2857%";if(l==0){d(e,"weeklyTermRightR")}if(l<6){f.className="weeklyHeadRight weeklyHeadRightborder"+l+"_"+m;h.className="weeklyRight";d(e,"weeklyTermRightR")}else{f.className="weeklyHeadRightR weeklyHeadRightborder"+l+"_"+m;h.className="weeklyRightR";c(e,"weeklyTermRightR")}}}};aipo.calendar.populateWeeklySchedule=function(j,l){var g;var h=b.byId("member_to-"+j);if(typeof l=="undefined"||typeof ptConfig[j].jsonData=="undefined"){g=""}else{g=l}var f=b.byId("secid-"+j);if(f){g+="&secid="+f.value}if(g.match(/ign_dup_f/)==null){if(h){var m=h.options;to_size=m.length;if(to_size==0){g+="&m_id="+aipo.schedule.login_id;g+="&m_empty=empty";b.byId("calender_m_empty_"+j).style.display=""}else{g+="&m_empty=";b.byId("calender_m_empty_"+j).style.display="none"}for(i=0;i<to_size;i++){m[i].selected=true;g+="&m_id="+m[i].value}}var e=b.byId("showAll-"+j);if(e){g+="&s_all="+e.value}}djConfig.usePlainJson=true;ptConfig[j].reloadFunction=aipo.calendar.populateWeeklySchedule;ptConfig[j].isTooltipEnable=false;if(aipo.calendar.dummyDivObj){aipo.calendar.dummyDivObj.destroy();aipo.calendar.dummyDivObj=null}if(b.byId("groupselect-"+j).value.indexOf("pickup")!=-1){g+="&pickup=true"}if(ptConfig[j].xhrUrl!=ptConfig[j].jsonUrl+g){ptConfig[j].xhrUrl=ptConfig[j].jsonUrl+g;b.xhrGet({portletId:j,url:ptConfig[j].jsonUrl+g,encoding:"utf-8",handleAs:"json-comment-filtered",load:function(W,X){ptConfig[j].xhrUrl="";if(aipo.calendar.reloadMonthlyCalendar!=null){aipo.calendar.reloadMonthlyCalendar()}obj_error=b.byId("error-"+j);b.style(obj_error,"display","none");if("PermissionError"==W[0]){b.style(obj_error,"display","block");obj_error.innerHTML=W[1];obj_content=b.byId("content-"+j);b.style(obj_content,"display","none");obj_indicator=b.byId("indicator-"+j);b.style(obj_indicator,"display","none");return}else{if(W.errList){if("duplicate_facility"==W.errList[0]){if(confirm("既に同じ時間帯に設備が予約されています。スケジュールを登録しますか？")){var z=g+"&ign_dup_f=true";aipo.calendar.populateWeeklySchedule(j,z);aipo.portletReload("schedule",j);return}}if("UpdateError"==W.errList[0]){b.style(obj_error,"display","block");obj_error.innerHTML='<ul><li><span class="caution">'+W.errList[1]+"</span></li></ul>";obj_content=b.byId("content-"+j);b.style(obj_content,"visibility","visible");obj_indicator=b.byId("indicator-"+j);b.style(obj_indicator,"display","none")}}}var T;if(!!aipo.calendar.objectlist){var I=aipo.calendar.objectlist.length;for(T=0;T<I;T++){var p=aipo.calendar.objectlist[T];if(p.portletId==j){p.destroy()}}}if(!aipo.errorTreatment(W,ptConfig[j].thisUrl)){return}ptConfig[j].jsonData=W;var u=Array(ptConfig[j].scheduleDivDaySum);for(var T=0;T<ptConfig[j].scheduleDivDaySum;T++){u[T]=Array()}var R=0;var r=0;var s=0;var J="";var P="";var A="";var C="";var Q=[];var F,E,D,B;var S=W.startDate.substring(0,4)+"年"+parseInt(W.startDate.substring(5,7),10)+"月"+parseInt(W.startDate.substring(8,10),10)+"日"+W.dayOfWeek[0];b.byId("viewWeekly-"+j).innerHTML=S;var K="";var w="";var q=b.byId("top_form_"+this.portletId).value=="simple";var G=b.byId("view_type_"+this.portletId).value=="1";var n=b.byId("view_type_"+this.portletId).value=="4";var O=window.navigator.userAgent.toLowerCase().indexOf("ipad")>=0;if(q&&G){K="width: 100%;";w="width: 0%;display: none;"}A+='<table id="termTable_'+this.portletId+'" style="width:100%;" cellspacing="0" cellpadding="0" border="0"><tbody>';b.query(".weeklyTermTailTd_"+j).style("display","none");var x=b.byId("weeklyScrollPane_"+this.portletId);b.forEach(W.termSchedule,function(Z){var aa="";var ae="";if(q&&(G||n)){aa=' style="display: none;"';s++;for(k=0;k<Z.length;k++){ac=Z[k];if(ac.index==0||(q&&n&&ac.index<4)){aa="";ae=" weeklyTermRightR";s--;break}}}var ac=null;var ab=scheduleTooltipEnable!==true&&q&&G?"border-right:0":"";if(scheduleTooltipEnable!==true&&q&&G){A+="<tr"+aa+'><td colspan="2" nowrap="nowrap" width="100%" height="17px" valign="top"><div class="weeklyTermRights">'}else{A+="<tr"+aa+'><td nowrap="nowrap" width="100%" height="17px" valign="top"><div class="weeklyTermRights">'}if(q&&n){A+='<div class="_weeklyHeadRightborder0_'+j+" weeklyTermRight weeklyTermRightL"+ae+'" id="termDay0-'+r+"-"+j+'" style="width: 25%;left: 0%;'+K+ab+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder1_'+j+' weeklyTermRight" id="termDay1-'+r+"-"+j+'" style="width: 25%;left: 25%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder2_'+j+' weeklyTermRight" id="termDay2-'+r+"-"+j+'" style="width: 25%;left: 50%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder3_'+j+' weeklyTermRight weeklyTermRightR" id="termDay3-'+r+"-"+j+'" style="width: 25%;left: 75%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder4_'+j+' weeklyTermRight" id="termDay4-'+r+"-"+j+'" style="left: 57.1429%;display:none;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder5_'+j+' weeklyTermRight" id="termDay5-'+r+"-"+j+'" style="left: 71.4286%;display:none;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder6_'+j+' weeklyTermRight weeklyTermRightR" id="termDay6-'+r+"-"+j+'" style="left: 85.7143%;display:none;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';C+='<div id="termScheduleItemGarage-'+r+"-"+j+'" class="weeklyTermRights" style="top:'+(-(17*(r-s+1)))+'px"> </div>'}else{A+='<div class="_weeklyHeadRightborder0_'+j+" weeklyTermRight weeklyTermRightL"+ae+'" id="termDay0-'+r+"-"+j+'" style="left: 0%;'+K+ab+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder1_'+j+' weeklyTermRight" id="termDay1-'+r+"-"+j+'" style="left: 14.2857%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder2_'+j+' weeklyTermRight" id="termDay2-'+r+"-"+j+'" style="left: 28.5714%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder3_'+j+' weeklyTermRight" id="termDay3-'+r+"-"+j+'" style="left: 42.8571%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder4_'+j+' weeklyTermRight" id="termDay4-'+r+"-"+j+'" style="left: 57.1429%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder5_'+j+' weeklyTermRight" id="termDay5-'+r+"-"+j+'" style="left: 71.4286%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';A+='<div class="_weeklyHeadRightborder6_'+j+' weeklyTermRight weeklyTermRightR" id="termDay6-'+r+"-"+j+'" style="left: 85.7143%;'+w+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';C+='<div id="termScheduleItemGarage-'+r+"-"+j+'" class="weeklyTermRights" style="top:'+(-(17*(r-s+1)))+'px"> </div>'}var ad;A+="</div></td></tr>";r++});A+="</tbody></table>";var y=(17*(r-s+1));var L=(-(17*(r-s+1)));b.byId("termScheduleGarage-"+j).innerHTML=A;b.byId("termScheduleContainer-"+j).innerHTML=C;b.byId("weeklyTermLeftTopTall-"+j).style.height=(17*(r-s))+"px";for(var T=0;T<ptConfig[j].scheduleDivDaySum;T++){F=b.byId("weeklyDay"+T+"-"+j);E=b.byId("weeklyHoliday"+T+"-"+j);D=b.byId("weeklyRight"+T+"-"+j);B=b.byId("termDay"+T+"-"+j);var v=b.byId("weeklyDay"+T+"_element_a-"+j);v.innerHTML=parseInt(W.date[T].substring(8,10),10)+W.dayOfWeek[T];if(location.href.toString().toLowerCase().indexOf((j+"?action=controls.Maximize").toLowerCase())>0){v.outerHTML=v.outerHTML.toString().split(/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/).join(W.date[T].substring(0,10)).split("ScheduleScreen").join("ScheduleListScreen")}else{v.outerHTML=v.outerHTML.toString().split(/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/).join(W.date[T].substring(0,10))}E.innerHTML=W.holiday[T];var N=W.today+"-00-00";if(W.dayOfWeek[T]=="(土)"){b.addClass(F,"saturday");b.addClass(E,"saturday");b.addClass(D,"saturday");b.addClass(B,"saturday")}else{b.removeClass(F,"saturday");b.removeClass(E,"saturday");b.removeClass(D,"saturday");b.removeClass(B,"saturday")}if(W.dayOfWeek[T]=="(日)"){b.addClass(F,"sunday");b.addClass(E,"sunday");b.addClass(D,"sunday");b.addClass(B,"sunday")}else{b.removeClass(F,"sunday");b.removeClass(E,"sunday");b.removeClass(D,"sunday");b.removeClass(B,"sunday")}if(W.holiday[T]){b.addClass(F,"holiday");b.addClass(E,"holiday");b.addClass(D,"holiday");b.addClass(B,"holiday")}else{b.removeClass(F,"holiday");b.removeClass(E,"holiday");b.removeClass(D,"holiday");b.removeClass(B,"holiday")}if(N==W.date[T]){b.addClass(F,"today");b.addClass(E,"today");b.addClass(D,"today");b.addClass(B,"today")}else{b.removeClass(F,"today");b.removeClass(E,"today");b.removeClass(D,"today");b.removeClass(B,"today")}}b.forEach(W.schedule,function(an){var Z=ptConfig[j].rowHeight;var ak=an.startDateHour*Z*2+an.startDateMinute*Z/30;var am=an.endDateHour*Z*2+an.endDateMinute*Z/30-ak;if(am<=Z){Q[R]=am;am=Z}else{Q[R]=-1}var ae=100/ptConfig[j].scheduleDivDaySum*an.index;var ac=100/ptConfig[j].scheduleDivDaySum*0.99;var aa=an.name;var ad=Q[R]==-1?((an.startDateHour>9)?an.startDate:"0"+an.startDate):an.name;var ai=Q[R]==-1?((an.endDateHour>9)?an.endDate:"0"+an.endDate):"";var ah=Q[R]==-1?"-":"";var aj=an.scheduleId;var al="0";var af="";var ab=b.byId("member_to-"+j);if(ab){var ag=ab.options;for(T=0;T<ag.length;T++){if(((an.type=="U")&&(an.ownerId==ag[T].value))||((an.type=="F")&&(an.ownerId==ag[T].value))){al=T%aipo.calendar.maximum_to}}var af;if(an.userCount>1){af="[共有]"}if(an.facilityCount>0){af+="[設備]"}}if(!an["public"]){aa='<i class="auiIcon auiIconSecret" title="非公開"></i>\n'+aa}aa+='\n<span class="inline-block">\n';if(an.duplicate){aa+='<i class="auiIcon auiIconOverlap" title="重複スケジュール"></i>\n'}if(an.repeat){aa+='<i class="auiIcon auiIconRepeat" title="繰り返し"></i>\n'}if(an.tmpreserve){aa+='<i class="auiIcon auiIconTmpreserve" title="仮スケジュール"></i>\n'}aa+="</span>";J+='<div id="schedule-'+R+"-"+j+'" class="scheduleDiv color'+al+'" style="top: '+ak+"px; left: "+ae+"%; height: "+(am-1)+"px; width: "+ac+'%;z-index: 0; visibility: hidden; border-right-style:none;"><div class="scheduleDivFirstLine color'+al+'"><span id="scheduleDivStartTime-'+R+"-"+j+'" class="scheduleDivTime color'+al+'">'+af+ad+'</span><span id="scheduleDivSepalater-'+R+"-"+j+'"  class="scheduleDivSepalater color'+al+'">'+ah+'</span><span id="scheduleDivEndTime-'+R+"-"+j+'" class="scheduleDivTime color'+al+'">'+ai+'</span></div><div class="scheduleDivRightLine color'+al+'"></div><div style="overflow: hidden;" class="scheduleDivName color'+al+'">'+aa+'</div><div class="scheduleDivLastLine color'+al+'"><div class="scheduleDivRightLine color'+al+'"></div><center><div class="handleDiv color'+al+'" align="center">&nbsp;</div></center></div></div>';R++});J+='<div id="dummy_div_'+j+'" class="scheduleDivAdd dummy_div" style=" position:absolute; width: 0px; height : 0px; left: 0px; top: -10000px; Filter: Alpha(Opacity=10);opacity:.10; background-color:#FFFFFF; ">&nbsp;</div>';b.byId("scheduleGarage-"+j).innerHTML=J;var M=null;var U,o;var H=[];R=0;b.forEach(W.schedule,function(aa){U=b.byId("schedule-"+R+"-"+j);var Z=aa.scheduleId;M=new aipo.calendar.WeeklyScheduleDraggable(U,{pid:j,sid:'"schedule-'+R+"-"+j+'"',handle:'"dummy_div_-'+j+'"'});aipo.calendar.objectlist.push(M);if(aa.member||aa.loginuser||aa.owner||aa["public"]){M.setDraggable(true)}else{M.setDraggable(false)}M.schedule=aa;M.tmpIndex=aa.index;M.count=R;M.tmpHeight=Q[R];M.position=0;M.division=1;M.portletId=j;u[aa.index].push(U);if(aa["public"]||aa.member){b.connect(U,"onclick",M,"onScheduleClick");b.connect(U,"onmouseover",M,"onScheduleOver")}R++});for(var T=0;T<ptConfig[j].scheduleDivDaySum;T++){aipo.calendar.relocation(j,u[T].length,u[T],100/ptConfig[j].scheduleDivDaySum*T);u[T]=Array()}R=0;r=0;b.forEach(W.termSchedule,function(ai){var am=null;var ab=W.today+"-00-00";P="";for(var ah=0;ah<ptConfig[j].scheduleDivDaySum;ah++){tmpNode5=b.byId("termDay"+ah+"-"+r+"-"+j);if(W.dayOfWeek[ah]=="(土)"){b.addClass(tmpNode5,"saturday")}else{b.removeClass(tmpNode5,"saturday")}if(W.dayOfWeek[ah]=="(日)"){b.addClass(tmpNode5,"sunday")}else{b.removeClass(tmpNode5,"sunday")}if(W.holiday[ah]){b.addClass(tmpNode5,"holiday")}else{b.removeClass(tmpNode5,"holiday")}if(ab==W.date[ah]){b.addClass(tmpNode5,"today")}else{b.removeClass(tmpNode5,"today")}}for(k=0;k<ai.length;k++){am=ai[k];if(q&&n){var ak=am.rowspan;if(am.rowspan+am.index>4){ak=ak-(am.rowspan+am.index-4)}var ac=25*ak;var ae=25*am.index;if(am.index>4){ac=0}}else{var ac=100/ptConfig[j].scheduleDivDaySum*am.rowspan;var ae=100/ptConfig[j].scheduleDivDaySum*am.index}var ad="";if(q&&G){ac=100;ad=((am.index==0)?"":"display: none;")}var Z=am.name;var aj=am.scheduleId;var al="0";var af="";var aa=b.byId("member_to-"+j);if(aa){var ag=aa.options;for(ah=0;ah<ag.length;ah++){if(((am.type=="U")&&(am.ownerId==ag[ah].value))||((am.type=="F")&&(am.ownerId==ag[ah].value))){al=ah%aipo.calendar.maximum_to}}var af;if(am.userCount>1){af="[共有]"}if(am.facilityCount>0){af+="[設備]"}}Z=af+Z;if(!am["public"]){Z='<i class="auiIcon auiIconSecret" title="非公開"></i>\n'+Z}Z+='\n<span class="inline-block">\n';if(am.duplicate){Z+='<i class="auiIcon auiIconOverlap" title="重複スケジュール"></i>\n'}if(am.repeat){Z+='<i class="auiIcon auiIconRepeat" title="繰り返し"></i>\n'}if(am.tmpreserve){Z+='<i class="auiIcon auiIconTmpreserve" title="仮スケジュール"></i>\n'}Z+="</span>";if(ac==100){ac="99.99999"}P+='<div id="termSchedule-'+R+"-"+j+'" class="termScheduleDiv termColor'+al+'" style="left: '+ae+"%; width: "+ac+"%;"+ad+'"><div class="termScheduleDivHandleLeft" id="termScheduleDivHandleLeft-'+R+"-"+j+'">&nbsp;</div><div class="termScheduleDivNameDiv">'+Z+'</div><div class="termScheduleDivHandleRight" id="termScheduleDivHandleRight-'+R+"-"+j+'">&nbsp;</div></div>';R++}b.byId("termScheduleItemGarage-"+r+"-"+j).innerHTML=P;r++});tableLeft=b.byId("weeklyTermLeft_"+j);M=null;R=0;r=0;b.forEach(W.termSchedule,function(Z){var ab=null;for(k=0;k<Z.length;k++){ab=Z[k];var aa=ab.scheduleId;U=b.byId("termSchedule-"+R+"-"+j);o=b.byId("termScheduleDivHandleLeft-"+R+"-"+j);draggable3=b.byId("termScheduleDivHandleRight-"+R+"-"+j);M=new aipo.calendar.WeeklyTermScheduleDraggable(U,{pid:j,sid:"termSchedule-"+R+"-"+j});aipo.calendar.objectlist.push(M);M.schedule=ab;M.scheduleNode=U;M.portletId=j;M.termType="center";b.connect(U,"onclick",M,"onScheduleClick");U.style.zIndex=1;if(ab.indexReal>=0){tmpDraggable2=new aipo.calendar.WeeklyTermScheduleDraggable(o,{pid:j,sid:"termScheduleDivHandleLeft-"+R+"-"+j});aipo.calendar.objectlist.push(tmpDraggable2);tmpDraggable2.schedule=ab;tmpDraggable2.scheduleNode=U;tmpDraggable2.portletId=j;tmpDraggable2.termType="left";if(ab.member||ab.loginuser||ab.owner||ab["public"]){tmpDraggable2.setDraggable(true)}else{tmpDraggable2.setDraggable(false)}}else{b.style(o,"cursor","pointer");o.style.zIndex=1}b.connect(o,"onclick",M,"onScheduleClick");if(ab.indexReal+ab.colspanReal<=ptConfig[j].scheduleDivDaySum){tmpDraggable3=new aipo.calendar.WeeklyTermScheduleDraggable(draggable3,{pid:j,sid:"termScheduleDivHandleRight-"+R+"-"+j});aipo.calendar.objectlist.push(tmpDraggable3);tmpDraggable3.schedule=ab;tmpDraggable3.scheduleNode=U;tmpDraggable3.portletId=j;tmpDraggable3.termType="right";if(ab.member||ab.loginuser||ab.owner||ab["public"]){tmpDraggable3.setDraggable(true)}else{tmpDraggable3.setDraggable(false)}}else{b.style(draggable3,"cursor","pointer");draggable3.style.zIndex=1}if(ab.member||ab.loginuser||ab.owner||ab["public"]){b.connect(draggable3,"onclick",M,"onScheduleClick");b.connect(U,"onmouseover",M,"onScheduleOver")}if(ab.member||ab.loginuser||ab.owner||ab["public"]){M.setDraggable(true)}else{M.setDraggable(false)}R++}r++});obj_content=b.byId("content-"+j);b.style(obj_content,"visibility","visible");obj_indicator=b.byId("indicator-"+j);b.style(obj_indicator,"display","none");b.removeClass(b.byId("tableWrapper_"+j),"hide");var x=b.byId("weeklyScrollPane_"+j);if((x.clientWidth==x.offsetWidth)&&!(O&&!q)){if(b.byId("weeklySpan-"+j)!=null){b.byId("weeklySpan-"+j).style.display="none"}b.query(".weeklyTermTailTd_"+j).style("display","none");if(b.byId("termTable_"+j)!=null){b.query("termTable_"+j).style("width","99.9999%")}if(q&&G){b.query(".weeklyHeadRightborder0_"+j).style("border-right-style","none");b.query("._weeklyHeadRightborder0_"+j).style("border-right-style","none");b.byId("weeklyRight0-"+j).style.borderRightStyle="";if(O){if(b.byId("weeklyRight0-"+j).className.indexOf("sunday")>=0||b.byId("weeklyRight0-"+j).className.indexOf("saturday")>=0){b.query(".scroll_width").style("padding-right","1px")}else{b.query(".scroll_width").style("padding-right","0px")}b.query(".weeklyTableHead").style("padding-right","1px")}else{b.query(".weeklyTableHead").style("padding-right","1px")}}else{if(q&&n){if(O){b.query(".weeklyTableHead").style("padding-right","0px");b.query(".scroll_width").style("padding-right","0px")}else{b.byId("weeklyRight3-"+j).style.borderRightStyle="none";b.query(".weeklyHeadRightborder3_"+j).style("border-right-style","none");b.query("._weeklyHeadRightborder3_"+j).style("border-right-style","none");b.query(".weeklyTableHead").style("padding-right","1px")}}else{if(O){b.query(".scroll_width").style("padding-right","0px");b.query(".weeklyTableHead").style("padding-right","0px")}else{if(window.navigator.userAgent.toLowerCase().indexOf("chrome")>=0&&(b.byId("weeklyRight6-"+j).className.indexOf("sunday")>=0||b.byId("weeklyRight6-"+j).className.indexOf("saturday"))>=0){b.query(".scroll_width").style("padding-right","1px");b.query(".weeklyTableHead").style("padding-right","1px")}else{b.query(".scroll_width").style("padding-right","0px");b.query(".weeklyTableHead").style("padding-right","0px")}b.byId("weeklyRight6-"+j).style.borderRightStyle="none";b.query(".weeklyHeadRightborder6_"+j).style("border-right-style","none");b.query("._weeklyHeadRightborder6_"+j).style("border-right-style","none")}}}}else{if(x.clientWidth!=x.offsetWidth&&x.offsetWidth-x.clientWidth!=18){if(b.byId("weeklySpan-"+j)!=null){b.byId("weeklySpan-"+j).width=(x.offsetWidth-x.clientWidth+1)+"px"}b.query(".weeklyTermTailTd_"+j).width=(x.offsetWidth-x.clientWidth+1)+"px";b.query(".weeklyTermTail").style("width",((x.offsetWidth-x.clientWidth+1)+"px"))}}if(r==0){b.byId("termScheduleContainer-"+j).style.height="0px"}else{}b.byId("weeklyTableHead_"+j).style.marginTop="0px";var Y=b.byId("weeklyTableHead_"+j).offsetHeight;var V=b.byId("weeklyTermTr_"+j).offsetHeight;Y+=0;Y-=V;V-=V%17;Y+=V;b.byId("weeklyTableHeadWrapper_"+j).style.overflow="hidden";b.byId("weeklyTableHeadWrapper_"+j).style.height=Y+"px";if(r>0){var t=0;for(t=0;t<7;t++){if(b.byId("termDay"+t+"-"+(r-1)+"-"+j).className.indexOf("sunday")>=0||b.byId("termDay"+t+"-"+(r-1)+"-"+j).className.indexOf("saturday")>=0){b.byId("termDay"+t+"-"+(r-1)+"-"+j).style.height="95%"}}}if(!ptConfig[j].isScroll){b.byId("weeklyScrollPane_"+j).scrollTop=ptConfig[j].contentScrollTop;ptConfig[j].isScroll=true}ptConfig[j].isTooltipEnable=true;b.byId("termScheduleDivAdd_"+j).style.height=y+"px";b.byId("termScheduleDivAdd_"+j).style.top=L+"px";b.query(".weeklyTermTailTd_"+j).style("display","")}})}};aipo.calendar.relocation=function(f,e,z,A){var v,u;var y=0.99;var q=100/7;var x=0;var p=0;var n=0;var m=0;var o=new Array(e);var g=new Array(e);var w=new Array(e);var r=1;var s=0;if(b.byId("view_type_"+f).value=="1"&&b.byId("top_form_"+f).value=="simple"){r=7.2}else{if(b.byId("view_type_"+f).value=="4"){r=1.75;if(A>57){A=100}}}z.sort(aipo.calendar.sortByRegion);for(v=0;v<e;v++){z[v].style.zIndex=v+1}for(v=0;v<e;v=x){x=aipo.calendar.overlapSchedule(z,v,v,++x,e);if(n<parseInt(b.getComputedStyle(z[v]).top)){m=v;n=parseInt(b.getComputedStyle(z[m]).top);p=0}for(u=m;u<x;u++){var l=parseInt(b.getComputedStyle(z[u]).top)+parseInt(b.getComputedStyle(z[u]).height)}if(n<l){n=l}for(u=m;u<x;u++){g[u]=aipo.calendar.positionLeft(z,g,m,u,0);if(g[u]>p){p=g[u]}}for(u=m;u<x;u++){w[u]=aipo.calendar.positionRight(z,g,p,m,u)}for(u=m;u<x;u++){o[u]=p}}for(v=0;v<e;v++){var t;var h;if(o[v]!=0){if(g[v]<g[v+1]){t=(q*2/(o[v]+1))*0.8*y*r}else{if(w[v]==0){t=(q-(q/(o[v]+1))*g[v])*y*r}else{t=(q-(q/(o[v]+1))*g[v]-(q*2/(o[v]+1))*0.2-(q/(o[v]+1))*(w[v]-1))*y*r}}}else{t=q*y*r}h=(A+((q/(o[v]+1))*g[v]))*r;if(h+t>100){t=100-h;if(t<0){t=0}}b.style(z[v],"width",t+"%");b.style(z[v],"left",h+"%");b.style(z[v],"visibility","visible")}};aipo.calendar.overlapSchedule=function(h,f,n,m,g){var l=parseInt(b.getComputedStyle(h[f]).top)+parseInt(b.getComputedStyle(h[f]).height);var j=parseInt(b.getComputedStyle(h[n]).top)+parseInt(b.getComputedStyle(h[n]).height);var e;if(h[m]){e=parseInt(b.getComputedStyle(h[m]).top)}else{e="NaN"}if((m>g-1)||(l<e)||(j<e)){return m}else{m=aipo.calendar.overlapSchedule(h,f,m,++m,g)}m=aipo.calendar.overlapSchedule(h,f,n,m,g);return m};aipo.calendar.positionLeft=function(l,j,n,m,f){var e=parseInt(b.getComputedStyle(l[m]).top);for(i=n;i<m;i++){var h=parseInt(b.getComputedStyle(l[i]).top);var g=h+parseInt(b.getComputedStyle(l[i]).height);if((h<=e)&&(g>e)&&(j[i]==f)){f=aipo.calendar.positionLeft(l,j,n,m,++f)}}return f};aipo.calendar.positionRight=function(e,j,m,h,n){var l=0;var g=parseInt(b.getComputedStyle(e[n]).top);for(i=h;i<n;i++){var f=parseInt(b.getComputedStyle(e[i]).top);var o=f+parseInt(b.getComputedStyle(e[i]).height);if((f<=g)&&(o>g)&&(j[i]>j[n])&&((m-j[i]+1)>l)){l=m-j[i]+1}}return l};aipo.calendar.sortByRegion=function(g,f){var l=parseInt(b.getComputedStyle(g).top);var j=parseInt(b.getComputedStyle(f).top);var e=l+parseInt(b.getComputedStyle(g).height);var h=e+parseInt(b.getComputedStyle(f).height);if(l==j){return h-e}else{return l-j}};aipo.calendar.getDate=function(e,f){tmpYear=parseInt(e.substring(0,4),10);tmpMonth=parseInt(e.substring(5,7),10);tmpDay=parseInt(e.substring(8,10),10);if(f>0){do{tmpMonthDays=aipo.calendar.getDay(tmpYear,tmpMonth);if(tmpDay+f<=tmpMonthDays){tmpDay=tmpDay+f;if((tmpMonth<10)&&(tmpDay<10)){date=tmpYear+"-0"+tmpMonth+"-0"+tmpDay}else{if((tmpMonth<10)&&!(tmpDay<10)){date=tmpYear+"-0"+tmpMonth+"-"+tmpDay}else{if(!(tmpMonth<10)&&(tmpDay<10)){date=tmpYear+"-"+tmpMonth+"-0"+tmpDay}else{date=tmpYear+"-"+tmpMonth+"-"+tmpDay}}}f=-1}else{f=f-(tmpMonthDays-tmpDay)-1;if(tmpMonth==12){tmpYear++;tmpMonth=1}else{tmpMonth++}tmpDay=1}}while(f>=0)}else{if(f<0){do{if(tmpDay+f>0){tmpDay=tmpDay+f;if((tmpMonth<10)&&(tmpDay<10)){date=tmpYear+"-0"+tmpMonth+"-0"+tmpDay}else{if((tmpMonth<10)&&!(tmpDay<10)){date=tmpYear+"-0"+tmpMonth+"-"+tmpDay}else{if(!(tmpMonth<10)&&(tmpDay<10)){date=tmpYear+"-"+tmpMonth+"-0"+tmpDay}else{date=tmpYear+"-"+tmpMonth+"-"+tmpDay}}}f=1}else{if(tmpMonth==1){tmpYear--;tmpMonth=12}else{tmpMonth--}tmpMonthDays=aipo.calendar.getDay(tmpYear,tmpMonth);f=f+tmpDay;tmpDay=tmpMonthDays}}while(f<=0)}else{date=e}}return date};aipo.calendar.getDay=function(e,f){if(f==2){if(!(e%4)&&((e%100)||!(e%400))){return 29}else{return 28}}else{if(f==4||f==6||f==9||f==11){return 30}else{return 31}}};aipo.calendar.setGridArray=function(g,f){var e=0;if(aipo.calendar.gridArray){delete (aipo.calendar.gridArray)}aipo.calendar.gridArray=new Array(f);for(i=0;i<f;i++){e=b._abs(b.byId("weeklyDay"+i+"-"+g),true).x;aipo.calendar.gridArray[i]=e}};aipo.calendar.getCurrentMouseX=function(j,l){if(aipo.calendar.gridArray==null){return{index:-1,x:0}}var g=aipo.calendar.gridArray[0];var n=0;var h;if(l.pageX>g){var f=parseInt(aipo.calendar.gridArray.length)-1;if(b.byId("view_type_"+j)&&b.byId("top_form_"+j).value=="simple"){f=parseInt(b.byId("view_type_"+j).value)-1}for(h=f;h>-1;h--){if(l.pageX>aipo.calendar.gridArray[h]){n=h;break}}}else{n=0}var m=aipo.calendar.gridArray[n]-g;return{index:n,x:m}};aipo.calendar.onCloseMemberpicker=function(e){aipo.calendar.populateWeeklySchedule(e)};aipo.calendar.showTooltip=function(h,l,e){var j="";var f="";var g="";var n="";var m=function(p){var o=function(q){switch(q){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&#39;";case'"':return"&quot;"}return"?"};return String(p).replace(/[<>&"']/g,o)};b.style(e,"display","block");if(ptConfig[l].xhrUrl!=h){ptConfig[l].xhrUrl=h;b.xhrGet({portletId:l,url:h,encoding:"utf-8",handleAs:"json-comment-filtered",load:function(t,r){ptConfig[l].xhrUrl="";if(!t.id){b.style(e,"display","none");return}if(!t.isSpan){j='<span style="font-size: 0.90em;">'+t.date+"</span><br/>"}if(t.memberList){var q=t.memberList.length;for(var o=0;o<q;o++){f+="<li>"+m(t.memberList[o].aliasName.value)+"</li>"}}if(t.facilityList){var p=t.facilityList.length;for(var o=0;o<p;o++){g+="<li>"+m(t.facilityList[o].facilityName.value)+"</li>"}}if(t.place!=""){n='<span style="font-size: 0.90em;">場所</span><br/><ul><li>'+t.place+"</li></ul>"}if(f!=""){f='<span style="font-size: 0.90em;">参加者</span><br/><ul>'+f+"</ul>"}if(g!=""){g='<span style="font-size: 0.90em;">設備</span><br/><ul>'+g+"</ul>"}var s="<h4>"+t.name+"</h4>"+j+f+g+n;e.innerHTML=s}})}};b.declare("aipo.calendar.DummyDivObject",null,{portletId:null,parentnode:null,draggable:null,TooltipObject:null,constructor:function(e,f){this.portletId=f.pid;this.parentnode=f.node;this.node=b.byId(e);this.events=[b.connect(this.node,"onmousedown",this,"onMouseDown"),b.connect(this.node,"onmouseover",this,"onMouseOver")]},onMouseDown:function(f){this.hide();if(this.parentnode==null||this.parentnode=="undefined"){return}if(this.draggable){this.draggable.onMouseDown(f)}},onMouseOver:function(f){if(this.parentnode==null||this.parentnode=="undefined"){return}},destroy:function(){b.forEach(this.events,b.disconnect);this.events=this.node=this.handle=null},hide:function(){b.marginBox(this.node,{l:0,t:-10000,w:0,h:0})}});b.declare("aipo.calendar.WeeklyScheduleDragMoveObject",[aimluck.dnd.DragMoveObject],{_rowHeight_:18,isResize:false,distance:3,lastScroll:0,onFirstMove:function(g){if(this.dragSource.TooltipObject!=null){this.dragSource.TooltipObject.uninitialize()}var j=b.clone(this.node);j.id="schedule-dummy-"+this.portletId;j.style.zIndex=998;b.style(j,"opacity",0);var h=b.byId("scheduleGarage-"+this.portletId);h.appendChild(j);this.tmpDraggable=j;b.connect(this.node,"onmousedown",this,"onMouseDown");if(b.isIE<=8&&b.isIE>0){document.onkeydown=function(l){b.style(j,"opacity",0.3)};document.onkeyup=function(l){b.style(j,"opacity",0)}}else{b.connect(null,"onkeydown",this,"onKeyPress");b.connect(null,"onkeyup",this,"onKeyPress")}aimluck.dnd.DragMoveObject.prototype.onFirstMove.apply(this,arguments);b.style(this.node,"opacity",0.5);this.node.style.zIndex=999;this.startY=this._pageY;this.startAbsoluteY=b._abs(b.byId(this.node),true).y;var f=window.navigator.userAgent.toLowerCase();if(f.indexOf("chrome")>-1||(b.isFF&&(b.isFF>=3.6))){this.startAbsoluteY+=window.scrollY}else{if(f.indexOf("safari")>-1){this.startAbsoluteY-=b.byId("weeklyScrollPane_"+this.portletId).scrollTop}}this.startHeight=parseInt(b.getComputedStyle(this.node).height);this.startTop=parseInt(b.getComputedStyle(this.node).top);if(this.startHeight-6<this.startY-this.startAbsoluteY){this.isResize=true}aipo.calendar.setGridArray(this.portletId,parseInt(ptConfig[this.portletId].scheduleDivDaySum));lastScroll=b.byId("weeklyScrollPane_"+this.portletId).scrollTop},onKeyPress:function(f){if(f.ctrlKey){b.style(this.tmpDraggable,"opacity",0.3)}else{b.style(this.tmpDraggable,"opacity",0)}},onMouseMove:function(o){if(this.dragSource.isDraggable==false){return}aimluck.dnd.DragMoveObject.prototype.onMouseMove.apply(this,arguments);this.dragSource.schedule.isDrag=true;if(this.dragSource.tmpHeight>3){b.style(this.node,"height",this.dragSource.tmpHeight+"px");this.dragSource.tmpHeight=3}var f=ptConfig[this.portletId].distance;var h=b.byId("weeklyScrollPane_"+this.portletId).scrollTop-lastScroll;this.leftTop.t=Math.floor((this.leftTop.t+h)/f)*f;if(this.isResize){if(-this.startTop+this.leftTop.t+this.startHeight<0){b.style(this.node,"height","0px");this.leftTop.t+=this.startHeight}else{var q;if(this.leftTop.t+this.startHeight>864){q=864-this.startTop-3}else{q=-this.startTop+this.leftTop.t+this.startHeight}this.leftTop.t=this.startTop;this.leftTop.h=parseInt(q)-1}}else{if(!this.disableY){if(this.leftTop.t<0){this.leftTop.t=0}if(this.leftTop.t+this.startHeight>864){this.leftTop.t=864-this.startHeight-6}}}if(!this.disableX){mouseX=aipo.calendar.getCurrentMouseX(this.portletId,o);this.leftTop.l=mouseX.x;this.dragSource.schedule.index=mouseX.index}b.marginBox(this.node,this.leftTop);var p=parseInt(b.getComputedStyle(this.node).top);var n=parseInt(b.getComputedStyle(this.node).height)+1;var m=p/f;var l=Math.floor(m/12);var j=Math.floor(m%12);l=(l>9)?l:"0"+l;j=(j>1)?j*(60/12):"0"+j*(60/12);var g=this.dragSource.count;b.byId("scheduleDivStartTime-"+g+"-"+this.portletId).innerHTML=l+":"+j;this.dragSource.schedule.startDateHour=l;this.dragSource.schedule.startDateMinute=j;this.dragSource.schedule.startDate=l+":"+j;m+=n/f;l=Math.floor(m/12);j=Math.floor(m%12);l=(l>9)?l:"0"+l;j=(j>1)?j*(60/12):"0"+j*(60/12);b.byId("scheduleDivEndTime-"+g+"-"+this.portletId).innerHTML=l+":"+j;this.dragSource.schedule.endDateHour=l;this.dragSource.schedule.endDateMinute=j;this.dragSource.schedule.endDate=l+":"+j;b.byId("scheduleDivSepalater-"+g+"-"+this.portletId).innerHTML="-";return},onMouseUp:function(g){ptConfig[this.portletId].isTooltipEnable=true;if(b.isIE<=8&&b.isIE>0){document.onkeydown="";document.onkeyup=""}if(this.dragSource.schedule.isDrag!=true){b.style(this.node,"opacity",1);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments);return}var f=parseInt(b.getComputedStyle(this.node).height);if(f<ptConfig[this.portletId].rowHeight){b.style(this.node,"height",ptConfig[this.portletId].rowHeight+"px");this.dragSource.tmpHeight=f}else{this.dragSource.tmpHeight=-1}var h="";if(g.ctrlKey){h+="&mode=insert"}else{h+="&mode=update"}h+="&entityid="+this.dragSource.schedule.scheduleId;h+="&view_start="+ptConfig[this.portletId].jsonData.date[0].substring(0,10);if(this.dragSource.schedule.repeat){h+="&edit_repeat_flag=1";h+="&view_date="+ptConfig[this.portletId].jsonData.date[this.dragSource.tmpIndex].substring(0,10)}h+="&start_date="+ptConfig[this.portletId].jsonData.date[this.dragSource.schedule.index].substring(0,11)+this.dragSource.schedule.startDateHour+"-"+this.dragSource.schedule.startDateMinute;h+="&end_date="+ptConfig[this.portletId].jsonData.date[this.dragSource.schedule.index].substring(0,11)+this.dragSource.schedule.endDateHour+"-"+this.dragSource.schedule.endDateMinute;aipo.calendar.populateWeeklySchedule(this.portletId,h);aipo.portletReload("schedule",this.portletId);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments);this.dragSource.destroy()}});b.declare("aipo.calendar.WeeklyScheduleDraggable",[aimluck.dnd.Draggable],{DragMoveObject:aipo.calendar.WeeklyScheduleDragMoveObject,isDraggable:false,scheduleObjId:null,constructor:function(e,f){this.scheduleObjId=f.sid},onMouseDown:function(f){ptConfig[this.portletId].isTooltipEnable=false;if(!!aipo.calendar.dummyDivObj&&!!aipo.calendar.dummyDivObj.TooltipObject){aipo.calendar.dummyDivObj.TooltipObject.close()}aimluck.dnd.Draggable.prototype.onMouseDown.apply(this,arguments)},onScheduleClick:function(g){if(this.schedule.isDrag||!this.isDraggable){return}var f=this.schedule.ownerId;aipo.common.showDialog(ptConfig[this.portletId].detailUrl+"&entityId="+this.schedule.scheduleId+"&view_date="+ptConfig[this.portletId].jsonData.date[this.schedule.index]+"&userid="+f,this.portletId,aipo.schedule.onLoadScheduleDetail);aipo.schedule.tmpScroll=parseInt(b.byId("weeklyScrollPane_"+this.portletId)["scrollTop"])},onScheduleOver:function(f){if(ptConfig[this.portletId].isTooltipEnable==false){return}if(scheduleTooltipEnable){this.setupTooltip(f)}},setupTooltip:function(h){var f=this.schedule.scheduleId;var g=ptConfig[this.portletId].jsonData.endDate;if(!this.TooltipObject){this.TooltipObject=new aipo.widget.ToolTip({label:"<div class='indicator'>読み込み中...</div>",connectId:[this.node.id]},this.portletId,function(e,l){var j=ptConfig[this.portletId].jsonUrl.split("?")[0]+"?template=ScheduleDetailJSONScreen&view_date="+g+"&scheduleid="+f;aipo.calendar.showTooltip(j,this.portletId,e)});this.TooltipObject._onHover(h)}aipo.calendar.objectlist.push(this.TooltipObject)},setDraggable:function(e){this.isDraggable=e}});b.declare("aipo.calendar.WeeklyTermScheduleDragMoveObject",[aimluck.dnd.DragMoveObject],{positionFrom:-1,positionTo:-1,moveIndex:0,onFirstMove:function(f){if(this.dragSource.TooltipObject!=null){this.dragSource.TooltipObject.uninitialize()}aimluck.dnd.DragMoveObject.prototype.onFirstMove.apply(this,arguments);b.style(this.node,"opacity",0.5);aipo.calendar.setGridArray(this.portletId,parseInt(ptConfig[this.portletId].scheduleDivDaySum));var h=b.clone(this.node);h.id="schedule-dummy-"+this.portletId;h.style.zIndex=998;b.style(h,"opacity",0);var g=b.byId(this.node.parentNode.id);g.appendChild(h);this.tmpDraggable=h;if(b.isIE<=8&&b.isIE>0){document.onkeydown=function(j){b.style(h,"opacity",0.3)};document.onkeyup=function(j){b.style(h,"opacity",0)}}else{b.connect(null,"onkeydown",this,"onKeyPress");b.connect(null,"onkeyup",this,"onKeyPress")}},onKeyPress:function(f){if(f.ctrlKey){b.style(this.tmpDraggable,"opacity",0.3)}else{b.style(this.tmpDraggable,"opacity",0)}},onMouseMove:function(n){if(this.dragSource.isDraggable==false){return}aimluck.dnd.DragMoveObject.prototype.onMouseMove.apply(this,arguments);this.dragSource.schedule.isDrag=true;var f=ptConfig[this.portletId].distance;var s=(b.byId("view_type_"+this.portletId)&&b.byId("top_form_"+this.portletId)&&b.byId("top_form_"+this.portletId).value=="simple")?b.byId("view_type_"+this.portletId).value:ptConfig[this.portletId].scheduleDivDaySum;var m=aipo.calendar.getCurrentMouseX(this.portletId,n);_tmpIndex=m.index;if(!this.disableX){var j=this.dragSource.schedule;var o=this.dragSource.termType;var q=this.dragSource.scheduleNode;var p,h;if(o=="center"){if(this.positionFrom==-1&&_tmpIndex!=-1){this.positionFrom=_tmpIndex;this.positionTo=this.positionFrom}if(this.positionTo!=-1&&_tmpIndex!=-1){this.positionTo=_tmpIndex}this.moveIndex=-this.positionFrom+this.positionTo;h=j.indexReal+this.moveIndex;p=j.colspanReal;var r=s;if(p+h>r){if(h<0){p=r}else{p=r-h}}else{if(h<0){p=p+h}}if(h<0){h=0}}else{if(o=="left"){if(this.positionFrom==-1){this.positionFrom=j.index;this.positionTo=j.index}if(this.positionTo!=-1&&_tmpIndex!=-1){this.positionTo=_tmpIndex}this.moveIndex=-this.positionFrom+this.positionTo;if(this.positionTo>=this.positionFrom+j.colspanReal){h=j.indexReal+j.rowspan-1;p=this.positionTo-this.positionFrom-j.colspanReal+2}else{h=this.positionTo;p=j.rowspan+this.positionFrom-this.positionTo}}else{if(this.positionFrom==-1){this.positionFrom=j.index;this.positionTo=j.index}if(this.positionTo!=-1&&_tmpIndex!=-1&&this._tmpIndex!=-1){this.positionTo=_tmpIndex}this.moveIndex=-j.index-j.rowspan+this.positionTo+1;if(this.positionTo<=this.positionFrom){h=this.positionTo;p=this.positionFrom-this.positionTo+1}else{h=j.index;p=this.positionTo-j.index+1}}}var g=100/s*p;var l=100/s*h;b.style(q,"left",l+"%");b.style(q,"width",g+"%")}},onMouseUp:function(l){ptConfig[this.portletId].isTooltipEnable=true;if(b.isIE<=8&&b.isIE>0){document.onkeydown="";document.onkeyup=""}if(this.dragSource.schedule.isDrag!=true){b.style(this.node,"opacity",1);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments);return}var g=this.dragSource.schedule;var o=ptConfig[this.portletId].jsonData.date[0].substring(0,10);var h=this.dragSource.termType;var n=this.dragSource.scheduleNode;var f,j;if(b.byId("top_form_"+this.portletId).value=="simple"){f=ptConfig[this.portletId].jsonData.date[0];j=ptConfig[this.portletId].jsonData.date[0]}if(h=="center"){f=aipo.calendar.getDate(o,g.indexReal+this.moveIndex)+"-00-00";j=aipo.calendar.getDate(o,g.indexReal+this.moveIndex+g.colspanReal-1)+"-00-00"}else{if(h=="left"){if(g.colspanReal-this.moveIndex>0){f=aipo.calendar.getDate(o,g.indexReal+this.moveIndex)+"-00-00";j=aipo.calendar.getDate(o,g.indexReal+g.colspanReal-1)+"-00-00"}else{f=aipo.calendar.getDate(o,g.indexReal+g.colspanReal-1)+"-00-00";j=aipo.calendar.getDate(o,g.indexReal+this.moveIndex)+"-00-00"}}else{if(g.colspanReal+this.moveIndex>0){f=aipo.calendar.getDate(o,g.indexReal)+"-00-00";j=aipo.calendar.getDate(o,g.indexReal+g.colspanReal+this.moveIndex-1)+"-00-00"}else{f=aipo.calendar.getDate(o,g.indexReal+g.colspanReal+this.moveIndex-1)+"-00-00";j=aipo.calendar.getDate(o,g.indexReal)+"-00-00"}}}this.positionFrom=-1;this.positionTo=-1;this.moveIndex=0;this.tmpIndex=0;var m="";if(l.ctrlKey){m+="&mode=insert"}else{m+="&mode=update"}m+="&is_span=TRUE";m+="&entityid="+this.dragSource.schedule.scheduleId;m+="&view_start="+o;m+="&start_date="+f;m+="&end_date="+j;aipo.calendar.populateWeeklySchedule(this.portletId,m);aipo.portletReload("schedule",this.portletId);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments)}});b.declare("aipo.calendar.WeeklyTermScheduleDraggable",[aimluck.dnd.Draggable],{DragMoveObject:aipo.calendar.WeeklyTermScheduleDragMoveObject,isDraggable:false,TooltipObject:null,scheduleObjId:null,isDraggable:false,constructor:function(e,f){this.scheduleObjId=f.sid},onMouseDown:function(f){ptConfig[this.portletId].isTooltipEnable=false;if(this.TooltipObject){this.TooltipObject.close()}aimluck.dnd.Draggable.prototype.onMouseDown.apply(this,arguments)},onScheduleClick:function(g){if(this.schedule.isDrag||!this.isDraggable){return}var f=this.schedule.ownerId;aipo.common.showDialog(ptConfig[this.portletId].detailUrl+"&entityId="+this.schedule.scheduleId+"&view_date="+ptConfig[this.portletId].jsonData.date[this.schedule.index]+"&userid="+f,this.portletId,aipo.schedule.onLoadScheduleDetail);aipo.schedule.tmpScroll=parseInt(b.byId("weeklyScrollPane_"+this.portletId)["scrollTop"])},onScheduleOver:function(f){if(ptConfig[this.portletId].isTooltipEnable==false){return}if(scheduleTooltipEnable){this.setupTooltip(f)}},setupTooltip:function(h){var f=this.schedule.scheduleId;var g=ptConfig[this.portletId].jsonData.endDate;if(!this.TooltipObject){this.TooltipObject=new aipo.widget.ToolTip({label:"<div class='indicator'>読み込み中...</div>",connectId:[this.node.id]},this.portletId,function(e,l){var j=ptConfig[this.portletId].jsonUrl.split("?")[0]+"?template=ScheduleDetailJSONScreen&view_date="+g+"&scheduleid="+f;aipo.calendar.showTooltip(j,this.portletId,e)});this.TooltipObject._onHover(h)}aipo.calendar.objectlist.push(this.TooltipObject)},setDraggable:function(e){this.isDraggable=e}});b.declare("aipo.calendar.WeeklyScheduleAddDragMoveObject",[aimluck.dnd.DragMoveObject],{_rowHeight_:18,positionFrom:0,positionTo:0,_isDragging:false,lastScroll:0,_isLocked:false,onMouseDown:function(f){this._isDragging=false;aimluck.dnd.DragMoveObject.prototype.onMouseDown.apply(this,arguments)},onFirstMove:function(g){this.startY=this.dragSource._lastY;this.startAbsoluteY=b._abs(b.byId(this.node),true).y;this.startX=b.getComputedStyle(this.node).left;var f=window.navigator.userAgent.toLowerCase();if(f.indexOf("chrome")>-1||(b.isFF&&(b.isFF>=3.6))){this.startAbsoluteY+=window.scrollY}else{if(f.indexOf("safari")>-1){this.startAbsoluteY-=b.byId("weeklyScrollPane_"+this.portletId).scrollTop}}lastScroll=b.byId("weeklyScrollPane_"+this.portletId).scrollTop;aimluck.dnd.DragMoveObject.prototype.onFirstMove.apply(this,arguments)},onMouseMove:function(m){if(this._isLocked){return}aimluck.dnd.DragMoveObject.prototype.onMouseMove.apply(this,arguments);this._isDragging=true;var l=b.byId("weeklyScrollPane_"+this.portletId).scrollTop-lastScroll;var j=Math.floor((this.startY-this.startAbsoluteY)/this._rowHeight_);var f=Math.floor((this.startY+this.leftTop.t-this.startAbsoluteY+l)/this._rowHeight_);var g=0;var h=0;if(f<j){g=f*this._rowHeight_+1;h=(j-f+1)*this._rowHeight_;this.positionFrom=f;this.positionTo=j+1}else{g=j*this._rowHeight_+1;h=(f-j+1)*this._rowHeight_;this.positionTo=f+1;this.positionFrom=j}if(g+h>864){h=864-g-this._rowHeight_;this.positionTo=47}this.leftTop.t=g;this.leftTop.l=this.startX;this.leftTop.h=h;b.marginBox(this.node,this.leftTop);b.style(this.node,"opacity",0.5)},onMouseUp:function(l){if(!this._isDragging){this.onFirstMove(l);this.onMouseMove(l)}var f=Math.floor(this.positionFrom/2);f=(f>9)?f:"0"+f;var m=Math.floor(this.positionFrom%2)*30;var h=ptConfig[this.portletId].jsonData.date[this.dragSource.index].substring(0,10);var j=h+"-"+f+"-"+m;f=Math.floor(this.positionTo/2);f=(f>9)?f:"0"+f;m=Math.floor(this.positionTo%2)*30;var g=h+"-"+f+"-"+m;this.node.style.top="0px";this.node.style.height="864px";b.style(this.node,"opacity",0);if(this._isDragging==true){aipo.common.showDialog(ptConfig[this.portletId].formUrl+"&entityid=new&mode=form&form_start="+j+"&form_end="+g,this.portletId,aipo.schedule.onLoadScheduleDialog)}aipo.schedule.tmpScroll=parseInt(b.byId("weeklyScrollPane_"+this.portletId)["scrollTop"]);this._isDragging=false;aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments);this._isLocked=true;setTimeout(function(){this._isLocked=false},5000)}});b.declare("aipo.calendar.WeeklyScheduleAddDraggable",[aimluck.dnd.Draggable],{DragMoveObject:aipo.calendar.WeeklyScheduleAddDragMoveObject,constructor:function(e,f){this.index=f.idx}});b.declare("aipo.calendar.WeeklyTermScheduleAddDragMoveObject",[aimluck.dnd.DragMoveObject],{_rowHeight_:18,positionFrom:-1,positionTo:-1,_isDragging:false,scheduleObjId:null,onMouseDown:function(f){this._isDragging=false;aimluck.dnd.DragMoveObject.prototype.onMouseDown.apply(this,arguments)},onFirstMove:function(f){aimluck.dnd.DragMoveObject.prototype.onFirstMove.apply(this,arguments);aipo.calendar.setGridArray(this.portletId,parseInt(ptConfig[this.portletId].scheduleDivDaySum))},onMouseMove:function(n){aimluck.dnd.DragMoveObject.prototype.onMouseMove.apply(this,arguments);this._isDragging=true;b.style(this.node,"opacity",0.5);var h=aipo.calendar.getCurrentMouseX(this.portletId,n);var o=h.index;if(this.positionFrom==-1&&o!=-1){this.positionFrom=o;this.positionTo=this.positionFrom}if(this.positionTo!=-1&&o!=-1){this.positionTo=o}if(this.positionTo!=-1&&this.positionFrom!=-1){var g,f;if(this.positionTo>this.positionFrom){f=this.positionFrom;g=this.positionTo-this.positionFrom+1}else{f=this.positionTo;g=this.positionFrom-this.positionTo+1}var l;var m;if(b.byId("view_type_"+this.portletId)&&b.byId("top_form_"+this.portletId).value=="simple"){var j=parseInt(b.byId("view_type_"+this.portletId).value);l=100/j*g;m=100/j*f}else{l=100/ptConfig[this.portletId].scheduleDivDaySum*g;m=100/ptConfig[this.portletId].scheduleDivDaySum*f}b.style(this.node,"left",m+"%");b.style(this.node,"width",l+"%")}else{b.style(this.node,"left",0+"%");b.style(this.node,"width",0+"%")}},onMouseUp:function(j){if(!this._isDragging){this.onFirstMove(j);this.onMouseMove(j)}var l,h;if(this.positionTo!=-1&&this.positionFrom!=-1){if(this.positionTo>this.positionFrom){l=this.positionFrom;h=this.positionTo}else{h=this.positionFrom;l=this.positionTo}var g=ptConfig[this.portletId].jsonData.date[l];var f=ptConfig[this.portletId].jsonData.date[h];if(this._isDragging==true){aipo.common.showDialog(ptConfig[this.portletId].formUrl+"&entityid=new&mode=form&is_span=TRUE&form_start="+g+"&form_end="+f,this.portletId,aipo.schedule.onLoadScheduleDialog)}aipo.schedule.tmpScroll=parseInt(b.byId("weeklyScrollPane_"+this.portletId)["scrollTop"])}this.positionFrom=-1;this.positionTo=-1;b.style(this.node,"left",0+"%");b.style(this.node,"width",100+"%");b.style(this.node,"opacity",0);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments)}});b.declare("aipo.calendar.WeeklyTermScheduleAddDraggable",[aimluck.dnd.Draggable],{DragMoveObject:aipo.calendar.WeeklyTermScheduleAddDragMoveObject,constructor:function(e,f){this.index=f.idx}});aipo.schedule.initCalendar=function(f){for(var e=0;e<ptConfig[f].scheduleDivDaySum;e++){tmpDraggable=new aipo.calendar.WeeklyScheduleAddDraggable("scheduleDivAdd0"+e+"_"+f,{idx:e});tmpDraggable.portletId=f;tmpDraggable.index=e}tmpDraggable=new aipo.calendar.WeeklyTermScheduleAddDraggable("termScheduleDivAdd_"+f,{idx:0});tmpDraggable.portletId=f;aipo.calendar.populateWeeklySchedule(f)};aipo.schedule.groupSelectOnchange=function(j,m,n,f){var p=function(u,t){var s="";f.dropDown.removeMember(b.byId("member_to-"+n));for(var r=0;r<u.length;r++){var q=u[r].aliasName.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(r!=0){s+=" "}g+="&m_id="+u[r].name;var e=r%aipo.calendar.maximum_to;s+='<span class="dispUser color'+e+'">'+q+"</span>";aimluck.io.addOption(b.byId("member_to-"+n),u[r].name,q,true)}b.byId("member_to_input-"+n).innerHTML=s};var l=b.query("#adduser-"+n);switch(j.value.indexOf("pickup")){case -1:l.addClass("hide");var g="";b.xhrGet({portletId:n,url:j.value,encoding:"utf-8",handleAs:"json-comment-filtered",load:p,handle:function(){aipo.calendar.populateWeeklySchedule(n,g)}});break;default:l.removeClass("hide");f.dropDown.removeMember(b.byId("member_to-"+n));f.dropDown.removeMember(b.byId("tmp_member_to-"+n));var o=b.byId("picked_memberlist-"+n).options;for(var h=0;h<o.length;h++){(function(q,e){q.selected=true})(o[h],h)}f.dropDown.addMember(b.byId("picked_memberlist-"+n),b.byId("tmp_member_to-"+n));f.dropDown.addMember(b.byId("picked_memberlist-"+n),b.byId("member_to-"+n));f.inputMemberSync();aipo.calendar.populateWeeklySchedule(n);b.xhrGet({portletId:n,url:b.byId("groupselect-defaulturl-"+n).value,encoding:"utf-8",handleAs:"json-comment-filtered"});break}}}}});