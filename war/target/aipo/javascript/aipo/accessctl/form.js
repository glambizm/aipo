dojo.provide("aipo.accessctl");dojo.require("aipo.widget.MemberNormalSelectList");aipo.accessctl.onLoadAccessctlDialog=function(g){var a=dojo.byId("acl_role_name");if(a){a.focus()}var e=dijit.byId("membernormalselect");if(e){var b=dojo.byId("init_memberlist");var f;var d=b.options;if(d.length==1&&d[0].value==""){return}for(f=0;f<d.length;f++){e.addOptionSync(d[f].value,d[f].text,true)}}var c=dojo.byId("urlacls"+g).value;var h=dojo.byId("initfeature"+g).value;aipo.accessctl.changeAcls(g,c,h)};aipo.accessctl.onReceiveMessage=function(b){if(!b){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("accessctl")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=b}};aipo.accessctl.changeAcls=function(c,b,a){aipo.accessctl.createCheckbox(c,"acls","aclsDiv",b+"?featureid="+a,"aclId","aclName","checked")};aipo.accessctl.createCheckbox=function(g,c,b,d,e,a,f){dojo.xhrGet({url:d,timeout:5000,encoding:"utf-8",handleAs:"json-comment-filtered",headers:{X_REQUESTED_WITH:"XMLHttpRequest"},load:function(k,l){var h="";dojo.forEach(k,function(m){if(typeof m[e]=="undefined"||typeof m[a]=="undefined"){}else{if(m[f]=="true"){h+="<input name='"+m[e]+"' id='"+m[e]+"' type='checkbox' value='1' checked='checked'/><label for='"+m[e]+"'>&nbsp;"+m[a]+"</label>"}else{h+="<input name='"+m[e]+"' id='"+m[e]+"' type='checkbox' value='1'/><label for='"+m[e]+"'>&nbsp;"+m[a]+"</label>"}h+="&nbsp;"}});dojo.byId(b).innerHTML=h;aipo.accessctl.setupAcl(g,"acllist");aipo.accessctl.setupAcl(g,"acldetail");aipo.accessctl.setupAcl(g,"aclinsert");aipo.accessctl.setupAcl(g,"aclupdate");aipo.accessctl.setupAcl(g,"acldelete");aipo.accessctl.setupAcl(g,"aclexport")}})};aipo.accessctl.setupAcl=function(c,b){var a=dojo.byId("init"+b+c);if(a&&a.value=="checked"){dojo.byId(b).checked=true}};aipo.accessctl.submitList=function(a){submit_member(a.ac_users);submit_member(a.ac_admins);submit_member(a.ac_guests)};aipo.accessctl.changeACL=function(l,b,m){var h=l.elements[b].options;var e=l.elements[m].options;var a=0;for(a=0;a<h.length-1;a++){var k=h[a];if(!k.selected||!k.text){continue}var c=false;var g=e.length-1;for(j=0;j<g;j++){if(e[j].text==k.text){c=true;break}}if(c){continue}aipo.accessctl.addOption(e,k.text,k.value,g)}};aipo.accessctl.removeList=function(c,a){var b=c.elements[a].options;for(i=0;i<b.length-1;i++){if(b[i].selected){b[i]=null;i-=1}}};aipo.accessctl.addOption=function(e,b,f,c){var d=e.length;if(c<0){c=d}var a=new Option();e[d]=a;for(i=d;i>c;i--){e[i].text=e[i-1].text}e[c].text=b;e[c].value=f;e[c].selected=true};