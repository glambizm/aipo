if(!dojo._hasResource["aipo.widget.MemberFacilitySelectList"]){dojo._hasResource["aipo.widget.MemberFacilitySelectList"]=true;dojo.provide("aipo.widget.MemberFacilitySelectList");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.declare("aipo.widget.MemberFacilitySelectList",[dijit._Widget,dijit._Templated],{widgetId:"",inputWidth:"95%",hiddenId:"",hiddenValue:"",inputId:"",inputValue:"",selectId:"",memberFromId:"",memberFromUrl:"",memberFromOptionKey:"",memberFromOptionValue:"",memberToId:"",buttonAddId:"",buttonRemoveId:"",memberLimit:0,groupSelectId:"",groupSelectOptionKey:"",groupSelectOptionValue:"",memberGroupUrl:"",changeGroupUrl:"",tmpPortretId:"",templateString:'<div id="${widgetId}" widgetId="${widgetId}" style="display: none"><div class="auiPopup" style="width:300px"><div class="clearfix"><div class="memberlistToTop" >閲覧ユーザー一覧</div><div class="memberlistFromTop"><select size="1" style="width:100%" name="${groupSelectId}" id="${groupSelectId}" dojoAttachEvent="onchange:changeGroup"></select></div></div><div class="clearfix mb5"><div class="memberlistToBody"><select size="10" multiple="multiple" style="width:100%" name="${memberToId}" id="${memberToId}"></select></div><div class="memberlistFromBody"><select size="10" multiple="multiple" style="width:100%" name="${memberFromId}" id="${memberFromId}"></select></div></div><div class="clearfix"><div class="memberlistToBottom"><div class="alignright"><input id="${buttonRemoveId}" name="${buttonRemoveId}" type="button" class="button" value="削除"/ dojoAttachEvent="onclick:onMemberRemoveClick"></div></div><div class="memberlistFromBottom"><div class="alignright"><input id="${buttonAddId}" name="${buttonAddId}" type="button" class="button" value="＜ 追加"/ dojoAttachEvent="onclick:onMemberAddClick"></div></div></div> </div></div>\n',postCreate:function(){this.id=this.widgetId;params={url:this.memberFromUrl,key:this.memberFromOptionKey,value:this.memberFromOptionValue};aimluck.io.createOptions(this.memberFromId,params);params={url:this.memberGroupUrl,key:this.groupSelectOptionKey,value:this.groupSelectOptionValue,preOptions:{key:"LoginUser",value:"（全体）"}};aimluck.io.createOptions(this.groupSelectId,params)},addOption:function(a,b,c,d){aimluck.io.addOption(a,b,c,d)},addOptionSync:function(e,f,g){var b=dojo.byId(this.memberToId);var a=dojo.byId(this.selectId);if(this.memberLimit!=0&&b.options.length>=this.memberLimit){return}if(document.all){var d=document.createElement("OPTION");d.value=e;d.text=f;d.selected=g;var c=document.createElement("OPTION");c.value=e;c.text=f;c.selected=g;if(b.options.length==1&&b.options[0].value==""){b.options.remove(0);a.options.remove(0)}b.add(d,b.options.length);a.add(c,a.options.length)}else{var d=document.createElement("OPTION");d.value=e;d.text=f;d.selected=g;var c=document.createElement("OPTION");c.value=e;c.text=f;c.selected=g;if(b.options.length==1&&b.options[0].value==""){b.removeChild(b.options[0]);a.removeChild(b.options[0])}b.insertBefore(d,b.options[b.options.length]);a.insertBefore(c,a.options[a.options.length])}this.inputMemberSync()},addMember:function(e,b){if(document.all){var a=e.options;var f=b.options;if(a.length==1&&a[0].value==""){return}for(i=0;i<a.length;i++){if(!a[i].selected){continue}var d=false;for(j=0;j<f.length;j++){if(f[j].value==a[i].value){d=true;break}}if(d){continue}var c=document.createElement("OPTION");c.value=a[i].value;c.text=a[i].text;c.selected=true;if(f.length==1&&f[0].value==""){f.remove(0)}if(this.memberLimit!=0&&b.options.length>=this.memberLimit){return}if(aipo.calendar.maximum_to>f.length){f.add(c,f.length)}}}else{var a=e.options;var f=b.options;if(a.length==1&&a[0].value==""){return}for(i=0;i<a.length;i++){if(!a[i].selected){continue}var d=false;for(j=0;j<f.length;j++){if(f[j].value==a[i].value){d=true;break}}if(d){continue}var c=document.createElement("OPTION");c.value=a[i].value;c.text=a[i].text;c.selected=true;if(b.options.length==1&&b.options[0].value==""){b.removeChild(b.options[0])}if(this.memberLimit!=0&&b.options.length>=this.memberLimit){return}if(aipo.calendar.maximum_to>f.length){b.insertBefore(c,f[f.length])}}}},removeAllMember:function(a){if(document.all){var b=a.options;for(i=0;i<b.length;i++){if(b[i].selected){b.remove(i);i-=1}}}else{var b=a.options;for(i=0;i<b.length;i++){if(b[i].selected){a.removeChild(b[i]);i-=1}}}},removeMember:function(a){if(document.all){var b=a.options;for(i=0;i<b.length;i++){if(b[i].selected){b.remove(i);i-=1}}}else{var b=a.options;for(i=0;i<b.length;i++){if(b[i].selected){a.removeChild(b[i]);i-=1}}}},removeMemberSync:function(){var c=dojo.byId(this.memberToId);var b=dojo.byId(this.selectId);if(document.all){var d=c.options;var a=b.options;for(i=0;i<d.length;i++){if(d[i].selected){d.remove(i);a.remove(i);i-=1}}}else{var d=c.options;var a=b.options;for(i=0;i<d.length;i++){if(d[i].selected){c.removeChild(d[i]);b.removeChild(a[i]);i-=1}}}},inputMemberSync:function(){var g=dojo.byId(this.selectId);var f=dojo.byId(this.inputId);var d="";var a=g.options;for(c=0;c<a.length;c++){if(c!=0){d+=" "}var b=c%aipo.calendar.maximum_to;var h=a[c].text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");d+='<span class="dispUser color'+b+'">'+h+"</span>"}var k=dojo.byId("picked_memberlist-"+this.tmpPortretId);if(k){this.removeMember(k);var e=k.options;for(var c=0;c<e.length;c++){(function(m,l){m.selected=true})(e[c],c)}this.addMember(dojo.byId("member_to-"+this.tmpPortretId),dojo.byId("picked_memberlist-"+this.tmpPortretId))}f.innerHTML=d},changeGroup:function(a){var d=a.target.options[a.target.selectedIndex].value;var b=this.changeGroupUrl+"&groupname="+d;var c={url:b,key:this.memberFromOptionKey,value:this.memberFromOptionValue};aimluck.io.createOptions(this.memberFromId,c)},onMemberAddClick:function(a){this.addMember(dojo.byId(this.memberFromId),dojo.byId(this.memberToId));this.addMember(dojo.byId(this.memberFromId),dojo.byId(this.selectId));this.inputMemberSync()},onMemberRemoveClick:function(b){this.removeMemberSync();this.inputMemberSync();var a=dojo.byId(this.memberToId);if(a.options.length==0){if(aipo.schedule.login_aliasname!="undefined"){var c=aipo.schedule.login_aliasname.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">");this.addOptionSync(aipo.schedule.login_id,c,true)}}},onCloseClick:function(){dojo.style(this.domNode,"display","none");aipo.calendar.populateWeeklySchedule(this.tmpPortretId)}})};