dojo.require("aipo.widget.MemberNormalSelectList");dojo.provide("aipo.msgboard");aipo.msgboard.toggleMenu=function(f,e,d){var c=e.getBoundingClientRect();var b=document.documentElement.getBoundingClientRect();if(f.style.display=="none"){dojo.query("div.menubar").style("display","none");var a={left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};f.style.opacity="0";setTimeout(function(){dojo.style(f,"display","block")},0);if(b.right-f.clientWidth>c.left){f.style.left=c.left+a.left+"px"}else{f.style.left=c.right-f.clientWidth+a.left+"px"}if(b.bottom-f.clientHeight>c.bottom||d){f.style.top=c.bottom+a.top+"px"}else{f.style.top=c.top-f.clientHeight+a.top+"px"}f.style.opacity=""}else{dojo.query("div.menubar").style("display","none")}};aipo.msgboard.initFilterSearch=function(d){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;if(aipo.userAgent.isAndroid4_0()){var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left=a+"px";c.style.left=-a+"px";e.style.width=f-a+"px";b.style.width=f-a+"px";e.style.paddingLeft="2px"}else{if(a!=0){e.style.paddingLeft=a+"px"}}}};aipo.msgboard.finFilterSearch=function(d){if(aipo.userAgent.isAndroid4_0()){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left="0px";c.style.left="0px";e.style.width=f+a+"px";b.style.width=f+a+"px";e.style.paddingLeft=a+2+"px"}}};aipo.msgboard.filteredSearch=function(d){var b=dojo.byId("baseuri_"+d).value;var c=[];var f=[];dojo.query("ul.filtertype_"+d).forEach(function(h){var i=h.getAttribute("data-type");c.push(i);var g=dojo.query("li.selected",h)[0];if(g){var j=g.getAttribute("data-param");f.push(j)}else{f.push(h.getAttribute("data-defaultparam"))}});var e=dojo.byId("q"+d);var a=[["filter",f.join(",")],["filtertype",c.join(",")],["keyword",e?e.value:""]];aipo.viewPage(b,d,a)};aipo.msgboard.filterSetDefault=function(e,d){var c=dojo.query("ul.filtertype[data-type="+d+"]")[0];var b=c.getAttribute("data-defaultparam");var a=dojo.query("li[data-param="+b+"]",c);aipo.msgboard.filterSelect(c,a);aipo.msgboard.filteredSearch(e)};aipo.msgboard.filterSelect=function(b,a){dojo.query("li",b).removeClass("selected");dojo.query(a).addClass("selected")};aipo.msgboard.filterClick=function(d,e,c){var a=e.parentNode;var b=a.parentNode;var f=a.getAttribute("data-param");aipo.msgboard.filterSelect(b,a);aipo.msgboard.filteredSearch(d)};aipo.msgboard.onLoadMsgboardDetail=function(a){aipo.portletReload("whatsnew")};aipo.msgboard.onLoadMsgboardDialog=function(a){var b=dojo.byId("topic_name");if(b){b.focus()}};aipo.msgboard.onChangeFilter=aipo.msgboard.onChangeSearch=function(a,c){var b=encodeURIComponent(dojo.byId("q").value);a+="?template=MsgboardTopicListScreen";a+="&filter="+dojo.byId("topic").value;a+="&filtertype=category";a+="&search="+b;aipo.viewPage(a,c)};aipo.msgboard.onLoadCategoryDialog=function(e){var f=dojo.byId("category_name");if(f){f.focus()}var c=dijit.byId("membernormalselect");if(c){var a=dojo.byId("init_memberlist");var d;var b=a.options;if(b.length==1&&b[0].value==""){return}for(d=0;d<b.length;d++){c.addOptionSync(b[d].value,b[d].text,true)}}};aipo.msgboard.showMember=function(a){dojo.byId("Block-GroupMember-Show").style.display="";dojo.byId("is_member").value="TRUE"};aipo.msgboard.hideMember=function(a){dojo.byId("Block-GroupMember-Show").style.display="none";dojo.byId("member_to").options.length=0;dojo.byId("is_member").value="FALSE"};aipo.msgboard.expandImageWidth=function(a){var b=a.className;if(!b.match(/width_auto/i)){a.className=a.className.replace(/\bwidth_thumbs\b/g,"width_auto")}else{a.className=a.className.replace(/\bwidth_auto\b/g,"width_thumbs")}};aipo.msgboard.formSwitchCategoryInput=function(a){if(a.form.is_new_category.value=="TRUE"||a.form.is_new_category.value=="true"){a.value=aimluck.io.escapeText("msgboard_val_switch1");aipo.msgboard.formCategoryInputOff(a.form)}else{a.value=aimluck.io.escapeText("msgboard_val_switch2");aipo.msgboard.formCategoryInputOn(a.form)}};aipo.msgboard.formCategoryInputOn=function(a){dojo.byId("msgboardCategorySelectField").style.display="none";dojo.byId("msgboardCategoryInputField").style.display="";a.is_new_category.value="TRUE"};aipo.msgboard.formCategoryInputOff=function(a){dojo.byId("msgboardCategoryInputField").style.display="none";dojo.byId("msgboardCategorySelectField").style.display="";a.is_new_category.value="FALSE"};aipo.msgboard.onReceiveMessage=function(c){var a=dojo.byId("attachments_select");if(typeof a!="undefined"&&a!=null){a.parentNode.removeChild(a)}if(!c){var b=dijit.byId("modalDialog");if(b){b.hide()}aipo.portletReload("msgboard");aipo.portletReload("timeline")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=c}};aipo.msgboard.onListReceiveMessage=function(b){if(!b){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("msgboard")}if(dojo.byId("listmessageDiv")){dojo.byId("listmessageDiv").innerHTML=b}};aipo.msgboard.ajaxCheckboxDeleteSubmit=function(b,a,c,d,e){aimluck.io.ajaxVerifyCheckbox(b.form,aipo.msgboard.ajaxMultiDeleteSubmit,b,a,c,d,e)};aipo.msgboard.ajaxMultiDeleteSubmit=function(b,a,c,d,e){if(confirm("選択した"+b.form._name.value+"を削除してよろしいですか？なお、カテゴリに含まれるトピックはすべて削除されます。")){aimluck.io.disableForm(b.form,true);aimluck.io.setHiddenValue(b);b.form.action=a;aimluck.io.submit(b.form,c,d,e)}};aipo.msgboard.ajaxDeleteSubmit=function(b,a,c,d,e){if(confirm("この"+b.form._name.value+"を削除してよろしいですか？なお、カテゴリに含まれるトピックはすべて削除されます。")){aimluck.io.disableForm(b.form,true);aimluck.io.setHiddenValue(b);b.form.action=a;aimluck.io.submit(b.form,c,d,e)}};