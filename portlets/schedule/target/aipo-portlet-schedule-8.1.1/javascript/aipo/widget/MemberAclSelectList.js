if(!dojo._hasResource["aipo.widget.MemberAclSelectList"]){dojo._hasResource["aipo.widget.MemberAclSelectList"]=true;dojo.provide("aipo.widget.MemberAclSelectList");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.declare("aipo.widget.MemberAclSelectList",[dijit._Widget,dijit._Templated],{widgetId:"",memberFromId:"",memberFromUrl:"",memberFromOptionKey:"",memberFromOptionValue:"",memberToTitle:"",memberToId:"",buttonAddId:"",buttonRemoveId:"",memberLimit:0,groupSelectId:"",groupSelectPreOptionKey:"",groupSelectPreOptionValue:"",groupSelectOptionKey:"",groupSelectOptionValue:"",memberGroupUrl:"",changeGroupUrl:"",memberValuesStr:"",memberValues:[],templateString:'<div id="${widgetId}" widgetId="${widgetId}"><table class="none wide mb15"><tbody><tr><td valign="top"><table class="auiRowTable wide mb5"><tbody name="${memberToId}" id="${memberToId}"><tr><th class="thin"><input type="checkbox" onclick="aimluck.io.switchCheckbox(this);"/></th><th class="w50">\u540D\u524D</th><th nowrap="nowrap">\u6A29\u9650</th></tr></tbody></table><input type="button" class="button" value="\u3000\u524A\u9664\u3000" dojoAttachEvent="onclick:onMemberRemoveClick"/></td><td class="thin" valign="top"><select style="width:140px" name="${groupSelectId}" id="${groupSelectId}" dojoAttachEvent="onchange:changeGroup"></select>\n<select size="8" multiple="multiple" style="width:140px" class="mb5" name="${memberFromId}" id="${memberFromId}"></select>\n<input type="button" class="button" value="\u3000\uFF1C \u8FFD\u52A0\u3000" dojoAttachEvent="onclick:onMemberAddClick"/></td></tr></tbody></table></div>\n',postCreate:function(){this.id=this.widgetId;this.memberValues=[];var b=this.memberValuesStr.split(",");for(var d=0;d<b.length;d++){var a=b[d].split(":");var c={};c.key=a[0];c.value=a[1];this.memberValues.push(c)}var e={url:this.memberFromUrl,key:this.memberFromOptionKey,value:this.memberFromOptionValue,preOptions:{key:"ug2",value:"\u005b\u5168\u54e1\u005d"},callback:this.addMemberSync,callbackTarget:this};aimluck.io.createOptions(this.memberFromId,e);e={url:this.memberGroupUrl,key:this.groupSelectOptionKey,value:this.groupSelectOptionValue,preOptions:{key:"all",value:"\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u30fc\u3001\u30b0\u30eb\u30fc\u30d7"}};aimluck.io.createOptions(this.groupSelectId,e)},addMemberSync:function(){var f=dojo.byId(this.memberFromId);var a=dojo.byId(this.memberToId);var e=f.options;if(e.length==1&&e[0].value==""){return}for(var g=0;g<e.length;g++){var k=false;var l="1";for(j=0;j<this.memberValues.length;j++){if(this.memberValues[j].key==e[g].value){k=true;l=this.memberValues[j].value;break}}if(!k){continue}var h=document.createElement("tr");h.id="tracldel"+e[g].value;var d=document.createElement("td");d.innerHTML=this.assingValue('<input type="checkbox" id="acldel__ID__" name="acldel" value="__ID__"/>',e[g].value,e[g].text,l);var c=document.createElement("td");c.innerHTML=this.assingValue('<label for="acldel__ID__">__NAME__</label>',e[g].value,e[g].text,l);var b=document.createElement("td");b.setAttribute("nowrap","true");b.nowrap="true";b.innerHTML=this.assingValue('<label><input type="radio" name="acl__ID__" value="1" __CHECKED1__/>\u95b2\u89a7\u306e\u307f</label>&nbsp;<label><input type="radio" name="acl__ID__" value="2" __CHECKED2__/>\u95b2\u89a7\u30fb\u8ffd\u52a0\u30fb\u7de8\u96c6\u30fb\u524a\u9664\u53ef\u80fd</label>',e[g].value,e[g].text,l);h.appendChild(d);h.appendChild(c);h.appendChild(b);a.appendChild(h)}},assingValue:function(b,d,a,c){return b.replace(/__ID__/g,d).replace(/__NAME__/g,a).replace(/__CHECKED1__/g,"1"==c?"checked='checked'":"").replace(/__CHECKED2__/g,"2"==c?"checked='checked'":"")},addMember:function(f,a){var e=f.options;if(e.length==1&&e[0].value==""){return}for(var h=0;h<e.length;h++){if(!e[h].selected){continue}var l=false;for(var g=0;g<this.memberValues.length;g++){if(this.memberValues[g].key==e[h].value){l=true;break}}if(l){continue}var m={};m.key=e[h].value;m.value="1";this.memberValues.push(m);var k=document.createElement("tr");k.id="tracldel"+e[h].value;var d=document.createElement("td");d.innerHTML=this.assingValue('<input type="checkbox" id="acldel__ID__" name="acldel" value="__ID__"/>',e[h].value,e[h].text,"2");var c=document.createElement("td");c.innerHTML=this.assingValue('<label for="acldel__ID__">__NAME__</label>',e[h].value,e[h].text,"2");var b=document.createElement("td");b.setAttribute("nowrap","true");b.nowrap="true";b.innerHTML=this.assingValue('<label><input type="radio" name="acl__ID__" value="1" __CHECKED1__/>\u95b2\u89a7\u306e\u307f</label>&nbsp;<label><input type="radio" name="acl__ID__" value="2" __CHECKED2__/>\u95b2\u89a7\u30fb\u8ffd\u52a0\u30fb\u7de8\u96c6\u30fb\u524a\u9664\u53ef\u80fd</label>',e[h].value,e[h].text,"2");k.appendChild(d);k.appendChild(c);k.appendChild(b);a.appendChild(k)}},removeMember:function(g){var e=[];for(var d=0;d<g.elements.length;d++){var c=g.elements[d];if("acldel"==c.name){if(c.checked){e.push(c)}}}for(var d=0;d<e.length;d++){var a=e[d].id;var f=dojo.byId("tr"+a);f.parentNode.removeChild(f);for(var b=0;b<this.memberValues.length;b++){if(this.memberValues[b].key==a.replace("acldel","")){this.memberValues.splice(b,1)}}}},changeGroup:function(a){var d=a.target.options[a.target.selectedIndex].value;var b=this.changeGroupUrl+"&groupname="+d;var c={url:b,key:this.memberFromOptionKey,value:this.memberFromOptionValue,indicator:this.widgetId+"-memberlist-indicator"};aimluck.io.createOptions(this.memberFromId,c)},onMemberAddClick:function(a){this.addMember(dojo.byId(this.memberFromId),dojo.byId(this.memberToId))},onMemberRemoveClick:function(a){this.removeMember(a.target.form)}})};