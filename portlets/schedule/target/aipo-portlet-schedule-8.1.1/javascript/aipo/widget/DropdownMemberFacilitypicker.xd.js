dojo._xdResourceLoaded({depends:[["provide","aipo.widget.DropdownMemberFacilitypicker"],["require","aimluck.widget.Dropdown"],["require","aipo.widget.MemberFacilitySelectList"]],defineResource:function(a){if(!a._hasResource["aipo.widget.DropdownMemberFacilitypicker"]){a._hasResource["aipo.widget.DropdownMemberFacilitypicker"]=true;a.provide("aipo.widget.DropdownMemberFacilitypicker");a.require("aimluck.widget.Dropdown");a.require("aipo.widget.MemberFacilitySelectList");a.declare("aipo.widget.DropdownMemberFacilitypicker",[aimluck.widget.Dropdown],{inputWidth:"250px",hiddenId:"",hiddenValue:"",iconURL:"",iconAlt:"",selectId:"",inputId:"",inputValue:"",buttonAddId:"",buttonRemoveId:"",memberFromId:"",memberToId:"",memberFromUrl:"",memberFromOptionKey:"",memberFromOptionValue:"",groupSelectId:"",groupSelectOptionKey:"",groupSelectOptionValue:"",memberGroupUrl:"",changeGroupUrl:"",listWidgetId:"",tmpPortretId:"cinit",templateString:'<div class="dijit dijitLeft dijitInline"\n\tdojoAttachEvent="onmouseenter:_onMouse,onmouseleave:_onMouse,onmousedown:_onMouse,onclick:_onDropDownClick,onkeydown:_onDropDownKeydown,onblur:_onDropDownBlur,onkeypress:_onKey"\n\t><div class=\'dijitRight\'>\n\t<span class="" type="${type}"\n\t\tdojoAttachPoint="focusNode,titleNode" waiRole="button" waiState="haspopup-true,labelledby-${id}_label"\n\t\t><span class="" \tdojoAttachPoint="containerNode,popupStateNode"\n\t\tid="${id}_label"></span><select name="${selectId}" id="${selectId}" size="10" multiple="multiple" style="display:none" dojoAttachPoint="selectNode"></select><input type="hidden" id="${hiddenId}" name="${hiddenId}" value="${hiddenValue}" dojoAttachPoint="valueNode" /><span name="${inputId}" id="${inputId}" dojoAttachPoint="inputNode">${inputValue}</span>\n<span id="adduser-${tmpPortretId}" class="small addUser">ユーザー追加</span></div></div>\n',postCreate:function(){var b={widgetId:this.listWidgetId,selectId:this.selectId,inputId:this.inputId,buttonAddId:this.buttonAddId,buttonRemoveId:this.buttonRemoveId,memberFromId:this.memberFromId,memberToId:this.memberToId,memberFromUrl:this.memberFromUrl,memberFromOptionKey:this.memberFromOptionKey,memberFromOptionValue:this.memberFromOptionValue,groupSelectId:this.groupSelectId,groupSelectOptionKey:this.groupSelectOptionKey,groupSelectOptionValue:this.groupSelectOptionValue,memberGroupUrl:this.memberGroupUrl,changeGroupUrl:this.changeGroupUrl,tmpPortretId:this.tmpPortretId};this.listWidgetId="memberfacilitylistwidget-"+this.tmpPortretId;var c=dijit.byId(this.listWidgetId);if(c){dijit.registry.remove(this.listWidgetId)}this.dropDown=new aipo.widget.MemberFacilitySelectList(b,this.listWidgetId);this.inherited(arguments)},removeAllOptions:function(b){var c;if(document.all){var d=b.options;for(c=0;c<d.length;c++){d.remove(c);c-=1}}else{var d=b.options;for(c=0;c<d.length;c++){b.removeChild(d[c]);c-=1}}},addOptionSync:function(f,g,h){var c=a.byId(this.memberToId);var b=a.byId(this.selectId);if(this.memberLimit!=0&&c.options.length>=this.memberLimit){return}if(document.all){var e=document.createElement("OPTION");e.value=f;e.text=g;e.selected=h;var d=document.createElement("OPTION");d.value=f;d.text=g;d.selected=h;if(c.options.length==1&&c.options[0].value==""){c.options.remove(0);b.options.remove(0)}c.add(e,c.options.length);b.add(d,b.options.length)}else{var e=document.createElement("OPTION");e.value=f;e.text=g;e.selected=h;var d=document.createElement("OPTION");d.value=f;d.text=g;d.selected=h;if(c.options.length==1&&c.options[0].value==""){c.removeChild(c.options[0]);b.removeChild(c.options[0])}c.insertBefore(e,c.options[c.options.length]);b.insertBefore(d,b.options[b.options.length])}this.inputMemberSync()},inputMemberSync:function(){var l=a.byId(this.selectId);var k=a.byId(this.inputId);var e="";var b=l.options;var f=b.length;if(f<=0){return}for(var d=0;d<f;d++){if(d!=0){e+=" "}var c=d%aipo.calendar.maximum_to;var m=b[d].text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e+='<span class="dispUser color'+c+'">'+m+"</span>"}var h=(a.byId("groupselect-"+this.tmpPortretId).value==a.byId("groupselect-defaulturl-"+this.tmpPortretId).value);if(h){var n=a.byId("picked_memberlist-"+this.tmpPortretId);if(n){this.dropDown.removeMember(n);var g=n.options;for(var d=0;d<g.length;d++){(function(j,i){j.selected=true})(g[d],d)}this.dropDown.addMember(a.byId("member_to-"+this.tmpPortretId),a.byId("picked_memberlist-"+this.tmpPortretId))}}k.innerHTML=e},_openDropDown:function(){var f=this.dropDown;var g=f.domNode.style.width;var k=this;var c;var j=window.navigator.userAgent.toLowerCase();if(j.indexOf("chrome")>-1){c=document.body.scrollTop}dijit.popup.open({parent:this,popup:f,around:this.domNode,orient:this.isLeftToRight()?{BL:"TL",BR:"TR",TL:"BL",TR:"BR"}:{BR:"TR",BL:"TL",TR:"BR",TL:"BL"},onExecute:function(){k._closeDropDown(true)},onCancel:function(){k._closeDropDown(true)},onClose:function(){aipo.calendar.populateWeeklySchedule(k.tmpPortretId);f.domNode.style.width=g;k.popupStateNode.removeAttribute("popupActive");this._opened=false}});if(this.domNode.offsetWidth>f.domNode.offsetWidth){var d=null;if(!this.isLeftToRight()){d=f.domNode.parentNode;var b=d.offsetLeft+d.offsetWidth}a.marginBox(f.domNode,{w:this.domNode.offsetWidth});if(d){d.style.left=b-this.domNode.offsetWidth+"px"}}this.popupStateNode.setAttribute("popupActive","true");this._opened=true;if(f.focus){f.focus()}if(j.indexOf("chrome")>-1||(a.isFF&&(a.isFF>=3.6))){var i=this.dropDown.domNode.parentNode;var h=i.style.top.replace("px","");top_new=parseInt(h)+window.scrollY;i.style.top=top_new+"px";if(j.indexOf("chrome")>-1){var e=document.activeElement;document.activeElement.blur();e.focus();top_new=a.byId("adduser-"+this.tmpPortretId).getBoundingClientRect().top+document.body.scrollTop+20;i.style.top=top_new+"px";document.body.scrollTop=c}}if(a.isIE&&(a.isIE==11)){var i=this.dropDown.domNode.parentNode;var h=i.style.top.replace("px","");top_new=parseInt(h)-window.pageYOffset;i.style.top=top_new+"px"}},_onDropDownClick:function(c){var b=a.byId("groupselect-"+this.tmpPortretId);if(b&&b.value.indexOf("pickup")==-1){return false}aimluck.widget.Dropdown.prototype._onDropDownClick.call(this,c)}})}}});