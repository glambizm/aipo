if(!dojo._hasResource["aipo.calendar.weekly"]){dojo._hasResource["aipo.calendar.weekly"]=true;dojo.provide("aipo.calendar.weekly");dojo.require("aimluck.dnd.Draggable");dojo.require("aipo.widget.ToolTip");dojo.require("aipo.widget.MemberNormalSelectList");dojo.require("aipo.widget.GroupNormalSelectList");aipo.calendar.objectlist=Array();aipo.calendar.maximum_to=30;function hasClass(b,a){return b.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))}function addClass(b,a){if(!this.hasClass(b,a)){b.className+=" "+a}}function removeClass(c,a){if(hasClass(c,a)){var b=new RegExp("(\\s|^)"+a+"(\\s|$)");c.className=c.className.replace(b," ")}}aipo.calendar.changeDisypayPeriod=function(l,g){var c=dojo.byId("weeklyHeadRights-"+g).children;var e=dojo.byId("weeklyTermRights-"+g).children;var h=dojo.byId("weeklyRights-"+g).children;dojo.byId("view_type_"+g).value=l;var j=dojo.byId("indicateDate_"+g);for(var f=0;f<7;f++){var b=c[f];var d=h[f];var a=e[f];var m=dojo.byId("scheduleDivAdd0"+f+"_"+g);switch(l){case"1":if(j){j.innerHTML="<span>1日</span>"}d.className="weeklyRight";if(f==0){b.className="weeklyHeadRightR weeklyHeadRightborder"+f+"_"+g;b.style.width="100%";d.style.width="100%";a.style.width="100%";addClass(a,"weeklyTermRightR");m.style.width="100%"}else{b.className="weeklyHeadRight weeklyHeadRightborder"+f+"_"+g;b.style.width="0%";b.style.display="none";d.style.width="0%";d.style.display="none";a.style.width="0%";a.style.display="none";removeClass(a,"weeklyTermRightR");m.style.width="0%";m.style.display="none"}break;case"4":if(j){j.innerHTML="<span>4日</span>"}if(f==0){removeClass(a,"weeklyTermRightR")}if(f<=3){b.style.width="25%";b.style.left=f*25+"%";b.style.display="";d.style.width="25%";d.style.left=f*25+"%";d.style.display="";a.style.width="25%";a.style.left=f*25+"%";a.style.display="";m.style.width="25%";m.style.left=f*25+"%";m.style.display="";if(f<3){b.className="weeklyHeadRight weeklyHeadRightborder"+f+"_"+g}else{if(f==3){b.className="weeklyHeadRightR weeklyHeadRightborder"+f+"_"+g;d.className="weeklyRightR";addClass(a,"weeklyTermRightR")}}}else{b.className="weeklyHeadRight weeklyHeadRightborder"+f+"_"+g;b.style.width="0%";b.style.display="none";d.style.width="0%";d.style.display="none";a.style.width="0%";a.style.display="none";removeClass(a,"weeklyTermRightR");m.style.width="0%";m.style.display="none"}break;case"7":if(j){j.innerHTML="<span>7日</span>"}b.style.left=f*(100/7)+"%";b.style.display="";b.style.width="14.2857%";d.style.left=f*(100/7)+"%";d.style.display="";d.style.width="14.2857%";a.style.left=f*(100/7)+"%";a.style.display="";a.style.width="14.2857%";m.style.left=f*(100/7)+"%";m.style.display="";m.style.width="14.2857%";if(f==0){removeClass(a,"weeklyTermRightR")}if(f<6){b.className="weeklyHeadRight weeklyHeadRightborder"+f+"_"+g;d.className="weeklyRight";removeClass(a,"weeklyTermRightR")}else{b.className="weeklyHeadRightR weeklyHeadRightborder"+f+"_"+g;d.className="weeklyRightR";addClass(a,"weeklyTermRightR")}}}};aipo.schedule.scrollNeeds=[];aipo.schedule.scrollPositions={};aipo.calendar.populateWeeklySchedule=function(e,f){var c;var d=dojo.byId("member_to-"+e);if(typeof f=="undefined"||typeof ptConfig[e].jsonData=="undefined"){c=""}else{c=f}var b=dojo.byId("secid-"+e);if(b){c+="&secid="+b.value}if(c.match(/ign_dup_f/)==null){if(d){var g=d.options;to_size=g.length;if(to_size==0){c+="&m_id="+aipo.schedule.login_id;c+="&m_empty=empty";dojo.byId("calender_m_empty_"+e).style.display=""}else{c+="&m_empty=";dojo.byId("calender_m_empty_"+e).style.display="none"}for(i=0;i<to_size;i++){g[i].selected=true;c+="&m_id="+g[i].value}}var a=dojo.byId("showAll-"+e);if(a){c+="&s_all="+a.value}}djConfig.usePlainJson=true;ptConfig[e].reloadFunction=aipo.calendar.populateWeeklySchedule;ptConfig[e].isTooltipEnable=false;if(aipo.calendar.dummyDivObj){aipo.calendar.dummyDivObj.destroy();aipo.calendar.dummyDivObj=null}if(dojo.byId("groupselect-"+e).value.indexOf("pickup")!=-1){c+="&pickup=true"}if(ptConfig[e].xhrUrl!=ptConfig[e].jsonUrl+c){ptConfig[e].xhrUrl=ptConfig[e].jsonUrl+c;dojo.xhrGet({portletId:e,url:ptConfig[e].jsonUrl+c,encoding:"utf-8",handleAs:"json-comment-filtered",load:function(S,T){ptConfig[e].xhrUrl="";if(aipo.calendar.reloadMonthlyCalendar!=null){aipo.calendar.reloadMonthlyCalendar()}obj_error=dojo.byId("error-"+e);dojo.style(obj_error,"display","none");if("PermissionError"==S[0]){dojo.style(obj_error,"display","block");obj_error.innerHTML=S[1];obj_content=dojo.byId("content-"+e);dojo.style(obj_content,"display","none");obj_indicator=dojo.byId("indicator-"+e);dojo.style(obj_indicator,"display","none");return}else{if(S.errList){if("duplicate_facility"==S.errList[0]){if(confirm("既に同じ時間帯に設備が予約されています。スケジュールを登録しますか？")){var v=c+"&ign_dup_f=true";aipo.calendar.populateWeeklySchedule(e,v);aipo.portletReload("schedule",e);return}}if("UpdateError"==S.errList[0]){dojo.style(obj_error,"display","block");obj_error.innerHTML='<ul><li><span class="caution">'+S.errList[1]+"</span></li></ul>";obj_content=dojo.byId("content-"+e);dojo.style(obj_content,"visibility","visible");obj_indicator=dojo.byId("indicator-"+e);dojo.style(obj_indicator,"display","none")}}}var P;if(!!aipo.calendar.objectlist){var E=aipo.calendar.objectlist.length;for(P=0;P<E;P++){var l=aipo.calendar.objectlist[P];if(l.portletId==e){l.destroy()}}}if(!aipo.errorTreatment(S,ptConfig[e].thisUrl)){return}ptConfig[e].jsonData=S;var q=Array(ptConfig[e].scheduleDivDaySum);for(var P=0;P<ptConfig[e].scheduleDivDaySum;P++){q[P]=Array()}var N=0;var n=0;var o=0;var F="";var L="";var w="";var y="";var M=[];var B,A,z,x;var O=S.startDate.substring(0,4)+"年"+parseInt(S.startDate.substring(5,7),10)+"月"+parseInt(S.startDate.substring(8,10),10)+"日"+S.dayOfWeek[0];dojo.byId("viewWeekly-"+e).innerHTML=O;var G="";var s="";var m=dojo.byId("top_form_"+this.portletId).value=="simple";var C=dojo.byId("view_type_"+this.portletId).value=="1";var h=dojo.byId("view_type_"+this.portletId).value=="4";var K=window.navigator.userAgent.toLowerCase().indexOf("ipad")>=0;if(m&&C){G="width: 100%;";s="width: 0%;display: none;"}w+='<table id="termTable_'+this.portletId+'" style="width:100%;" cellspacing="0" cellpadding="0" border="0"><tbody>';dojo.query(".weeklyTermTailTd_"+e).style("display","none");var t=dojo.byId("weeklyScrollPane_"+this.portletId);dojo.forEach(S.termSchedule,function(V){var W="";var aa="";if(m&&(C||h)){W=' style="display: none;"';o++;for(k=0;k<V.length;k++){Y=V[k];if(Y.index==0||(m&&h&&Y.index<4)){W="";aa=" weeklyTermRightR";o--;break}}}var Y=null;var X=scheduleTooltipEnable!==true&&m&&C?"border-right:0":"";if(scheduleTooltipEnable!==true&&m&&C){w+="<tr"+W+'><td colspan="2" nowrap="nowrap" width="100%" height="17px" valign="top"><div class="weeklyTermRights">'}else{w+="<tr"+W+'><td nowrap="nowrap" width="100%" height="17px" valign="top"><div class="weeklyTermRights">'}if(m&&h){w+='<div class="_weeklyHeadRightborder0_'+e+" weeklyTermRight weeklyTermRightL"+aa+'" id="termDay0-'+n+"-"+e+'" style="width: 25%;left: 0%;'+G+X+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder1_'+e+' weeklyTermRight" id="termDay1-'+n+"-"+e+'" style="width: 25%;left: 25%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder2_'+e+' weeklyTermRight" id="termDay2-'+n+"-"+e+'" style="width: 25%;left: 50%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder3_'+e+' weeklyTermRight weeklyTermRightR" id="termDay3-'+n+"-"+e+'" style="width: 25%;left: 75%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder4_'+e+' weeklyTermRight" id="termDay4-'+n+"-"+e+'" style="left: 57.1429%;display:none;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder5_'+e+' weeklyTermRight" id="termDay5-'+n+"-"+e+'" style="left: 71.4286%;display:none;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder6_'+e+' weeklyTermRight weeklyTermRightR" id="termDay6-'+n+"-"+e+'" style="left: 85.7143%;display:none;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';y+='<div id="termScheduleItemGarage-'+n+"-"+e+'" class="weeklyTermRights" style="top:'+(-(17*(n-o+1)))+'px"> </div>'}else{w+='<div class="_weeklyHeadRightborder0_'+e+" weeklyTermRight weeklyTermRightL"+aa+'" id="termDay0-'+n+"-"+e+'" style="left: 0%;'+G+X+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder1_'+e+' weeklyTermRight" id="termDay1-'+n+"-"+e+'" style="left: 14.2857%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder2_'+e+' weeklyTermRight" id="termDay2-'+n+"-"+e+'" style="left: 28.5714%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder3_'+e+' weeklyTermRight" id="termDay3-'+n+"-"+e+'" style="left: 42.8571%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder4_'+e+' weeklyTermRight" id="termDay4-'+n+"-"+e+'" style="left: 57.1429%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder5_'+e+' weeklyTermRight" id="termDay5-'+n+"-"+e+'" style="left: 71.4286%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';w+='<div class="_weeklyHeadRightborder6_'+e+' weeklyTermRight weeklyTermRightR" id="termDay6-'+n+"-"+e+'" style="left: 85.7143%;'+s+'"><div class="weeklyTermRightTop">&nbsp;</div></div>';y+='<div id="termScheduleItemGarage-'+n+"-"+e+'" class="weeklyTermRights" style="top:'+(-(17*(n-o+1)))+'px"> </div>'}var Z;w+="</div></td></tr>";n++});w+="</tbody></table>";var u=(17*(n-o+1));var H=(-(17*(n-o+1)));dojo.byId("termScheduleGarage-"+e).innerHTML=w;dojo.byId("termScheduleContainer-"+e).innerHTML=y;dojo.byId("weeklyTermLeftTopTall-"+e).style.height=(17*(n-o))+"px";for(var P=0;P<ptConfig[e].scheduleDivDaySum;P++){B=dojo.byId("weeklyDay"+P+"-"+e);A=dojo.byId("weeklyHoliday"+P+"-"+e);z=dojo.byId("weeklyRight"+P+"-"+e);x=dojo.byId("termDay"+P+"-"+e);var r=dojo.byId("weeklyDay"+P+"_element_a-"+e);r.innerHTML=parseInt(S.date[P].substring(8,10),10)+S.dayOfWeek[P];if(location.href.toString().toLowerCase().indexOf((e+"?action=controls.Maximize").toLowerCase())>0){r.outerHTML=r.outerHTML.toString().split(/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/).join(S.date[P].substring(0,10)).split("ScheduleScreen").join("ScheduleListScreen")}else{r.outerHTML=r.outerHTML.toString().split(/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/).join(S.date[P].substring(0,10))}A.innerHTML=S.holiday[P];var J=S.today+"-00-00";if(S.dayOfWeek[P]=="(土)"){dojo.addClass(B,"saturday");dojo.addClass(A,"saturday");dojo.addClass(z,"saturday");dojo.addClass(x,"saturday")}else{dojo.removeClass(B,"saturday");dojo.removeClass(A,"saturday");dojo.removeClass(z,"saturday");dojo.removeClass(x,"saturday")}if(S.dayOfWeek[P]=="(日)"){dojo.addClass(B,"sunday");dojo.addClass(A,"sunday");dojo.addClass(z,"sunday");dojo.addClass(x,"sunday")}else{dojo.removeClass(B,"sunday");dojo.removeClass(A,"sunday");dojo.removeClass(z,"sunday");dojo.removeClass(x,"sunday")}if(S.holiday[P]){dojo.addClass(B,"holiday");dojo.addClass(A,"holiday");dojo.addClass(z,"holiday");dojo.addClass(x,"holiday")}else{dojo.removeClass(B,"holiday");dojo.removeClass(A,"holiday");dojo.removeClass(z,"holiday");dojo.removeClass(x,"holiday")}if(J==S.date[P]){dojo.addClass(B,"today");dojo.addClass(A,"today");dojo.addClass(z,"today");dojo.addClass(x,"today")}else{dojo.removeClass(B,"today");dojo.removeClass(A,"today");dojo.removeClass(z,"today");dojo.removeClass(x,"today")}}dojo.forEach(S.schedule,function(aj){var V=ptConfig[e].rowHeight;var ag=aj.startDateHour*V*2+aj.startDateMinute*V/30;var ai=aj.endDateHour*V*2+aj.endDateMinute*V/30-ag;if(ai<=V){M[N]=ai;ai=V}else{M[N]=-1}var aa=100/ptConfig[e].scheduleDivDaySum*aj.index;var Y=100/ptConfig[e].scheduleDivDaySum*0.9;var W=aj.name;var Z=M[N]==-1?((aj.startDateHour>9)?aj.startDate:"0"+aj.startDate):aj.name;var ae=M[N]==-1?((aj.endDateHour>9)?aj.endDate:"0"+aj.endDate):"";var ad=M[N]==-1?"-":"";var af=aj.scheduleId;var ah="0";var ab="";var X=dojo.byId("member_to-"+e);if(X){var ac=X.options;for(P=0;P<ac.length;P++){if(((aj.type=="U")&&(aj.ownerId==ac[P].value))||((aj.type=="F")&&(aj.ownerId==ac[P].value))){ah=P%aipo.calendar.maximum_to}}var ab;if(aj.userCount>1){ab="[共有]"}if(aj.facilityCount>0){ab+="[設備]"}}if(!aj["public"]){W='<i class="auiIcon auiIconSecret" title="非公開"></i>\n'+W}W+='\n<span class="inline-block">';if(aj.duplicate){W+='<i class="auiIcon auiIconOverlap" title="重複スケジュール"></i>'}if(aj.repeat){W+='<i class="auiIcon auiIconRepeat" title="繰り返し"></i>'}if(aj.tmpreserve){W+='<i class="auiIcon auiIconTmpreserve" title="仮スケジュール"></i>'}W+="</span>";F+='<div id="schedule-'+N+"-"+e+'" class="scheduleDiv color'+ah+'" style="top: '+ag+"px; left: "+aa+"%; height: "+(ai-1)+"px; width: "+Y+'%;z-index: 0; visibility: hidden; border-right-style:none;"><div class="scheduleDivFirstLine color'+ah+'"><span id="scheduleDivStartTime-'+N+"-"+e+'" class="scheduleDivTime color'+ah+'">'+ab+Z+'</span><span id="scheduleDivSepalater-'+N+"-"+e+'"  class="scheduleDivSepalater color'+ah+'">'+ad+'</span><span id="scheduleDivEndTime-'+N+"-"+e+'" class="scheduleDivTime color'+ah+'">'+ae+'</span></div><div class="scheduleDivRightLine color'+ah+'"></div><div style="overflow: hidden;" class="scheduleDivName color'+ah+'">'+W+'</div><div class="scheduleDivLastLine color'+ah+'"><div class="scheduleDivRightLine color'+ah+'"></div><center><div class="handleDiv color'+ah+'" align="center">&nbsp;</div></center></div></div>';N++});F+='<div id="dummy_div_'+e+'" class="scheduleDivAdd dummy_div" style=" position:absolute; width: 0px; height : 0px; left: 0px; top: -10000px; Filter: Alpha(Opacity=10);opacity:.10; background-color:#FFFFFF; ">&nbsp;</div>';dojo.byId("scheduleGarage-"+e).innerHTML=F;var I=null;var Q,j;var D=[];N=0;dojo.forEach(S.schedule,function(W){Q=dojo.byId("schedule-"+N+"-"+e);var V=W.scheduleId;I=new aipo.calendar.WeeklyScheduleDraggable(Q,{pid:e,sid:'"schedule-'+N+"-"+e+'"',handle:'"dummy_div_-'+e+'"'});aipo.calendar.objectlist.push(I);if(W.member||W.loginuser||W.owner||W["public"]){I.setDraggable(true)}else{I.setDraggable(false)}I.schedule=W;I.tmpIndex=W.index;I.count=N;I.tmpHeight=M[N];I.position=0;I.division=1;I.portletId=e;q[W.index].push(Q);if(W["public"]||W.member){dojo.connect(Q,"onclick",I,"onScheduleClick");dojo.connect(Q,"onmouseover",I,"onScheduleOver")}N++});for(var P=0;P<ptConfig[e].scheduleDivDaySum;P++){aipo.calendar.relocation(e,q[P].length,q[P],100/ptConfig[e].scheduleDivDaySum*P);q[P]=Array()}N=0;n=0;dojo.forEach(S.termSchedule,function(ae){var ai=null;var X=S.today+"-00-00";L="";for(var ad=0;ad<ptConfig[e].scheduleDivDaySum;ad++){tmpNode5=dojo.byId("termDay"+ad+"-"+n+"-"+e);if(S.dayOfWeek[ad]=="(土)"){dojo.addClass(tmpNode5,"saturday")}else{dojo.removeClass(tmpNode5,"saturday")}if(S.dayOfWeek[ad]=="(日)"){dojo.addClass(tmpNode5,"sunday")}else{dojo.removeClass(tmpNode5,"sunday")}if(S.holiday[ad]){dojo.addClass(tmpNode5,"holiday")}else{dojo.removeClass(tmpNode5,"holiday")}if(X==S.date[ad]){dojo.addClass(tmpNode5,"today")}else{dojo.removeClass(tmpNode5,"today")}}for(k=0;k<ae.length;k++){ai=ae[k];if(m&&h){var ag=ai.rowspan;if(ai.rowspan+ai.index>4){ag=ag-(ai.rowspan+ai.index-4)}var Y=25*ag;var aa=25*ai.index;if(ai.index>4){Y=0}}else{var Y=100/ptConfig[e].scheduleDivDaySum*ai.rowspan;var aa=100/ptConfig[e].scheduleDivDaySum*ai.index}var Z="";if(m&&C){Y=100;Z=((ai.index==0)?"":"display: none;")}var V=ai.name;var af=ai.scheduleId;var ah="0";var ab="";var W=dojo.byId("member_to-"+e);if(W){var ac=W.options;for(ad=0;ad<ac.length;ad++){if(((ai.type=="U")&&(ai.ownerId==ac[ad].value))||((ai.type=="F")&&(ai.ownerId==ac[ad].value))){ah=ad%aipo.calendar.maximum_to}}var ab;if(ai.userCount>1){ab="[共有]"}if(ai.facilityCount>0){ab+="[設備]"}}V=ab+V;if(!ai["public"]){V='<i class="auiIcon auiIconSecret" title="非公開"></i>\n'+V}V+='\n<span class="inline-block">';if(ai.duplicate){V+='<i class="auiIcon auiIconOverlap" title="重複スケジュール"></i>'}if(ai.repeat){V+='<i class="auiIcon auiIconRepeat" title="繰り返し"></i>'}if(ai.tmpreserve){V+='<i class="auiIcon auiIconTmpreserve" title="仮スケジュール"></i>'}V+="</span>";if(Y==100){Y="99.99999"}L+='<div id="termSchedule-'+N+"-"+e+'" class="termScheduleDiv termColor'+ah+'" style="left: '+aa+"%; width: "+Y+"%;"+Z+'"><div class="termScheduleDivHandleLeft" id="termScheduleDivHandleLeft-'+N+"-"+e+'">&nbsp;</div><div class="termScheduleDivNameDiv">'+V+'</div><div class="termScheduleDivHandleRight" id="termScheduleDivHandleRight-'+N+"-"+e+'">&nbsp;</div></div>';N++}dojo.byId("termScheduleItemGarage-"+n+"-"+e).innerHTML=L;n++});tableLeft=dojo.byId("weeklyTermLeft_"+e);I=null;N=0;n=0;dojo.forEach(S.termSchedule,function(V){var X=null;for(k=0;k<V.length;k++){X=V[k];var W=X.scheduleId;Q=dojo.byId("termSchedule-"+N+"-"+e);j=dojo.byId("termScheduleDivHandleLeft-"+N+"-"+e);draggable3=dojo.byId("termScheduleDivHandleRight-"+N+"-"+e);I=new aipo.calendar.WeeklyTermScheduleDraggable(Q,{pid:e,sid:"termSchedule-"+N+"-"+e});aipo.calendar.objectlist.push(I);I.schedule=X;I.scheduleNode=Q;I.portletId=e;I.termType="center";dojo.connect(Q,"onclick",I,"onScheduleClick");Q.style.zIndex=1;if(X.indexReal>=0){tmpDraggable2=new aipo.calendar.WeeklyTermScheduleDraggable(j,{pid:e,sid:"termScheduleDivHandleLeft-"+N+"-"+e});aipo.calendar.objectlist.push(tmpDraggable2);tmpDraggable2.schedule=X;tmpDraggable2.scheduleNode=Q;tmpDraggable2.portletId=e;tmpDraggable2.termType="left";if(X.member||X.loginuser||X.owner||X["public"]){tmpDraggable2.setDraggable(true)}else{tmpDraggable2.setDraggable(false)}}else{dojo.style(j,"cursor","pointer");j.style.zIndex=1}dojo.connect(j,"onclick",I,"onScheduleClick");if(X.indexReal+X.colspanReal<=ptConfig[e].scheduleDivDaySum){tmpDraggable3=new aipo.calendar.WeeklyTermScheduleDraggable(draggable3,{pid:e,sid:"termScheduleDivHandleRight-"+N+"-"+e});aipo.calendar.objectlist.push(tmpDraggable3);tmpDraggable3.schedule=X;tmpDraggable3.scheduleNode=Q;tmpDraggable3.portletId=e;tmpDraggable3.termType="right";if(X.member||X.loginuser||X.owner||X["public"]){tmpDraggable3.setDraggable(true)}else{tmpDraggable3.setDraggable(false)}}else{dojo.style(draggable3,"cursor","pointer");draggable3.style.zIndex=1}if(X.member||X.loginuser||X.owner||X["public"]){dojo.connect(draggable3,"onclick",I,"onScheduleClick");dojo.connect(Q,"onmouseover",I,"onScheduleOver")}if(X.member||X.loginuser||X.owner||X["public"]){I.setDraggable(true)}else{I.setDraggable(false)}N++}n++});obj_content=dojo.byId("content-"+e);dojo.style(obj_content,"visibility","visible");obj_indicator=dojo.byId("indicator-"+e);dojo.style(obj_indicator,"display","none");dojo.removeClass(dojo.byId("tableWrapper_"+e),"hide");var t=dojo.byId("weeklyScrollPane_"+e);if((t.clientWidth==t.offsetWidth)&&!(K&&!m)){if(dojo.byId("weeklySpan-"+e)!=null){dojo.byId("weeklySpan-"+e).style.display="none"}dojo.query(".weeklyTermTailTd_"+e).style("display","none");if(dojo.byId("termTable_"+e)!=null){dojo.query("termTable_"+e).style("width","99.9999%")}if(m&&C){dojo.query(".weeklyHeadRightborder0_"+e).style("border-right-style","none");dojo.query("._weeklyHeadRightborder0_"+e).style("border-right-style","none");dojo.byId("weeklyRight0-"+e).style.borderRightStyle="";if(K){if(dojo.byId("weeklyRight0-"+e).className.indexOf("sunday")>=0||dojo.byId("weeklyRight0-"+e).className.indexOf("saturday")>=0){dojo.query(".scroll_width").style("padding-right","1px")}else{dojo.query(".scroll_width").style("padding-right","0px")}dojo.query(".weeklyTableHead").style("padding-right","1px")}else{dojo.query(".weeklyTableHead").style("padding-right","1px")}}else{if(m&&h){if(K){dojo.query(".weeklyTableHead").style("padding-right","0px");dojo.query(".scroll_width").style("padding-right","0px")}else{dojo.byId("weeklyRight3-"+e).style.borderRightStyle="none";dojo.query(".weeklyHeadRightborder3_"+e).style("border-right-style","none");dojo.query("._weeklyHeadRightborder3_"+e).style("border-right-style","none");dojo.query(".weeklyTableHead").style("padding-right","1px")}}else{if(K){dojo.query(".scroll_width").style("padding-right","0px");dojo.query(".weeklyTableHead").style("padding-right","0px")}else{if(window.navigator.userAgent.toLowerCase().indexOf("chrome")>=0&&(dojo.byId("weeklyRight6-"+e).className.indexOf("sunday")>=0||dojo.byId("weeklyRight6-"+e).className.indexOf("saturday"))>=0){dojo.query(".scroll_width").style("padding-right","1px");dojo.query(".weeklyTableHead").style("padding-right","1px")}else{dojo.query(".scroll_width").style("padding-right","0px");dojo.query(".weeklyTableHead").style("padding-right","0px")}dojo.byId("weeklyRight6-"+e).style.borderRightStyle="none";dojo.query(".weeklyHeadRightborder6_"+e).style("border-right-style","none");dojo.query("._weeklyHeadRightborder6_"+e).style("border-right-style","none")}}}}else{if(t.clientWidth!=t.offsetWidth&&t.offsetWidth-t.clientWidth!=18){if(dojo.byId("weeklySpan-"+e)!=null){dojo.byId("weeklySpan-"+e).width=(t.offsetWidth-t.clientWidth+1)+"px"}dojo.query(".weeklyTermTailTd_"+e).width=(t.offsetWidth-t.clientWidth+1)+"px";dojo.query(".weeklyTermTail").style("width",((t.offsetWidth-t.clientWidth+1)+"px"))}}if(n==0){dojo.byId("termScheduleContainer-"+e).style.height="0px"}else{}dojo.byId("weeklyTableHead_"+e).style.marginTop="0px";var U=dojo.byId("weeklyTableHead_"+e).offsetHeight;var R=dojo.byId("weeklyTermTr_"+e).offsetHeight;U+=0;U-=R;R-=R%17;U+=R;dojo.byId("weeklyTableHeadWrapper_"+e).style.overflow="hidden";dojo.byId("weeklyTableHeadWrapper_"+e).style.height=U+"px";if(n>0){var p=0;for(p=0;p<7;p++){if(dojo.byId("termDay"+p+"-"+(n-1)+"-"+e).className.indexOf("sunday")>=0||dojo.byId("termDay"+p+"-"+(n-1)+"-"+e).className.indexOf("saturday")>=0){dojo.byId("termDay"+p+"-"+(n-1)+"-"+e).style.height="95%"}}}if(!ptConfig[e].isScroll){if(dojo.byId("portletsBody").style.display=="none"){aipo.schedule.scrollNeeds.push(e)}else{dojo.byId("weeklyScrollPane_"+e).scrollTop=ptConfig[e].contentScrollTop;ptConfig[e].isScroll=true}aipo.schedule.scrollPositions[e]=null}ptConfig[e].isTooltipEnable=true;dojo.byId("termScheduleDivAdd_"+e).style.height=u+"px";dojo.byId("termScheduleDivAdd_"+e).style.top=H+"px";dojo.query(".weeklyTermTailTd_"+e).style("display","")}})}};aipo.calendar.relocation=function(b,a,v,w){var r,q;var u=0.95;var m=95/7;var t=0;var l=0;var g=0;var f=0;var h=new Array(a);var c=new Array(a);var s=new Array(a);var n=1;var o=0;if(dojo.byId("view_type_"+b).value=="1"&&dojo.byId("top_form_"+b).value=="simple"){n=7.2}else{if(dojo.byId("view_type_"+b).value=="4"){n=1.75;if(w>57){w=100}}}v.sort(aipo.calendar.sortByRegion);for(r=0;r<a;r++){v[r].style.zIndex=r+1}for(r=0;r<a;r=t){t=aipo.calendar.overlapSchedule(v,r,r,++t,a);if(g<parseInt(dojo.getComputedStyle(v[r]).top)){f=r;g=parseInt(dojo.getComputedStyle(v[f]).top);l=0}for(q=f;q<t;q++){var e=parseInt(dojo.getComputedStyle(v[q]).top)+parseInt(dojo.getComputedStyle(v[q]).height)}if(g<e){g=e}for(q=f;q<t;q++){c[q]=aipo.calendar.positionLeft(v,c,f,q,0);if(c[q]>l){l=c[q]}}for(q=f;q<t;q++){s[q]=aipo.calendar.positionRight(v,c,l,f,q)}for(q=f;q<t;q++){h[q]=l}}for(r=0;r<a;r++){var p;var d;if(h[r]!=0){if(c[r]<c[r+1]){p=(m*2/(h[r]+1))*0.8*u*n}else{if(s[r]==0){p=(m-(m/(h[r]+1))*c[r])*u*n}else{p=(m-(m/(h[r]+1))*c[r]-(m*2/(h[r]+1))*0.2-(m/(h[r]+1))*(s[r]-1))*u*n}}}else{p=m*u*n}d=(w+((m/(h[r]+1))*c[r]))*n;if(d+p>100){p=100-d;if(p<0){p=0}}dojo.style(v[r],"width",p+"%");dojo.style(v[r],"left",d+"%");dojo.style(v[r],"visibility","visible")}};aipo.calendar.overlapSchedule=function(d,b,h,g,c){var f=parseInt(dojo.getComputedStyle(d[b]).top)+parseInt(dojo.getComputedStyle(d[b]).height);var e=parseInt(dojo.getComputedStyle(d[h]).top)+parseInt(dojo.getComputedStyle(d[h]).height);var a;if(d[g]){a=parseInt(dojo.getComputedStyle(d[g]).top)}else{a="NaN"}if((g>c-1)||(f<a)||(e<a)){return g}else{g=aipo.calendar.overlapSchedule(d,b,g,++g,c)}g=aipo.calendar.overlapSchedule(d,b,h,g,c);return g};aipo.calendar.positionLeft=function(f,e,h,g,b){var a=parseInt(dojo.getComputedStyle(f[g]).top);for(i=h;i<g;i++){var d=parseInt(dojo.getComputedStyle(f[i]).top);var c=d+parseInt(dojo.getComputedStyle(f[i]).height);if((d<=a)&&(c>a)&&(e[i]==b)){b=aipo.calendar.positionLeft(f,e,h,g,++b)}}return b};aipo.calendar.positionRight=function(a,e,g,d,h){var f=0;var c=parseInt(dojo.getComputedStyle(a[h]).top);for(i=d;i<h;i++){var b=parseInt(dojo.getComputedStyle(a[i]).top);var j=b+parseInt(dojo.getComputedStyle(a[i]).height);if((b<=c)&&(j>c)&&(e[i]>e[h])&&((g-e[i]+1)>f)){f=g-e[i]+1}}return f};aipo.calendar.sortByRegion=function(e,d){var h=parseInt(dojo.getComputedStyle(e).top);var g=parseInt(dojo.getComputedStyle(d).top);var c=h+parseInt(dojo.getComputedStyle(e).height);var f=c+parseInt(dojo.getComputedStyle(d).height);if(h==g){return f-c}else{return h-g}};aipo.calendar.getDate=function(a,b){tmpYear=parseInt(a.substring(0,4),10);tmpMonth=parseInt(a.substring(5,7),10);tmpDay=parseInt(a.substring(8,10),10);if(b>0){do{tmpMonthDays=aipo.calendar.getDay(tmpYear,tmpMonth);if(tmpDay+b<=tmpMonthDays){tmpDay=tmpDay+b;if((tmpMonth<10)&&(tmpDay<10)){date=tmpYear+"-0"+tmpMonth+"-0"+tmpDay}else{if((tmpMonth<10)&&!(tmpDay<10)){date=tmpYear+"-0"+tmpMonth+"-"+tmpDay}else{if(!(tmpMonth<10)&&(tmpDay<10)){date=tmpYear+"-"+tmpMonth+"-0"+tmpDay}else{date=tmpYear+"-"+tmpMonth+"-"+tmpDay}}}b=-1}else{b=b-(tmpMonthDays-tmpDay)-1;if(tmpMonth==12){tmpYear++;tmpMonth=1}else{tmpMonth++}tmpDay=1}}while(b>=0)}else{if(b<0){do{if(tmpDay+b>0){tmpDay=tmpDay+b;if((tmpMonth<10)&&(tmpDay<10)){date=tmpYear+"-0"+tmpMonth+"-0"+tmpDay}else{if((tmpMonth<10)&&!(tmpDay<10)){date=tmpYear+"-0"+tmpMonth+"-"+tmpDay}else{if(!(tmpMonth<10)&&(tmpDay<10)){date=tmpYear+"-"+tmpMonth+"-0"+tmpDay}else{date=tmpYear+"-"+tmpMonth+"-"+tmpDay}}}b=1}else{if(tmpMonth==1){tmpYear--;tmpMonth=12}else{tmpMonth--}tmpMonthDays=aipo.calendar.getDay(tmpYear,tmpMonth);b=b+tmpDay;tmpDay=tmpMonthDays}}while(b<=0)}else{date=a}}return date};aipo.calendar.getDay=function(a,b){if(b==2){if(!(a%4)&&((a%100)||!(a%400))){return 29}else{return 28}}else{if(b==4||b==6||b==9||b==11){return 30}else{return 31}}};aipo.calendar.setGridArray=function(c,b){var a=0;if(aipo.calendar.gridArray){delete (aipo.calendar.gridArray)}aipo.calendar.gridArray=new Array(b);for(i=0;i<b;i++){a=dojo._abs(dojo.byId("weeklyDay"+i+"-"+c),true).x;aipo.calendar.gridArray[i]=a}};aipo.calendar.getCurrentMouseX=function(d,f){if(aipo.calendar.gridArray==null){return{index:-1,x:0}}var b=aipo.calendar.gridArray[0];var h=0;var c;if(f.pageX>b){var a=parseInt(aipo.calendar.gridArray.length)-1;if(dojo.byId("view_type_"+d)&&dojo.byId("top_form_"+d).value=="simple"){a=parseInt(dojo.byId("view_type_"+d).value)-1}for(c=a;c>-1;c--){if(f.pageX>aipo.calendar.gridArray[c]){h=c;break}}}else{h=0}var g=aipo.calendar.gridArray[h]-b;return{index:h,x:g}};aipo.calendar.onCloseMemberpicker=function(a){aipo.calendar.populateWeeklySchedule(a)};aipo.calendar.showTooltip=function(d,f,a){var e="";var b="";var c="";var h="";var g=function(l){var j=function(m){switch(m){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&#39;";case'"':return"&quot;"}return"?"};return String(l).replace(/[<>&"']/g,j)};dojo.style(a,"display","block");if(ptConfig[f].xhrUrl!=d){ptConfig[f].xhrUrl=d;dojo.xhrGet({portletId:f,url:d,encoding:"utf-8",handleAs:"json-comment-filtered",load:function(p,n){ptConfig[f].xhrUrl="";if(!p.id){dojo.style(a,"display","none");return}if(!p.isSpan){e='<span style="font-size: 0.90em;">'+p.date+"</span><br/>"}if(p.memberList){var m=p.memberList.length;for(var j=0;j<m;j++){b+="<li>"+g(p.memberList[j].aliasName.value)+"</li>"}}if(p.facilityList){var l=p.facilityList.length;for(var j=0;j<l;j++){c+="<li>"+g(p.facilityList[j].facilityName.value)+"</li>"}}if(p.place!=""){h='<span style="font-size: 0.90em;">場所</span><br/><ul><li>'+p.place+"</li></ul>"}if(b!=""){b='<span style="font-size: 0.90em;">参加者</span><br/><ul>'+b+"</ul>"}if(c!=""){c='<span style="font-size: 0.90em;">設備</span><br/><ul>'+c+"</ul>"}var o="<h4>"+p.name+"</h4>"+e+b+c+h;a.innerHTML=o}})}};dojo.declare("aipo.calendar.DummyDivObject",null,{portletId:null,parentnode:null,draggable:null,TooltipObject:null,constructor:function(a,b){this.portletId=b.pid;this.parentnode=b.node;this.node=dojo.byId(a);this.events=[dojo.connect(this.node,"onmousedown",this,"onMouseDown"),dojo.connect(this.node,"onmouseover",this,"onMouseOver")]},onMouseDown:function(a){this.hide();if(this.parentnode==null||this.parentnode=="undefined"){return}if(this.draggable){this.draggable.onMouseDown(a)}},onMouseOver:function(a){if(this.parentnode==null||this.parentnode=="undefined"){return}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);this.events=this.node=this.handle=null},hide:function(){dojo.marginBox(this.node,{l:0,t:-10000,w:0,h:0})}});dojo.declare("aipo.calendar.WeeklyScheduleDragMoveObject",[aimluck.dnd.DragMoveObject],{_rowHeight_:18,isResize:false,distance:3,lastScroll:0,onFirstMove:function(b){if(this.dragSource.TooltipObject!=null){this.dragSource.TooltipObject.uninitialize()}var d=dojo.clone(this.node);d.id="schedule-dummy-"+this.portletId;d.style.zIndex=998;dojo.style(d,"opacity",0);var c=dojo.byId("scheduleGarage-"+this.portletId);c.appendChild(d);this.tmpDraggable=d;dojo.connect(this.node,"onmousedown",this,"onMouseDown");if(dojo.isIE<=8&&dojo.isIE>0){document.onkeydown=function(f){dojo.style(d,"opacity",0.3)};document.onkeyup=function(f){dojo.style(d,"opacity",0)}}else{dojo.connect(null,"onkeydown",this,"onKeyPress");dojo.connect(null,"onkeyup",this,"onKeyPress")}aimluck.dnd.DragMoveObject.prototype.onFirstMove.apply(this,arguments);dojo.style(this.node,"opacity",0.5);this.node.style.zIndex=999;this.startY=this._pageY;this.startAbsoluteY=dojo._abs(dojo.byId(this.node),true).y;var a=window.navigator.userAgent.toLowerCase();if(a.indexOf("chrome")>-1||(dojo.isFF&&(dojo.isFF>=3.6))){this.startAbsoluteY+=window.scrollY}else{if(a.indexOf("safari")>-1){this.startAbsoluteY-=dojo.byId("weeklyScrollPane_"+this.portletId).scrollTop}}this.startHeight=parseInt(dojo.getComputedStyle(this.node).height);this.startTop=parseInt(dojo.getComputedStyle(this.node).top);if(this.startHeight-6<this.startY-this.startAbsoluteY){this.isResize=true}aipo.calendar.setGridArray(this.portletId,parseInt(ptConfig[this.portletId].scheduleDivDaySum));lastScroll=dojo.byId("weeklyScrollPane_"+this.portletId).scrollTop},onKeyPress:function(a){if(a.ctrlKey){dojo.style(this.tmpDraggable,"opacity",0.3)}else{dojo.style(this.tmpDraggable,"opacity",0)}},onMouseMove:function(j){if(this.dragSource.isDraggable==false){return}aimluck.dnd.DragMoveObject.prototype.onMouseMove.apply(this,arguments);this.dragSource.schedule.isDrag=true;if(this.dragSource.tmpHeight>3){dojo.style(this.node,"height",this.dragSource.tmpHeight+"px");this.dragSource.tmpHeight=3}var a=ptConfig[this.portletId].distance;var c=dojo.byId("weeklyScrollPane_"+this.portletId).scrollTop-lastScroll;this.leftTop.t=Math.floor((this.leftTop.t+c)/a)*a;if(this.isResize){if(-this.startTop+this.leftTop.t+this.startHeight<0){dojo.style(this.node,"height","0px");this.leftTop.t+=this.startHeight}else{var m;if(this.leftTop.t+this.startHeight>864){m=864-this.startTop-3}else{m=-this.startTop+this.leftTop.t+this.startHeight}this.leftTop.t=this.startTop;this.leftTop.h=parseInt(m)-1}}else{if(!this.disableY){if(this.leftTop.t<0){this.leftTop.t=0}if(this.leftTop.t+this.startHeight>864){this.leftTop.t=864-this.startHeight-6}}}if(!this.disableX){mouseX=aipo.calendar.getCurrentMouseX(this.portletId,j);this.leftTop.l=mouseX.x;this.dragSource.schedule.index=mouseX.index}dojo.marginBox(this.node,this.leftTop);var l=parseInt(dojo.getComputedStyle(this.node).top);var h=parseInt(dojo.getComputedStyle(this.node).height)+1;var g=l/a;var f=Math.floor(g/12);var d=Math.floor(g%12);f=(f>9)?f:"0"+f;d=(d>1)?d*(60/12):"0"+d*(60/12);var b=this.dragSource.count;dojo.byId("scheduleDivStartTime-"+b+"-"+this.portletId).innerHTML=f+":"+d;this.dragSource.schedule.startDateHour=f;this.dragSource.schedule.startDateMinute=d;this.dragSource.schedule.startDate=f+":"+d;g+=h/a;f=Math.floor(g/12);d=Math.floor(g%12);f=(f>9)?f:"0"+f;d=(d>1)?d*(60/12):"0"+d*(60/12);dojo.byId("scheduleDivEndTime-"+b+"-"+this.portletId).innerHTML=f+":"+d;this.dragSource.schedule.endDateHour=f;this.dragSource.schedule.endDateMinute=d;this.dragSource.schedule.endDate=f+":"+d;dojo.byId("scheduleDivSepalater-"+b+"-"+this.portletId).innerHTML="-";return},onMouseUp:function(b){ptConfig[this.portletId].isTooltipEnable=true;if(dojo.isIE<=8&&dojo.isIE>0){document.onkeydown="";document.onkeyup=""}if(this.dragSource.schedule.isDrag!=true){dojo.style(this.node,"opacity",1);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments);return}var a=parseInt(dojo.getComputedStyle(this.node).height);if(a<ptConfig[this.portletId].rowHeight){dojo.style(this.node,"height",ptConfig[this.portletId].rowHeight+"px");this.dragSource.tmpHeight=a}else{this.dragSource.tmpHeight=-1}var c="";if(b.ctrlKey){c+="&mode=insert"}else{c+="&mode=update"}c+="&entityid="+this.dragSource.schedule.scheduleId;c+="&view_start="+ptConfig[this.portletId].jsonData.date[0].substring(0,10);if(this.dragSource.schedule.repeat){c+="&edit_repeat_flag=1";c+="&view_date="+ptConfig[this.portletId].jsonData.date[this.dragSource.tmpIndex].substring(0,10)}c+="&start_date="+ptConfig[this.portletId].jsonData.date[this.dragSource.schedule.index].substring(0,11)+this.dragSource.schedule.startDateHour+"-"+this.dragSource.schedule.startDateMinute;c+="&end_date="+ptConfig[this.portletId].jsonData.date[this.dragSource.schedule.index].substring(0,11)+this.dragSource.schedule.endDateHour+"-"+this.dragSource.schedule.endDateMinute;aipo.calendar.populateWeeklySchedule(this.portletId,c);aipo.portletReload("schedule",this.portletId);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments);this.dragSource.destroy()}});dojo.declare("aipo.calendar.WeeklyScheduleDraggable",[aimluck.dnd.Draggable],{DragMoveObject:aipo.calendar.WeeklyScheduleDragMoveObject,isDraggable:false,scheduleObjId:null,constructor:function(a,b){this.scheduleObjId=b.sid},onMouseDown:function(a){ptConfig[this.portletId].isTooltipEnable=false;if(!!aipo.calendar.dummyDivObj&&!!aipo.calendar.dummyDivObj.TooltipObject){aipo.calendar.dummyDivObj.TooltipObject.close()}aimluck.dnd.Draggable.prototype.onMouseDown.apply(this,arguments)},onScheduleClick:function(b){if(this.schedule.isDrag||!this.isDraggable){return}var a=this.schedule.ownerId;aipo.common.showDialog(ptConfig[this.portletId].detailUrl+"&entityId="+this.schedule.scheduleId+"&view_date="+ptConfig[this.portletId].jsonData.date[this.schedule.index]+"&userid="+a,this.portletId,aipo.schedule.onLoadScheduleDetail);aipo.schedule.tmpScroll=parseInt(dojo.byId("weeklyScrollPane_"+this.portletId)["scrollTop"])},onScheduleOver:function(a){if(ptConfig[this.portletId].isTooltipEnable==false){return}if(scheduleTooltipEnable){this.setupTooltip(a)}},setupTooltip:function(c){var a=this.schedule.scheduleId;var b=ptConfig[this.portletId].jsonData.endDate;if(!this.TooltipObject){this.TooltipObject=new aipo.widget.ToolTip({label:"<div class='indicator'>読み込み中...</div>",connectId:[this.node.id]},this.portletId,function(d,f){var e=ptConfig[this.portletId].jsonUrl.split("?")[0]+"?template=ScheduleDetailJSONScreen&view_date="+b+"&scheduleid="+a;aipo.calendar.showTooltip(e,this.portletId,d)});this.TooltipObject._onHover(c)}aipo.calendar.objectlist.push(this.TooltipObject)},setDraggable:function(a){this.isDraggable=a}});dojo.declare("aipo.calendar.WeeklyTermScheduleDragMoveObject",[aimluck.dnd.DragMoveObject],{positionFrom:-1,positionTo:-1,moveIndex:0,onFirstMove:function(a){if(this.dragSource.TooltipObject!=null){this.dragSource.TooltipObject.uninitialize()}aimluck.dnd.DragMoveObject.prototype.onFirstMove.apply(this,arguments);dojo.style(this.node,"opacity",0.5);aipo.calendar.setGridArray(this.portletId,parseInt(ptConfig[this.portletId].scheduleDivDaySum));var c=dojo.clone(this.node);c.id="schedule-dummy-"+this.portletId;c.style.zIndex=998;dojo.style(c,"opacity",0);var b=dojo.byId(this.node.parentNode.id);b.appendChild(c);this.tmpDraggable=c;if(dojo.isIE<=8&&dojo.isIE>0){document.onkeydown=function(d){dojo.style(c,"opacity",0.3)};document.onkeyup=function(d){dojo.style(c,"opacity",0)}}else{dojo.connect(null,"onkeydown",this,"onKeyPress");dojo.connect(null,"onkeyup",this,"onKeyPress")}},onKeyPress:function(a){if(a.ctrlKey){dojo.style(this.tmpDraggable,"opacity",0.3)}else{dojo.style(this.tmpDraggable,"opacity",0)}},onMouseMove:function(h){if(this.dragSource.isDraggable==false){return}aimluck.dnd.DragMoveObject.prototype.onMouseMove.apply(this,arguments);this.dragSource.schedule.isDrag=true;var a=ptConfig[this.portletId].distance;var o=(dojo.byId("view_type_"+this.portletId)&&dojo.byId("top_form_"+this.portletId)&&dojo.byId("top_form_"+this.portletId).value=="simple")?dojo.byId("view_type_"+this.portletId).value:ptConfig[this.portletId].scheduleDivDaySum;var g=aipo.calendar.getCurrentMouseX(this.portletId,h);_tmpIndex=g.index;if(!this.disableX){var d=this.dragSource.schedule;var j=this.dragSource.termType;var m=this.dragSource.scheduleNode;var l,c;if(j=="center"){if(this.positionFrom==-1&&_tmpIndex!=-1){this.positionFrom=_tmpIndex;this.positionTo=this.positionFrom}if(this.positionTo!=-1&&_tmpIndex!=-1){this.positionTo=_tmpIndex}this.moveIndex=-this.positionFrom+this.positionTo;c=d.indexReal+this.moveIndex;l=d.colspanReal;var n=o;if(l+c>n){if(c<0){l=n}else{l=n-c}}else{if(c<0){l=l+c}}if(c<0){c=0}}else{if(j=="left"){if(this.positionFrom==-1){this.positionFrom=d.index;this.positionTo=d.index}if(this.positionTo!=-1&&_tmpIndex!=-1){this.positionTo=_tmpIndex}this.moveIndex=-this.positionFrom+this.positionTo;if(this.positionTo>=this.positionFrom+d.colspanReal){c=d.indexReal+d.rowspan-1;l=this.positionTo-this.positionFrom-d.colspanReal+2}else{c=this.positionTo;l=d.rowspan+this.positionFrom-this.positionTo}}else{if(this.positionFrom==-1){this.positionFrom=d.index;this.positionTo=d.index}if(this.positionTo!=-1&&_tmpIndex!=-1&&this._tmpIndex!=-1){this.positionTo=_tmpIndex}this.moveIndex=-d.index-d.rowspan+this.positionTo+1;if(this.positionTo<=this.positionFrom){c=this.positionTo;l=this.positionFrom-this.positionTo+1}else{c=d.index;l=this.positionTo-d.index+1}}}var b=100/o*l;var f=100/o*c;dojo.style(m,"left",f+"%");dojo.style(m,"width",b+"%")}},onMouseUp:function(f){ptConfig[this.portletId].isTooltipEnable=true;if(dojo.isIE<=8&&dojo.isIE>0){document.onkeydown="";document.onkeyup=""}if(this.dragSource.schedule.isDrag!=true){dojo.style(this.node,"opacity",1);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments);return}var b=this.dragSource.schedule;var j=ptConfig[this.portletId].jsonData.date[0].substring(0,10);var c=this.dragSource.termType;var h=this.dragSource.scheduleNode;var a,d;if(dojo.byId("top_form_"+this.portletId).value=="simple"){a=ptConfig[this.portletId].jsonData.date[0];d=ptConfig[this.portletId].jsonData.date[0]}if(c=="center"){a=aipo.calendar.getDate(j,b.indexReal+this.moveIndex)+"-00-00";d=aipo.calendar.getDate(j,b.indexReal+this.moveIndex+b.colspanReal-1)+"-00-00"}else{if(c=="left"){if(b.colspanReal-this.moveIndex>0){a=aipo.calendar.getDate(j,b.indexReal+this.moveIndex)+"-00-00";d=aipo.calendar.getDate(j,b.indexReal+b.colspanReal-1)+"-00-00"}else{a=aipo.calendar.getDate(j,b.indexReal+b.colspanReal-1)+"-00-00";d=aipo.calendar.getDate(j,b.indexReal+this.moveIndex)+"-00-00"}}else{if(b.colspanReal+this.moveIndex>0){a=aipo.calendar.getDate(j,b.indexReal)+"-00-00";d=aipo.calendar.getDate(j,b.indexReal+b.colspanReal+this.moveIndex-1)+"-00-00"}else{a=aipo.calendar.getDate(j,b.indexReal+b.colspanReal+this.moveIndex-1)+"-00-00";d=aipo.calendar.getDate(j,b.indexReal)+"-00-00"}}}this.positionFrom=-1;this.positionTo=-1;this.moveIndex=0;this.tmpIndex=0;var g="";if(f.ctrlKey){g+="&mode=insert"}else{g+="&mode=update"}g+="&is_span=TRUE";g+="&entityid="+this.dragSource.schedule.scheduleId;g+="&view_start="+j;g+="&start_date="+a;g+="&end_date="+d;aipo.calendar.populateWeeklySchedule(this.portletId,g);aipo.portletReload("schedule",this.portletId);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments)}});dojo.declare("aipo.calendar.WeeklyTermScheduleDraggable",[aimluck.dnd.Draggable],{DragMoveObject:aipo.calendar.WeeklyTermScheduleDragMoveObject,isDraggable:false,TooltipObject:null,scheduleObjId:null,isDraggable:false,constructor:function(a,b){this.scheduleObjId=b.sid},onMouseDown:function(a){ptConfig[this.portletId].isTooltipEnable=false;if(this.TooltipObject){this.TooltipObject.close()}aimluck.dnd.Draggable.prototype.onMouseDown.apply(this,arguments)},onScheduleClick:function(b){if(this.schedule.isDrag||!this.isDraggable){return}var a=this.schedule.ownerId;aipo.common.showDialog(ptConfig[this.portletId].detailUrl+"&entityId="+this.schedule.scheduleId+"&view_date="+ptConfig[this.portletId].jsonData.date[this.schedule.index]+"&userid="+a,this.portletId,aipo.schedule.onLoadScheduleDetail);aipo.schedule.tmpScroll=parseInt(dojo.byId("weeklyScrollPane_"+this.portletId)["scrollTop"])},onScheduleOver:function(a){if(ptConfig[this.portletId].isTooltipEnable==false){return}if(scheduleTooltipEnable){this.setupTooltip(a)}},setupTooltip:function(c){var a=this.schedule.scheduleId;var b=ptConfig[this.portletId].jsonData.endDate;if(!this.TooltipObject){this.TooltipObject=new aipo.widget.ToolTip({label:"<div class='indicator'>読み込み中...</div>",connectId:[this.node.id]},this.portletId,function(d,f){var e=ptConfig[this.portletId].jsonUrl.split("?")[0]+"?template=ScheduleDetailJSONScreen&view_date="+b+"&scheduleid="+a;aipo.calendar.showTooltip(e,this.portletId,d)});this.TooltipObject._onHover(c)}aipo.calendar.objectlist.push(this.TooltipObject)},setDraggable:function(a){this.isDraggable=a}});dojo.declare("aipo.calendar.WeeklyScheduleAddDragMoveObject",[aimluck.dnd.DragMoveObject],{_rowHeight_:18,positionFrom:0,positionTo:0,_isDragging:false,lastScroll:0,_isLocked:false,onMouseDown:function(a){this._isDragging=false;aimluck.dnd.DragMoveObject.prototype.onMouseDown.apply(this,arguments)},onFirstMove:function(b){this.startY=this.dragSource._lastY;this.startAbsoluteY=dojo._abs(dojo.byId(this.node),true).y;this.startX=dojo.getComputedStyle(this.node).left;var a=window.navigator.userAgent.toLowerCase();if(a.indexOf("chrome")>-1||(dojo.isFF&&(dojo.isFF>=3.6))){this.startAbsoluteY+=window.scrollY}else{if(a.indexOf("safari")>-1){this.startAbsoluteY-=dojo.byId("weeklyScrollPane_"+this.portletId).scrollTop}}lastScroll=dojo.byId("weeklyScrollPane_"+this.portletId).scrollTop;aimluck.dnd.DragMoveObject.prototype.onFirstMove.apply(this,arguments)},onMouseMove:function(g){if(this._isLocked){return}aimluck.dnd.DragMoveObject.prototype.onMouseMove.apply(this,arguments);this._isDragging=true;var f=dojo.byId("weeklyScrollPane_"+this.portletId).scrollTop-lastScroll;var d=Math.floor((this.startY-this.startAbsoluteY)/this._rowHeight_);var a=Math.floor((this.startY+this.leftTop.t-this.startAbsoluteY+f)/this._rowHeight_);var b=0;var c=0;if(a<d){b=a*this._rowHeight_+1;c=(d-a+1)*this._rowHeight_;this.positionFrom=a;this.positionTo=d+1}else{b=d*this._rowHeight_+1;c=(a-d+1)*this._rowHeight_;this.positionTo=a+1;this.positionFrom=d}if(b+c>864){c=864-b-this._rowHeight_;this.positionTo=47}this.leftTop.t=b;this.leftTop.l=this.startX;this.leftTop.h=c;dojo.marginBox(this.node,this.leftTop);dojo.style(this.node,"opacity",0.5)},onMouseUp:function(f){if(!this._isDragging){this.onFirstMove(f);this.onMouseMove(f)}var a=Math.floor(this.positionFrom/2);a=(a>9)?a:"0"+a;var g=Math.floor(this.positionFrom%2)*30;var c=ptConfig[this.portletId].jsonData.date[this.dragSource.index].substring(0,10);var d=c+"-"+a+"-"+g;a=Math.floor(this.positionTo/2);a=(a>9)?a:"0"+a;g=Math.floor(this.positionTo%2)*30;var b=c+"-"+a+"-"+g;this.node.style.top="0px";this.node.style.height="864px";dojo.style(this.node,"opacity",0);if(this._isDragging==true){aipo.common.showDialog(ptConfig[this.portletId].formUrl+"&entityid=new&mode=form&form_start="+d+"&form_end="+b,this.portletId,aipo.schedule.onLoadScheduleDialog)}aipo.schedule.tmpScroll=parseInt(dojo.byId("weeklyScrollPane_"+this.portletId)["scrollTop"]);this._isDragging=false;aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments);this._isLocked=true;setTimeout(function(){this._isLocked=false},5000)}});dojo.declare("aipo.calendar.WeeklyScheduleAddDraggable",[aimluck.dnd.Draggable],{DragMoveObject:aipo.calendar.WeeklyScheduleAddDragMoveObject,constructor:function(a,b){this.index=b.idx}});dojo.declare("aipo.calendar.WeeklyTermScheduleAddDragMoveObject",[aimluck.dnd.DragMoveObject],{_rowHeight_:18,positionFrom:-1,positionTo:-1,_isDragging:false,scheduleObjId:null,onMouseDown:function(a){this._isDragging=false;aimluck.dnd.DragMoveObject.prototype.onMouseDown.apply(this,arguments)},onFirstMove:function(a){aimluck.dnd.DragMoveObject.prototype.onFirstMove.apply(this,arguments);aipo.calendar.setGridArray(this.portletId,parseInt(ptConfig[this.portletId].scheduleDivDaySum))},onMouseMove:function(h){aimluck.dnd.DragMoveObject.prototype.onMouseMove.apply(this,arguments);this._isDragging=true;dojo.style(this.node,"opacity",0.5);var c=aipo.calendar.getCurrentMouseX(this.portletId,h);var j=c.index;if(this.positionFrom==-1&&j!=-1){this.positionFrom=j;this.positionTo=this.positionFrom}if(this.positionTo!=-1&&j!=-1){this.positionTo=j}if(this.positionTo!=-1&&this.positionFrom!=-1){var b,a;if(this.positionTo>this.positionFrom){a=this.positionFrom;b=this.positionTo-this.positionFrom+1}else{a=this.positionTo;b=this.positionFrom-this.positionTo+1}var f;var g;if(dojo.byId("view_type_"+this.portletId)&&dojo.byId("top_form_"+this.portletId).value=="simple"){var d=parseInt(dojo.byId("view_type_"+this.portletId).value);f=100/d*b;g=100/d*a}else{f=100/ptConfig[this.portletId].scheduleDivDaySum*b;g=100/ptConfig[this.portletId].scheduleDivDaySum*a}dojo.style(this.node,"left",g+"%");dojo.style(this.node,"width",f+"%")}else{dojo.style(this.node,"left",0+"%");dojo.style(this.node,"width",0+"%")}},onMouseUp:function(d){if(!this._isDragging){this.onFirstMove(d);this.onMouseMove(d)}var f,c;if(this.positionTo!=-1&&this.positionFrom!=-1){if(this.positionTo>this.positionFrom){f=this.positionFrom;c=this.positionTo}else{c=this.positionFrom;f=this.positionTo}var b=ptConfig[this.portletId].jsonData.date[f];var a=ptConfig[this.portletId].jsonData.date[c];if(this._isDragging==true){aipo.common.showDialog(ptConfig[this.portletId].formUrl+"&entityid=new&mode=form&is_span=TRUE&form_start="+b+"&form_end="+a,this.portletId,aipo.schedule.onLoadScheduleDialog)}aipo.schedule.tmpScroll=parseInt(dojo.byId("weeklyScrollPane_"+this.portletId)["scrollTop"])}this.positionFrom=-1;this.positionTo=-1;dojo.style(this.node,"left",0+"%");dojo.style(this.node,"width",100+"%");dojo.style(this.node,"opacity",0);aimluck.dnd.DragMoveObject.prototype.onMouseUp.apply(this,arguments)}});dojo.declare("aipo.calendar.WeeklyTermScheduleAddDraggable",[aimluck.dnd.Draggable],{DragMoveObject:aipo.calendar.WeeklyTermScheduleAddDragMoveObject,constructor:function(a,b){this.index=b.idx}});aipo.schedule.initCalendar=function(b){for(var a=0;a<ptConfig[b].scheduleDivDaySum;a++){tmpDraggable=new aipo.calendar.WeeklyScheduleAddDraggable("scheduleDivAdd0"+a+"_"+b,{idx:a});tmpDraggable.portletId=b;tmpDraggable.index=a}tmpDraggable=new aipo.calendar.WeeklyTermScheduleAddDraggable("termScheduleDivAdd_"+b,{idx:0});tmpDraggable.portletId=b;aipo.calendar.populateWeeklySchedule(b)};aipo.schedule.groupSelectOnchange=function(d,g,h,a){var l=function(q,p){var o="";a.dropDown.removeMember(dojo.byId("member_to-"+h));for(var n=0;n<q.length;n++){var m=q[n].aliasName.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(n!=0){o+=" "}b+="&m_id="+q[n].name;var e=n%aipo.calendar.maximum_to;o+='<span class="dispUser color'+e+'">'+m+"</span>";aimluck.io.addOption(dojo.byId("member_to-"+h),q[n].name,m,true)}dojo.byId("member_to_input-"+h).innerHTML=o};var f=dojo.query("#adduser-"+h);switch(d.value.indexOf("pickup")){case -1:f.addClass("hide");var b="";dojo.xhrGet({portletId:h,url:d.value,encoding:"utf-8",handleAs:"json-comment-filtered",load:l,handle:function(){aipo.calendar.populateWeeklySchedule(h,b)}});break;default:f.removeClass("hide");a.dropDown.removeMember(dojo.byId("member_to-"+h));a.dropDown.removeMember(dojo.byId("tmp_member_to-"+h));var j=dojo.byId("picked_memberlist-"+h).options;for(var c=0;c<j.length;c++){(function(m,e){m.selected=true})(j[c],c)}a.dropDown.addMember(dojo.byId("picked_memberlist-"+h),dojo.byId("tmp_member_to-"+h));a.dropDown.addMember(dojo.byId("picked_memberlist-"+h),dojo.byId("member_to-"+h));a.inputMemberSync();aipo.calendar.populateWeeklySchedule(h);dojo.xhrGet({portletId:h,url:dojo.byId("groupselect-defaulturl-"+h).value,encoding:"utf-8",handleAs:"json-comment-filtered"});break}}};