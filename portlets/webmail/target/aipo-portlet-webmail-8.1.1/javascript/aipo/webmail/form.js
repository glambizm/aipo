dojo.provide("aipo.webmail");dojo.require("aipo.widget.DropdownDatepicker");aipo.webmail.onLoadMailDialog=function(a){var b=dojo.byId("to");if(b){b.focus()}};aipo.webmail.onLoadMailAccountDialog=function(a){var b=dojo.byId("account_name");if(b){b.focus()}};aipo.webmail.onLoadMailFolderDialog=function(a){var b=dojo.byId("folder_name");if(b){b.focus()}};aipo.webmail.onLoadMailFilterDialog=function(a){var b=dojo.byId("filter_name");if(b){b.focus()}};aipo.webmail.onReceiveMessage=function(d){var a=dojo.byId("attachments_select");if(typeof a!="undefined"&&a!=null){a.parentNode.removeChild(a)}if(!d){var b=dijit.byId("modalDialog");if(b){b.hide()}aipo.portletReload("webmail")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=d}var c=document.getElementById("modalDialog");if(c&&d!=""){var e=document.getElementById("wrapper");e.style.minHeight=c.clientHeight+"px"}};aipo.webmail.hideDialog=function(){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("webmail")};aipo.webmail.onLoadMailListDetail=function(){aipo.portletReload("webmail")};aipo.webmail.ajaxDeleteSubmit=function(b,a,c,d,e){if(confirm("この"+b.form._name.value+"を削除してよろしいですか？なお、フォルダに含まれるメールはすべて削除されます。\nまた、このフォルダを振り分け先として指定してあるフィルタは、振り分け先がデフォルト（フォルダリストの一番上のフォルダ）に変更されます。")){aimluck.io.disableForm(b.form,true);aimluck.io.setHiddenValue(b);b.form.action=a;aimluck.io.submit(b.form,c,d,e)}};var mailReceviingTimerId;aipo.webmail.onProcessingTimer=function(){if(mailReceviingTimerId){clearTimeout(mailReceviingTimerId)}mailReceviingTimerId=setTimeout("aipo.webmail.reloadMail()",10000)};aipo.webmail.reloadMailList=function(a){if(typeof ptConfig[a].reloadUrl!="undefined"){ptConfig[a].reloadUrl+="&updateunread=1"}aipo.reloadPage(a)};aipo.webmail.reloadMail=function(){var d=dojo.byId("receiving");if(d){var c=d.value;var a=dojo.byId("page_start");if(a){c+="&start="+a.value}c+="&updateunread=1";var b=dojo.byId("receivingPid");aipo.viewPage(c,b.value);aipo.webmail.onProcessingTimer()}};aipo.webmail.open_help=function(a){wx=400;wy=250;x=(screen.width-wx)/2;y=(screen.height-wy)/2;help_subwin=window.open(a,"help_window","left="+x+",top="+y+",width="+wx+",height="+wy+",resizable=no");help_subwin.opener=self;help_subwin.focus()};aipo.webmail.switchHeader=function(a,c){var b=dojo.byId("is_header_tiny");if(b.value=="TRUE"||b.value=="true"){a.innerHTML="簡易表示";aipo.webmail.switchHeaderDetail()}else{a.innerHTML="詳細表示";aipo.webmail.switchHeaderTiny()}};aipo.webmail.switchHeaderTiny=function(){var a=dojo.byId("is_header_tiny");dojo.byId("WebMailHeaderFieldTiny").style.display="";dojo.byId("WebMailHeaderFieldDetail").style.display="none";a.value="TRUE"};aipo.webmail.switchHeaderDetail=function(){var a=dojo.byId("is_header_tiny");dojo.byId("WebMailHeaderFieldTiny").style.display="none";dojo.byId("WebMailHeaderFieldDetail").style.display="";a.value="FALSE"};aipo.webmail.doDeleteAccount=function(a,b){if(confirm("このメールアカウントを削除してもよろしいですか？\n保存されているメールはすべて削除されます。")){aipo.viewPage(a,b)}};aipo.webmail.doDeleteFilter=function(a,b){if(confirm("このフィルタを削除してもよろしいですか？")){aipo.viewPage(a,b)}};aipo.webmail.AccountChange=function(d,a,f){var e=a;var c=d.account_type;for(i=0;i<c.length;i++){if(c[i].checked){var b=c[i].value}}e+="&account_type="+b;aipo.viewPage(e,f)};aipo.webmail.onReceiveMessageAdmin=function(b){if(!b){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("webmailadmin")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=b}};aipo.webmail.onDeleteAdminAccount=function(a){if(!a){aipo.portletReload("webmailadmin")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=a}};aipo.webmail.hideDialogAdmin=function(){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("webmailadmin")};aipo.webmail.switchDelAtPop3=function(a){if(a.value==0){dojo.byId("del_at_pop3_flg_on_field").style.display=""}else{dojo.byId("del_at_pop3_flg_on_field").style.display="none"}};aipo.webmail.switchAuthSendAdmin=function(a){if(a.value==2){dojo.byId("smtp_auth_field").style.display="";dojo.byId("pop_auth_field").style.display="none"}else{if(a.value==1){dojo.byId("smtp_auth_field").style.display="none";dojo.byId("pop_auth_field").style.display=""}else{dojo.byId("smtp_auth_field").style.display="none";dojo.byId("pop_auth_field").style.display="none"}}};aipo.webmail.switchAuthSend=function(a){if(a.value==2){dojo.byId("smtp_auth_field").style.display=""}else{dojo.byId("smtp_auth_field").style.display="none"}};aipo.webmail.showAddressbookDialog=function(b,d,e,f){var c=dijit.byId("addressbookDialog");if(!c){c=new aipo.webmail.widget.AddressbookDialog({widgetId:"addressbookDialog",_portlet_id:d,_callback:f},"addressbookDialog")}else{c.setCallback(d,f)}if(c){c.setHref(b);c.show();var a=dojo.byId(e+d);a.parentNode.parentNode.style.display="none";a.parentNode.parentNode.id="tmp_pop_id"}};aipo.webmail.onLoadAddressbookDialog=function(a){var c=dojo.byId("urlUserlist"+a).value;aipo.webmail.changeInternalGroup(c,"LoginUser");var b=dojo.byId("urlAddrlist"+a).value;aipo.webmail.changeExternalGroup(b,"");aipo.webmail.getDataSub(dojo.byId("detail_to_recipients"),dojo.byId("to").value);aipo.webmail.getDataSub(dojo.byId("detail_cc_recipients"),dojo.byId("cc").value);aipo.webmail.getDataSub(dojo.byId("detail_bcc_recipients"),dojo.byId("bcc").value)};aipo.webmail.getDataSub=function(b,a){if(a==null||a.length==0){return}var c=a.split(",");for(i=0;i<c.length;i++){add_option(b,aipo.webmail.trim(c[i]),aipo.webmail.trim(c[i]),false)}};aipo.webmail.insertData=function(){dojo.byId("to").value=aipo.webmail.getStringLine(dojo.byId("detail_to_recipients").options);dojo.byId("cc").value=aipo.webmail.getStringLine(dojo.byId("detail_cc_recipients").options);dojo.byId("bcc").value=aipo.webmail.getStringLine(dojo.byId("detail_bcc_recipients").options);dijit.byId("addressbookDialog").hide();var a=dojo.byId("tmp_pop_id");a.style.display="";a.id=""};aipo.webmail.close=function(){dijit.byId("addressbookDialog").hide();var a=dojo.byId("tmp_pop_id");a.style.display="";a.id=""};aipo.webmail.switchTypeCompany=function(a){if(a.value=="1"){dojo.byId("Block_Internal_Group").style.display="block";dojo.byId("Block_External_Group").style.display="none";dojo.byId("userDiv").style.display="block";dojo.byId("addrDiv").style.display="none"}else{dojo.byId("Block_Internal_Group").style.display="none";dojo.byId("Block_External_Group").style.display="block";dojo.byId("userDiv").style.display="none";dojo.byId("addrDiv").style.display="block"}};aipo.webmail.changeInternalGroup=function(a,b){aipo.webmail.createSelect("internal_member_from","userDiv",a+"?mode=group&groupname="+b+"&inc_luser=true","aliasName","email","","",'size="12" multiple="multiple" style="width: 99%"',"addresslist-indicator")};aipo.webmail.changeExternalGroup=function(a,b){aipo.webmail.createSelect("external_member_from","addrDiv",a+"?mode=group&groupname="+b+"&inc_luser=true","fullName","email","","",'size="12" multiple="multiple" style="width: 99%"',"addresslist-indicator")};aipo.webmail.createSelect=function(k,f,a,e,j,b,d,g,c){var h=dojo.byId(c);if(h){dojo.style(h,"display","")}dojo.xhrGet({url:a,timeout:10000,encoding:"utf-8",handleAs:"json-comment-filtered",headers:{X_REQUESTED_WITH:"XMLHttpRequest"},load:function(n,l){var m="";if(typeof g=="undefined"){m+='<select name="'+k+'">'}else{m+='<select name="'+k+'" '+g+"/>"}if(typeof d=="undefined"){m+=""}else{m+=d}dojo.forEach(n,function(o){if(typeof o[e]=="undefined"||typeof o[j]=="undefined"){}else{if(o[e]==b){m+="<option value='"+o[e]+"' selected='selected'>"+o[j]+"</option>"}else{m+="<option value='"+o[e]+"&lt;"+o[j]+"&gt;'>"+o[e]+"&lt;"+o[j]+"&gt;</option>"}}});m+="</select>";dojo.byId(f).innerHTML=m;if(h){dojo.style(h,"display","none")}}})};aipo.webmail.sendForm=function(){aipo.webmail.selectAll(document.WebMailAddressbook.detail_to_recipients);aipo.webmail.selectAll(document.WebMailAddressbook.detail_cc_recipients);aipo.webmail.selectAll(document.WebMailAddressbook.detail_bcc_recipients);document.WebMailAddressbook.submit()};aipo.webmail.getStringLine=function(a){var c="";if(a.length>0){var b=a.length-1;for(i=0;i<b;i++){c=c+a[i].value+","}c=c+a[b].value}return c};aipo.webmail.selectAll=function(a){var b=a.options;for(i=0;i<b.length;i++){b[i].selected=true}};aipo.webmail.exAddMember=function(c,a,b){if(dojo.byId("corpId"+b).checked==true){add_member(c.internal_member_from,a)}else{add_member(c.external_member_from,a)}};aipo.webmail.removeAll=function(a){if(document.all){var b=a.options;for(i=0;i<b.length;i++){b.remove(i);i-=1}}else{var b=a.options;for(i=0;i<b.length;i++){a.removeChild(b[i]);i-=1}}};aipo.webmail.ltrim=function(a){while(a.charAt(0)==" "||a.charAt(0)=="　"){a=a.substring(1,a.length)}return(a)};aipo.webmail.rtrim=function(a){while(a.charAt(a.length-1)==" "||a.charAt(a.length-1)=="　"){a=a.substring(0,a.length-1)}return(a)};aipo.webmail.trim=function(a){return aipo.webmail.ltrim(aipo.webmail.rtrim(a))};aipo.webmail.filter_order_submit=function(c){var a=c.filter_so.options;var b="";for(i=0;i<a.length;i++){a[i].selected=false}if(a.length>0){for(i=0;i<a.length-1;i++){b=b+a[i].value+","}b=b+a[a.length-1].value}c.positions.value=b};aipo.webmail.action=function(c,a){var b=dojo.byId(a+"_action").value;aimluck.io.openDialog(c,b,a,aipo.webmail.onLoadMailDialog)};aipo.webmail.toggleMenu=function(f,e,d){var c=e.getBoundingClientRect();var b=document.documentElement.getBoundingClientRect();if(f.style.display=="none"){dojo.query("div.menubar").style("display","none");var a={left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};f.style.opacity="0";f.style.display="block";if(b.right-f.clientWidth>c.left){f.style.left=c.left+a.left+"px"}else{f.style.left=c.right-f.clientWidth+a.left+"px"}if(b.bottom-f.clientHeight>c.bottom||d){f.style.top=c.bottom+a.top+"px"}else{f.style.top=c.top-f.clientHeight+a.top+"px"}f.style.opacity=""}else{dojo.query("div.menubar").style("display","none")}};