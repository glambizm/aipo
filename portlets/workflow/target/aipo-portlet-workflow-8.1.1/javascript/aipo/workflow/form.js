dojo.provide("aipo.workflow");var before=0;aipo.workflow.onLoadWorkflowDetail=function(a){aipo.portletReload("whatsnew")};aipo.workflow.toggleMenu=function(f,e,d){var c=e.getBoundingClientRect();var b=document.documentElement.getBoundingClientRect();if(f.style.display=="none"){dojo.query("div.menubar").style("display","none");var a={left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};f.style.opacity="0";setTimeout(function(){dojo.style(f,"display","block")},0);if(b.right-f.clientWidth>c.left){f.style.left=c.left+a.left+"px"}else{f.style.left=c.right-f.clientWidth+a.left+"px"}if(b.bottom-f.clientHeight>c.bottom||d){f.style.top=c.bottom+a.top+"px"}else{f.style.top=c.top-f.clientHeight+a.top+"px"}f.style.opacity=""}else{dojo.query("div.menubar").style("display","none")}};aipo.workflow.initFilterSearch=function(d){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;if(aipo.userAgent.isAndroid4_0()){var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left=a+"px";c.style.left=-a+"px";e.style.width=f-a+"px";b.style.width=f-a+"px";e.style.paddingLeft="2px"}else{if(a!=0){e.style.paddingLeft=a+"px"}}}};aipo.workflow.finFilterSearch=function(d){if(aipo.userAgent.isAndroid4_0()){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left="0px";c.style.left="0px";e.style.width=f+a+"px";b.style.width=f+a+"px";e.style.paddingLeft=a+2+"px"}}};aipo.workflow.filteredSearch=function(d){var b=dojo.byId("baseuri_"+d).value;var c=[];var f=[];dojo.query("ul.filtertype_"+d).forEach(function(h){var j=h.getAttribute("data-type");c.push(j);var g=dojo.query("li.selected",h)[0];if(g){var k=g.getAttribute("data-param");f.push(k)}else{f.push(h.getAttribute("data-defaultparam"))}});var e=dojo.byId("q"+d);var a=[["filter",f.join(",")],["filtertype",c.join(",")],["keyword",e?e.value:""]];aipo.viewPage(b,d,a)};aipo.workflow.filterSetDefault=function(e,d){var c=dojo.query("ul.filtertype[data-type="+d+"]")[0];var b=c.getAttribute("data-defaultparam");var a=dojo.query("li[data-param="+b+"]",c);aipo.workflow.filterSelect(c,a);aipo.workflow.filteredSearch(e)};aipo.workflow.filterSelect=function(b,a){dojo.query("li",b).removeClass("selected");dojo.query(a).addClass("selected")};aipo.workflow.filterClick=function(d,e,c){var a=e.parentNode;var b=a.parentNode;var f=a.getAttribute("data-param");aipo.msgboard.filterSelect(b,a);aipo.msgboard.filteredSearch(d)};aipo.workflow.onLoadWorkflowDialog=function(f){var d=dijit.byId("membernormalselect");if(d){var b=d;var a=dojo.byId("init_memberlist");var e;var c=a.options;if(c.length==1&&c[0].value==""){return}for(e=0;e<c.length;e++){b.addOptionSync(c[e].value,c[e].text,true)}}var g=dojo.byId("route_name");if(g){g.focus()}if(dojo.byId("mode_"+f).value=="insert"){dojo.byId("category_id").onchange()}};aipo.workflow.onChangeSelecter=function(d,c,b,a,f){dojo.byId(f).checked=false;var e=new Array();e.named="workflow_"+a;aimluck.io.sendRawData(c+"&value="+b,b,aipo.workflow.setTemplate,e);return false};aipo.workflow.setTemplate=function(h,c){var e=aipo.workflow.getJsonDataOne(c);var a=e.route_h;var b=e.route;var g=b.split(",");var f=(g.length-1)/2;if(b==null||b==""){dojo.byId(h.named).style.display="none"}else{dojo.byId(h.named).style.display=""}if(b==null||b==""){dojo.byId(h.named).innerHTML=""}else{dojo.byId(h.named).innerHTML=a}memberFrom=dojo.byId("tmp_member_from");memberFromOpts=memberFrom.options;for(i=0;i<memberFromOpts.length;i++){memberFromOpts[i].selected=false}memberTo=dojo.byId("positions");while(memberTo.lastChild){memberTo.removeChild(memberTo.lastChild)}var d;for(i=0;i<f;i++){memberTo.options[i]=new Option(g[2*i+1],g[2*i])}};aipo.workflow.categoryOnChangeSelecter=function(f,e,d,c,h,b,a){if(aipo.workflow.NoteChangeConfirm(h)){before=dojo.byId("category_id").selectedIndex;dojo.byId(h).checked=false;var g=new Array();g.named="workflow_"+c;g.namedRoute="workflow_"+b;g.selectRoute=a;aimluck.io.sendRawData(e+"&value="+d,d,aipo.workflow.categorySetTemplate,g)}else{dojo.byId("category_id").selectedIndex=before}return false};aipo.workflow.categorySetTemplate=function(d,e){var g=aipo.workflow.getJsonDataOne(e);var k=g.template;var f=g.route_id.toString();var h=g.route_h;var j=g.route;var b=j.split(",");var c=(b.length-1)/2;if(h==null||h==""){dojo.byId(d.namedRoute).style.display="none"}else{dojo.byId(d.namedRoute).style.display=""}if(null!=k){dojo.byId(d.named).value=k}else{dojo.byId(d.named).value=""}dojo.byId(d.namedRoute).value="";var m=dojo.byId(d.selectRoute);var l=m.options;l[0].selected=true;if(!(f.match(/[^0-9]/g)||parseInt(f,10)+""!=f)){for(i=0;i<m.length;i++){if(l[i].value==f){l[i].selected=true}}dojo.byId(d.namedRoute).value=h;dojo.byId("is_saved_route_button").value=aimluck.io.escapeText("workflow_val_route1");dojo.byId("workflowRouteSelectField").style.display="";dojo.byId("workflowRouteInputField").style.display="none";dojo.byId("is_saved_route").value="TRUE";memberTo=dojo.byId("positions");while(memberTo.lastChild){memberTo.removeChild(memberTo.lastChild)}memberFrom=dojo.byId("tmp_member_from");memberFromOpts=memberFrom.options;for(i=0;i<memberFromOpts.length;i++){memberFromOpts[i].selected=false}memberTo=dojo.byId("positions");var a;for(i=0;i<c;i++){memberTo.options[i]=new Option(b[2*i+1],b[2*i])}}};aipo.workflow.onFocusComment=function(a){};aipo.workflow.onChangeNote=function(){dojo.byId("isChangedNote").checked=true};aipo.workflow.NoteChangeConfirm=function(a){if(dojo.byId(a).checked){if(!confirm(aimluck.io.escapeText("workflow_val_confirm1"))){return false}}return true};aipo.workflow.onReceiveMessage=function(d){var a=dojo.byId("attachments_select");if(typeof a!="undefined"&&a!=null){a.parentNode.removeChild(a)}if(!d){var b=dijit.byId("modalDialog");if(b){b.hide()}aipo.portletReload("workflow");aipo.portletReload("whatsnew");aipo.portletReload("timeline")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=d}var c=document.getElementById("modalDialog");if(c&&d!=""){var e=document.getElementById("wrapper");e.style.minHeight=c.clientHeight+"px"}};aipo.workflow.onAccept=function(a){var b=dojo.byId("workflowForm"+a);aipo.workflow._portletId=a;b.mode.value="accept"};aipo.workflow.onDenial=function(a){var b=dojo.byId("workflowForm"+a);aipo.workflow._portletId=a;b.mode.value="denial"};aipo.workflow.onDelete=function(a){var b=dojo.byId("workflowForm"+a);aipo.workflow._portletId=a;b.mode.value="delete"};aipo.workflow.submit_list=function(c){var a=c.member_to.options;var b="";for(i=0;i<a.length;i++){a[i].selected=false}if(a.length>0){for(i=0;i<a.length-1;i++){b=b+a[i].value+","}b=b+a[a.length-1].value}c.positions.value=b};aipo.workflow.formSwitchRouteSelect=function(a){if(a.form.is_saved_route.value=="TRUE"||a.form.is_saved_route.value=="true"){a.value=aimluck.io.escapeText("workflow_val_route2");aipo.workflow.formRouteSelectOff(a.form)}else{a.value=aimluck.io.escapeText("workflow_val_route1");aipo.workflow.formRouteSelectOn(a.form)}};aipo.workflow.formRouteSelectOn=function(a){dojo.byId("workflowRouteSelectField").style.display="";dojo.byId("workflowRouteInputField").style.display="none";a.is_saved_route.value="TRUE"};aipo.workflow.formRouteSelectOff=function(a){dojo.byId("workflowRouteSelectField").style.display="none";dojo.byId("workflowRouteInputField").style.display="";a.is_saved_route.value="FALSE"};aipo.workflow.getJsonDataOne=function(rtnData){var cStartIdx=rtnData.type.indexOf("/*");var cEndIdx=rtnData.type.lastIndexOf("*/");var rawData=dojo.eval(rtnData.type.substring(cStartIdx+2,cEndIdx));var jsonData="";if(dojo.isArray(rawData)&&rawData.length>0){jsonData=rawData[0]}return jsonData};aipo.workflow.onChangeFilter=aipo.workflow.onChangeSearch=function(a,c){var b=encodeURIComponent(dojo.byId("q").value);a+="?template=WorkflowListScreen";a+="&filter="+dojo.byId("topic").value;a+="&filtertype=category";a+="&search="+b;aipo.viewPage(a,c)};