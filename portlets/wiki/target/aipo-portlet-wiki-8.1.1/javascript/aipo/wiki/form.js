dojo.provide("aipo.wiki");aipo.wiki.onLoadWikiDialog=function(a){var b=dojo.byId("wiki_name");if(b){b.focus()}};aipo.wiki.toggleMenu=function(f,e,d){var c=e.getBoundingClientRect();var b=document.documentElement.getBoundingClientRect();if(f.style.display=="none"){dojo.query("div.menubar").style("display","none");var a={left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};f.style.opacity="0";f.style.display="block";if(b.right-f.clientWidth>c.left){f.style.left=c.left+a.left+"px"}else{f.style.left=c.right-f.clientWidth+a.left+"px"}if(b.bottom-f.clientHeight>c.bottom||d){f.style.top=c.bottom+a.top+"px"}else{f.style.top=c.top-f.clientHeight+a.top+"px"}f.style.opacity=""}else{dojo.query("div.menubar").style("display","none")}};aipo.wiki.initFilterSearch=function(d){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;if(aipo.userAgent.isAndroid4_0()){var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left=a+"px";c.style.left=-a+"px";e.style.width=f-a+"px";b.style.width=f-a+"px";e.style.paddingLeft="2px"}else{if(a!=0){e.style.paddingLeft=a+"px"}}}};aipo.wiki.finFilterSearch=function(d){if(aipo.userAgent.isAndroid4_0()){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left="0px";c.style.left="0px";e.style.width=f+a+"px";b.style.width=f+a+"px";e.style.paddingLeft=a+2+"px"}}};aipo.wiki.filterSetDefault=function(e,d){var c=dojo.query("ul.filtertype[data-type="+d+"]")[0];var b=c.getAttribute("data-defaultparam");var a=dojo.query("li[data-param="+b+"]",c);aipo.wiki.filterSelect(c,a);aipo.wiki.filteredSearch(e)};aipo.wiki.filterSelect=function(b,a){dojo.query("li",b).removeClass("selected");dojo.query(a).addClass("selected")};aipo.wiki.filterClick=function(d,e,c){var a=e.parentNode;var b=a.parentNode;var f=a.getAttribute("data-param");aipo.wiki.filterSelect(b,a);aipo.wiki.filteredSearch(d)};aipo.wiki.onReceiveMessage=function(b){if(!b){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("wiki")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=b}};aipo.wiki.onListReceiveMessage=function(b){if(!b){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("wiki")}if(dojo.byId("listmessageDiv")){dojo.byId("listmessageDiv").innerHTML=b}};aipo.wiki.onViewReceiveMessage=function(b){if(!b){var a=dijit.byId("modalDialog");if(a){a.hide()}location.reload()}if(dojo.byId("viewmessageDiv")){dojo.byId("viewmessageDiv").innerHTML=b}};aipo.wiki.initFilterSearch=function(d){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;if(aipo.userAgent.isAndroid4_0()){var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left=a+"px";c.style.left=-a+"px";e.style.width=f-a+"px";b.style.width=f-a+"px";e.style.paddingLeft="2px"}else{if(a!=0){e.style.paddingLeft=a+"px"}}}};aipo.wiki.finFilterSearch=function(d){if(aipo.userAgent.isAndroid4_0()){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left="0px";c.style.left="0px";e.style.width=f+a+"px";b.style.width=f+a+"px";e.style.paddingLeft=a+2+"px"}}};aipo.wiki.filteredSearch=function(d){var b=dojo.byId("baseuri_"+d).value;var c=[];var f=[];dojo.query("ul.filtertype_"+d).forEach(function(h){var i=h.getAttribute("data-type");c.push(i);var g=dojo.query("li.selected",h)[0];if(g){var j=g.getAttribute("data-param");f.push(j)}else{f.push(h.getAttribute("data-defaultparam"))}});var e=dojo.byId("q"+d);var a=[["filter",f.join(",")],["filtertype",c.join(",")],["keyword",e?e.value:""]];aipo.viewPage(b,d,a)};aipo.wiki.formSwitchCategoryInput=function(a){if(a.form.is_new_category.value=="TRUE"||a.form.is_new_category.value=="true"){a.value=aimluck.io.escapeText("wiki_val_switch1");aipo.wiki.formCategoryInputOff(a.form)}else{a.value=aimluck.io.escapeText("wiki_val_switch2");aipo.wiki.formCategoryInputOn(a.form)}};aipo.wiki.formCategoryInputOn=function(a){dojo.byId("wikiCategorySelectField").style.display="none";dojo.byId("wikiCategoryInputField").style.display="";a.is_new_category.value="TRUE"};aipo.wiki.formCategoryInputOff=function(a){dojo.byId("wikiCategoryInputField").style.display="none";dojo.byId("wikiCategorySelectField").style.display="";a.is_new_category.value="FALSE"};aipo.wiki.onLoadCategoryDialog=function(a){var b=dojo.byId("category_name");if(b){b.focus()}};aipo.wiki.insertTag=function(k,q,p,o){var n=dojo.byId("wiki_note");var a,d,c,b,m,l;n.focus();if(typeof(document.selection)!="undefined"){c=document.selection.createRange().text}else{if(typeof(n.setSelectionRange)!="undefined"){a=n.selectionStart;d=n.selectionEnd;b=n.scrollTop;c=n.value.substring(a,d)}}if(c.match(/ $/)){c=c.substring(0,c.length-1);q=q+" "}l=(c)?c:"";if(c){if(o){var f=l.match(/([\r\n|\r|\n])/);if(f){var e=f[0];var j=l.split(/\r\n|\r|\n/);m="";for(var g=0;g<j.length;g++){m+=k+j[g]+q;if(g<j.length-1){m+=e}}}else{m=k+l+q}}else{m=k+l+q}}else{m=k+p+q}if(typeof(document.selection)!="undefined"){var h=document.selection.createRange();h.text=m;h.setEndPoint("EndToEnd",h)}else{if(typeof(n.setSelectionRange)!="undefined"){n.value=n.value.substring(0,a)+m+n.value.substring(d);if(c){n.setSelectionRange(a+m.length,a+m.length)}else{n.setSelectionRange(a+m.length,a+m.length)}n.scrollTop=b}}};aipo.wiki.encloseTag=function(f,k,j){var i=dojo.byId("wiki_note");var a,d,c,b,h,g;i.focus();if(typeof(document.selection)!="undefined"){c=document.selection.createRange().text}else{if(typeof(i.setSelectionRange)!="undefined"){a=i.selectionStart;d=i.selectionEnd;b=i.scrollTop;c=i.value.substring(a,d)}}if(c.match(/ $/)){c=c.substring(0,c.length-1);k=k+" "}g=(c)?c:"";if(c){h=f+"\n"+g+"\n"+k}else{h=f+"\n"+j+"\n"+k}if(typeof(document.selection)!="undefined"){var e=document.selection.createRange();e.text=h;e.setEndPoint("EndToEnd",e)}else{if(typeof(i.setSelectionRange)!="undefined"){i.value=i.value.substring(0,a)+h+i.value.substring(d);if(c){i.setSelectionRange(a+h.length,a+h.length)}else{i.setSelectionRange(a+h.length,a+h.length)}i.scrollTop=b}}};aipo.wiki.replaceTag=function(e){var b=dojo.byId("wiki_note");b.focus();var g,a,d,c,f;if(typeof(document.selection)!="undefined"){c=document.selection.createRange();d=c.text}else{if(typeof(b.setSelectionRange)!="undefined"){g=b.selectionStart;a=b.selectionEnd;f=b.scrollTop;d=b.value.substring(g,a)}}if(typeof(document.selection)!="undefined"){c.text=e;c.setEndPoint("EndToEnd",c)}else{b.value=b.value.substring(0,g)+e+b.value.substring(a);if(d){b.setSelectionRange(g+e.length,g+e.length)}else{b.setSelectionRange(g+e.length,g+e.length)}b.scrollTop=f}};aipo.wiki.bold=function(){var a="'''";var b="太文字文";aipo.wiki.insertTag(a,a,b,false)};aipo.wiki.italic=function(){var a="''";var b="斜体文";aipo.wiki.insertTag(a,a,b,false)};aipo.wiki.underline=function(){var a="%%";var b="下線";aipo.wiki.insertTag(a,a,b,false)};aipo.wiki.strikethrough=function(){var a="%%%";var b="取り消し線";aipo.wiki.insertTag(a,a,b,false)};aipo.wiki.header=function(){var a="=";var b="見出し１";aipo.wiki.insertTag(a,a,b,false)};aipo.wiki.headerTwo=function(){var a="==";var b="見出し２";aipo.wiki.insertTag(a,a,b,false)};aipo.wiki.headerThree=function(){var a="===";var b="見出し３";aipo.wiki.insertTag(a,a,b,false)};aipo.wiki.ulist=function(){var a="* ";var b="番号なし項目";aipo.wiki.insertTag(a,"",b,true)};aipo.wiki.olist=function(){var a="# ";var b="番号付き項目";aipo.wiki.insertTag(a,"",b,true)};aipo.wiki.externallink=function(){var a="[[";var b="]]";var c="wiki名";aipo.wiki.insertTag(a,b,c,false)};aipo.wiki.quote=function(){var a="引用文";aipo.wiki.encloseTag("{quote}","{quote}",a)};aipo.wiki.pre=function(){var a="整形済みテキスト";aipo.wiki.encloseTag("{code}","{code}",a)};aipo.wiki.hr=function(){var a="----";aipo.wiki.replaceTag(a)};aipo.wiki.table=function(){var a="{|\n|-\n! 見出しテキスト !! 見出しテキスト !! 見出しテキスト\n|-\n| セル内のテキスト || セル内のテキスト || セル内のテキスト\n|-\n| セル内のテキスト || セル内のテキスト || セル内のテキスト\n|-\n| セル内のテキスト || セル内のテキスト || セル内のテキスト\n|}";aipo.wiki.replaceTag(a)};aipo.wiki.image=function(){var a="画像ファイル名";aipo.wiki.insertTag("!","!",a,true)};aipo.wiki.showPreviewDialog=function(a){var d=dojo.byId("wikiPreview");d.style.display="block";var b=dojo.byId("wiki_note").value;var c={note:b};var e=false;aipo.asyncLoad(d,a,c,e)};