dojo.provide("aipo.accessctl");dojo.require("aipo.widget.MemberNormalSelectList");aipo.accessctl.onLoadAccessctlDialog=function(f){var h=dojo.byId("acl_role_name");if(h){h.focus()}var d=dijit.byId("membernormalselect");if(d){var a=dojo.byId("init_memberlist");var e;var c=a.options;if(c.length==1&&c[0].value==""){return}for(e=0;e<c.length;e++){d.addOptionSync(c[e].value,c[e].text,true)}}var b=dojo.byId("urlacls"+f).value;var g=dojo.byId("initfeature"+f).value;aipo.accessctl.changeAcls(f,b,g)};aipo.accessctl.onReceiveMessage=function(b){if(!b){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("accessctl")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=b}};aipo.accessctl.changeAcls=function(b,a,c){aipo.accessctl.createCheckbox(b,"acls","aclsDiv",a+"?featureid="+c,"aclId","aclName","checked")};aipo.accessctl.createCheckbox=function(e,a,g,b,c,f,d){dojo.xhrGet({url:b,timeout:5000,encoding:"utf-8",handleAs:"json-comment-filtered",headers:{X_REQUESTED_WITH:"XMLHttpRequest"},load:function(l,h){var k="";dojo.forEach(l,function(m){if(typeof m[c]=="undefined"||typeof m[f]=="undefined"){}else{if(m[d]=="true"){k+="<input name='"+m[c]+"' id='"+m[c]+"' type='checkbox' value='1' checked='checked'/><label for='"+m[c]+"'>&nbsp;"+m[f]+"</label>"}else{k+="<input name='"+m[c]+"' id='"+m[c]+"' type='checkbox' value='1'/><label for='"+m[c]+"'>&nbsp;"+m[f]+"</label>"}k+="&nbsp;"}});dojo.byId(g).innerHTML=k;aipo.accessctl.setupAcl(e,"acllist");aipo.accessctl.setupAcl(e,"acldetail");aipo.accessctl.setupAcl(e,"aclinsert");aipo.accessctl.setupAcl(e,"aclupdate");aipo.accessctl.setupAcl(e,"acldelete");aipo.accessctl.setupAcl(e,"aclexport")}})};aipo.accessctl.setupAcl=function(b,a){var c=dojo.byId("init"+a+b);if(c&&c.value=="checked"){dojo.byId(a).checked=true}};aipo.accessctl.submitList=function(a){submit_member(a.ac_users);submit_member(a.ac_admins);submit_member(a.ac_guests)};aipo.accessctl.changeACL=function(a,e,b){var l=a.elements[e].options;var h=a.elements[b].options;var c=0;for(c=0;c<l.length-1;c++){var m=l[c];if(!m.selected||!m.text){continue}var g=false;var k=h.length-1;for(j=0;j<k;j++){if(h[j].text==m.text){g=true;break}}if(g){continue}aipo.accessctl.addOption(h,m.text,m.value,k)}};aipo.accessctl.removeList=function(b,c){var a=b.elements[c].options;for(i=0;i<a.length-1;i++){if(a[i].selected){a[i]=null;i-=1}}};aipo.accessctl.addOption=function(b,e,c,f){var a=b.length;if(f<0){f=a}var d=new Option();b[a]=d;for(i=a;i>f;i--){b[i].text=b[i-1].text}b[f].text=e;b[f].value=c;b[f].selected=true};