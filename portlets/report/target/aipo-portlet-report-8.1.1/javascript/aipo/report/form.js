dojo.provide("aipo.report");dojo.require("aipo.widget.MemberNormalSelectList");dojo.require("dijit.form.ComboBox");dojo.require("aipo.widget.DropdownDatepicker");aipo.report.toggleMenu=function(f,e,d){var c=e.getBoundingClientRect();var b=document.documentElement.getBoundingClientRect();if(f.style.display=="none"){dojo.query("div.menubar").style("display","none");var a={left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};f.style.opacity="0";setTimeout(function(){dojo.style(f,"display","block")},0);if(b.right-f.clientWidth>c.left){f.style.left=c.left+a.left+"px"}else{f.style.left=c.right-f.clientWidth+a.left+"px"}if(b.bottom-f.clientHeight>c.bottom||d){f.style.top=c.bottom+a.top+"px"}else{f.style.top=c.top-f.clientHeight+a.top+"px"}f.style.opacity=""}else{dojo.query("div.menubar").style("display","none")}};aipo.report.initFilterSearch=function(d){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;if(aipo.userAgent.isAndroid4_0()){var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left=a+"px";c.style.left=-a+"px";e.style.width=f-a+"px";b.style.width=f-a+"px";e.style.paddingLeft="2px"}else{if(a!=0){e.style.paddingLeft=a+"px"}}}};aipo.report.finFilterSearch=function(d){if(aipo.userAgent.isAndroid4_0()){var e=dojo.byId("q"+d);var c=dojo.byId("filters_"+d);if(c&&e){var a=c.offsetWidth;var b=dojo.query("div.filterInputField")[0];var f=parseInt(dojo.getComputedStyle(e).width);b.style.left="0px";c.style.left="0px";e.style.width=f+a+"px";b.style.width=f+a+"px";e.style.paddingLeft=a+2+"px"}}};aipo.report.filteredSearch=function(d){var b=dojo.byId("baseuri_"+d).value;var c=[];var f=[];dojo.query("ul.filtertype_"+d).forEach(function(h){var j=h.getAttribute("data-type");c.push(j);var g=dojo.query("li.selected",h)[0];if(g){var k=g.getAttribute("data-param");f.push(k)}else{f.push(h.getAttribute("data-defaultparam"))}});var e=dojo.byId("q"+d);var a=[["filter",f.join(",")],["filtertype",c.join(",")],["keyword",e?e.value:""]];aipo.viewPage(b,d,a)};aipo.report.filterSetDefault=function(e,d){var c=dojo.query("ul.filtertype[data-type="+d+"]")[0];var b=c.getAttribute("data-defaultparam");var a=dojo.query("li[data-param="+b+"]",c);aipo.report.filterSelect(c,a);aipo.report.filteredSearch(e)};aipo.report.filterSelect=function(b,a){dojo.query("li",b).removeClass("selected");dojo.query(a).addClass("selected")};aipo.report.onLoadReportDetail=function(a){aipo.portletReload("report");aipo.portletReload("whatsnew")};aipo.report.filterClick=function(d,e,c){var a=e.parentNode;var b=a.parentNode;var f=a.getAttribute("data-param");aipo.report.filterSelect(b,a);aipo.report.filteredSearch(d)};aipo.report.onLoadReportDialog=function(f){var c=dijit.byId("membernormalselect");if(c){var a=dojo.byId("init_memberlist");var e;var b=a.options;if(b.length==1&&b[0].value==""){return}for(e=0;e<b.length;e++){c.addOptionSync(b[e].value,b[e].text,true)}}var c=dijit.byId("mapnormalselect");if(c){var a=dojo.byId("init_maplist");var e;var b=a.options;if(b.length==1&&b[0].value==""){return}for(e=0;e<b.length;e++){c.addOptionSync(b[e].value,b[e].text,true)}}var g=dojo.byId("button_member_add");if(g){dojo.connect(g,"onclick",function(){aipo.report.expandMember()})}var g=dojo.byId("button_map_add");if(g){dojo.connect(g,"onclick",function(){aipo.report.expandMap()})}var d=dojo.byId("button_member_remove");if(d){dojo.connect(d,"onclick",function(){var h=dojo.byId("members");if(h.options.length==0){if((c)&&(aipo.report.login_aliasname!="undefined")){var j=aipo.report.login_aliasname.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">");c.addOptionSync(aipo.report.login_name,j,true)}}aipo.report.expandMember()})}var d=dojo.byId("button_map_remove");if(d){dojo.connect(d,"onclick",function(){var h=dojo.byId("positions");if(h.options.length==0){if((c)&&(aipo.report.login_aliasname!="undefined")){var j=aipo.report.login_aliasname.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">");c.addOptionSync(aipo.report.login_name,j,true)}}aipo.report.expandMap()})}aipo.report.shrinkMember();aipo.report.expandMap()};aipo.report.onReceiveMessage=function(c){var a=dojo.byId("attachments_select");if(typeof a!="undefined"&&a!=null){a.parentNode.removeChild(a)}if(!c){var b=dijit.byId("modalDialog");if(b){b.hide()}aipo.portletReload("report");aipo.portletReload("whatsnew");aipo.portletReload("timeline")}if(dojo.byId("messageDiv")){dojo.byId("messageDiv").innerHTML=c}if(c!=""){aipo.report.setWrapperHeight()}};aipo.report.shrinkMember=function(){var c=dojo.byId("memberFieldButton");if(c){var e="";e+='<table class="w100"><tbody><tr><td style="width:80%; border:none;">';var a=dojo.byId("members");if(a){var f=a.options;to_size=f.length;for(i=0;i<to_size;i++){var d=f[i].text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e+="<span>"+d+"</span>";if(i<to_size-1){e+=",<wbr/>"}}}e+='</td><td style="border:none;">';e+='<input type="button" class="alignright" value="'+aimluck.io.escapeText("report_val_member1")+'" onclick="aipo.report.expandMember();" />';e+="</td></tr></tbody></table>";c.innerHTML=e}var b=dojo.byId("memberField");if(b){dojo.style(b,"display","none")}aipo.report.setWrapperHeight()};aipo.report.shrinkMap=function(){var c=dojo.byId("mapFieldButton");if(c){var e="";e+='<table class="w100"><tbody><tr><td style="width:80%; border:none;">';var a=dojo.byId("positions");if(a){var f=a.options;to_size=f.length;for(i=0;i<to_size;i++){var d=f[i].text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e+="<span>"+d+"</span>";if(i<to_size-1){e+=",<wbr/>"}}}e+='</td><td style="border:none;">';e+='<input type="button" class="alignright" value="'+aimluck.io.escapeText("report_val_member2")+'" onclick="aipo.report.expandMap();" />';e+="</td></tr></tbody></table>";c.innerHTML=e}var b=dojo.byId("mapField");if(b){dojo.style(b,"display","none")}aipo.report.setWrapperHeight()};aipo.report.expandMember=function(){var c=dojo.byId("memberFieldButton");if(c){var e="";e+='<table class="w100"><tbody><tr><td style="width:80%; border:none">';var a=dojo.byId("members");if(a){var f=a.options;to_size=f.length;for(i=0;i<to_size;i++){var d=f[i].text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e+="<span>"+d+"</span>";if(i<to_size-1){e+=",<wbr/>"}}}e+='</td><td style="border:none;">';e+='<input type="button" class="alignright" value="'+aimluck.io.escapeText("report_val_member3")+'" onclick="aipo.report.shrinkMember();" />';e+="</td></tr></tbody></table>";c.innerHTML=e}var b=dojo.byId("memberField");if(b){dojo.style(b,"display","block")}aipo.report.setWrapperHeight()};aipo.report.expandMap=function(){var c=dojo.byId("mapFieldButton");if(c){var e="";e+='<table class="w100"><tbody><tr><td style="width:80%; border:none">';var a=dojo.byId("positions");if(a){var f=a.options;to_size=f.length;for(i=0;i<to_size;i++){var d=f[i].text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e+="<span>"+d+"</span>";if(i<to_size-1){e+=",<wbr/>"}}}e+='</td><td style="border:none;">';e+="</td></tr></tbody></table>";c.innerHTML=e}var b=dojo.byId("mapField");if(b){dojo.style(b,"display","block")}aipo.report.setWrapperHeight()};aipo.report.formatNum=function(a){var c=new String(a);var b=2-c.length;if(b<=0){return c}while(b-->0){c="0"+c}return c};aipo.report.delaySelectAllOptions=function(b,a){return function(c){aimluck.io.selectAllOptions(c.attachments)}};aipo.report.setWrapperHeight=function(){var a=document.getElementById("modalDialog");if(a){var b=document.getElementById("wrapper");b.style.minHeight=a.clientHeight+"px"}};aipo.report.hideDialog=function(){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("report")};