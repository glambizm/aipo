dojo.require("aipo.widget.MemberNormalSelectList");dojo.provide("aipo.timeline");aipo.timeline.addHiddenValue=function(b,a,d){if(b[a]&&document.getElementsByName(a).item(0)){b[a].value=d}else{var c=document.createElement("input");c.type="hidden";c.name=a;c.value=d;b.appendChild(c)}};aipo.timeline.addLike=function(b,a,c){};aipo.timeline.showCommentField=function(a,c){dojo.byId("comments_"+a+"_"+c).style.display="block";dojo.query("#comments_"+a+"_"+c).removeClass("mb0");dojo.byId("commentField_"+a+"_"+c).style.display="";dojo.byId("note_"+a+"_"+c).focus();dojo.byId("note_"+a+"_"+c).style.color="black";var b=dojo.byId("commentInputDummy_"+a+"_"+c);if(typeof b!="undefined"&&b!=null){dojo.byId("commentInputDummy_"+a+"_"+c).style.display="none"}};aipo.timeline.showCommentAll=function(a,b){dojo.byId("commentCaption_"+a+"_"+b).style.display="none";dojo.query("#comments_"+a+"_"+b+" .message").forEach(function(c){c.style.display=""})};aipo.timeline.onClick=function(c,b,d,a){try{dojo.xhrPost({portletId:b,url:c,encoding:"utf-8",handleAs:"text",headers:{X_REQUESTED_WITH:"XMLHttpRequest"},load:function(g,e){dojo.byId("content_"+b+"_"+d).removeChild(dojo.byId("content_"+b+"_"+d).children[0]);dojo.byId("content_"+b+"_"+d).removeChild(dojo.byId("content_"+b+"_"+d).children[0]);dojo.byId("content_"+b+"_"+d).removeChild(dojo.byId("content_"+b+"_"+d).children[0]);d++;dojo.byId("content_"+b+"_"+d).innerHTML=g;if(d==a){dojo.byId("more_"+b).style.display="none"}var h=dojo.byId("indicator-dlg2-"+b);if(h){dojo.style(h,"display","none")}}})}catch(f){alert(f)}};aipo.timeline.onScroll=function(d,c,f,a){var g=dojo.byId("timeline_"+c).scrollTop;var b=dojo.byId("timeline_"+c).clientHeight;var e=dojo.byId("timeline_"+c).scrollHeight;var h=e-b-g;if(dojo.byId("height_"+c)==0||h<5){aipo.timeline.onClick(d,c,f,a)}};aipo.timeline.nextThumbnail=function(b){var e=dojo.byId("TimelinePage_"+b);var d=parseInt(e.value);var a=dojo.byId("TimelinePage_"+b+"_imagesMaxCount").value;var c=parseInt(a);if(d<c){dojo.byId("tlClipImage_"+b+"_1").style.display="none";dojo.byId("tlClipImage_"+b+"_"+e.value).style.display="none";d++;e.value=d;dojo.byId("tlClipImage_"+b+"_"+e.value).style.display="";dojo.byId("count_"+b).innerHTML=c+" 件中 "+e.value+" 件"}};aipo.timeline.prevThumbnail=function(b){var e=dojo.byId("TimelinePage_"+b);var d=parseInt(e.value);var a=dojo.byId("TimelinePage_"+b+"_imagesMaxCount").value;var c=parseInt(a);if(d>1){dojo.byId("tlClipImage_"+b+"_1").style.display="none";dojo.byId("tlClipImage_"+b+"_"+e.value).style.display="none";d--;e.value=d;dojo.byId("tlClipImage_"+b+"_"+e.value).style.display="";dojo.byId("count_"+b).innerHTML=c+" 件中 "+e.value+" 件"}};if(!aipo.timeline.revmaxlist){aipo.timeline.revmaxlist=[]}aipo.timeline.refreshImageList=function(k,g){function d(h){var u=dojo.byId("TimelinePage_"+h);var t=parseInt(u.value);if(aipo.timeline.revmaxlist[h]>0){if(dojo.hasClass(dojo.byId("auiSummaryMeta_"+h),"hide")){document.getElementById("tlClipImage_"+h+"_1").style.display="";dojo.removeClass(dojo.byId("auiSummaryMeta_"+h),"hide");dojo.removeClass(dojo.byId("ViewThumbnail_"+h),"hide")}if(!t){t=1}dojo.byId("count_"+h).innerHTML=aipo.timeline.revmaxlist[h]+" 件中 "+t+" 件";dojo.byId("TimelinePage_"+h+"_imagesMaxCount").value=aipo.timeline.revmaxlist[h]}}var m=dojo.byId("TimelinePage_"+k);var q=parseInt(m.value);var o=dojo.byId("TimelinePage_"+k+"_imagesMaxCount").value;var r=parseInt(o);var a=0;var p=dojo.byId("tlClipImage_"+k+"_"+g+"_img").naturalWidth;var j=dojo.byId("tlClipImage_"+k+"_"+g+"_img").naturalHeight;if(dojo.isIE){var f=new Image();f.src=dojo.byId("tlClipImage_"+k+"_"+g+"_img").src;var l=f.width;var b=f.height;if((l>80)&&(b>80)){if(aipo.timeline.revmaxlist.hasOwnProperty(k)){a=aipo.timeline.revmaxlist[k]}if(a==0&&document.getElementById("tlClipImage_"+k+"_1")!=null){a=1}else{a++}aipo.timeline.revmaxlist[k]=a;var c=dojo.byId("tlClipImage_"+k+"_1_untiview");var n=document.createElement("div");n.id="tlClipImage_"+k+"_"+a;n.className="tlClipImage";n.style.display="none";var s=document.createElement("img");s.src=dojo.byId("tlClipImage_"+k+"_"+g+"_img").src;s.name=dojo.byId("tlClipImage_"+k+"_"+g+"_img").name;n.appendChild(s);c.parentNode.insertBefore(n,c);var e=200;setTimeout(function(){d(k)},e)}}else{if((p>80)&&(j>80)){if(aipo.timeline.revmaxlist.hasOwnProperty(k)){a=aipo.timeline.revmaxlist[k]}if(a==0&&document.getElementById("tlClipImage_"+k+"_1")!=null){a=1}else{a++}aipo.timeline.revmaxlist[k]=a;var c=dojo.byId("tlClipImage_"+k+"_1_untiview");var n=document.createElement("div");n.id="tlClipImage_"+k+"_"+a;n.className="tlClipImage";n.style.display="none";var s=document.createElement("img");s.src=dojo.byId("tlClipImage_"+k+"_"+g+"_img").src;s.name=dojo.byId("tlClipImage_"+k+"_"+g+"_img").name;n.appendChild(s);c.parentNode.insertBefore(n,c);var e=0;setTimeout(function(){d(k)},e)}}};aipo.timeline.getUrl=function(b,a){try{dojo.xhrPost({portletId:a,url:dojo.byId("TimelineUrl_"+a).value,content:{url:b},encoding:"utf-8",handleAs:"text",headers:{X_REQUESTED_WITH:"XMLHttpRequest"},load:function(e,d){if(e!="error"){dojo.byId("tlInputClip_"+a).innerHTML=e;dojo.byId("flag_"+a).value="exist"}else{dojo.byId("flag_"+a).value="forbidden"}}})}catch(c){alert(c)}};aipo.timeline.setScrollTop=function(a,b){dojo.byId("timeline_"+a).scrollTop=b};aipo.timeline.onKeyUp=function(k,g,l){var c;if((typeof g!=="undefined")&&(g!=null)){c="note_"+k+"_"+g}else{c="note_"+k;var m;if(window.event){m=window.event.keyCode}else{if(l){m=l.which}}if((m==13)|(m==32)){var h=dojo.byId(c).value;if(dojo.byId("flag_"+k).value=="none"){var p=h.split(/\r\n|\n/g);for(i in p){if(p[i].match(/^https?:\/\/[^ 	]/i)){var d=p[i].replace(/　/g," ").split(" ");if(dojo.byId("flag_"+k).value=="none"){dojo.byId("flag_"+k).value="processing";aipo.timeline.getUrl(d[0],k);aipo.timeline.revmaxlist[k]=0}}}}}}function b(s,r){var q="";var e=0;while(e<r){q=q+s;e++}return q}var f=dojo.byId(c).value;var a=f.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(e){return b("&nbsp;",e.length)+" "});var n=document.createElement("div");n.id="shadow";n.style.position="absolute";n.style.top="-1000";n.style.left="-1000";n.style.border="0";n.style.outline="0";n.style.fontSize="14px";n.style.lineHeight="1.38";n.style.height="auto";n.style.resize="none";n.cols="10";n.innerHTML=a+"あ";var o=document.getElementsByTagName("body").item(0);o.appendChild(n);dojo.byId("shadow").style.width=document.getElementById(c).offsetWidth+"px";var j=document.getElementById("shadow").offsetHeight;if(j<20){j=20}dojo.byId(c).style.height=j*1+23+"px";o.removeChild(n)};aipo.timeline.onPaste=function(a,c,b){setTimeout(function(){aipo.timeline.onKeyUp(a,c,b)},100)};aipo.timeline.onkeydown=function(b){if(dojo.isSafari){var a=window.event.keyCode;if(a==dojo.keys.TAB){var c=dojo.byId("al_submit_"+b);dojo.stopEvent(window.event);c.focus()}}};aipo.timeline.lock=false;aipo.timeline.onReceiveMessage=function(c){var a=dojo.byId("getTimelinePortletId").innerHTML;if(!c){var b=dijit.byId("modalDialog_"+a);if(b){b.hide()}if(!aipo.timeline.lock){aipo.timeline.lock=true;aipo.portletReload("timeline");aipo.timeline.lock=false}}else{dojo.byId("getTimelineOnClick").innerHTML=""}if(dojo.byId("messageDiv_"+a)){dojo.byId("messageDiv_"+a).innerHTML=c}};aipo.timeline.onReceiveMessageToList=function(c){var a=dojo.byId("getTimelinePortletId").innerHTML;if(!c){var b=dijit.byId("modalDialog_"+a);if(b){b.hide()}aipo.portletReload("timeline")}else{dojo.byId("getTimelineOnClick").innerHTML=""}if(dojo.byId("messageDivList_"+a)){dojo.byId("messageDivList_"+a).innerHTML=c}};aipo.timeline.onReceiveLikeMessage=function(h,k,g,n){var b=dojo.byId("getTimelinePortletId");if(b==undefined){f=h}else{var f=b.innerHTML}var m=dijit.byId("modalDialog_"+f);if(m){m.hide()}var c=dojo.byId("likeForm_"+h+"_"+k);var j=dojo.query("#likeForm_"+h+"_"+k+" > a")[0];var d=dojo.query("#likeForm_"+h+"_"+k+" > input")[1];if(g=="like"){c.onsubmit=function(a){aimluck.io.submit(c,"",h,aipo.timeline.onReceiveLikeMessage(h,k,"dislike",n))};var l=j.getAttribute("onclick");if(typeof l=="string"){l=l.replace("'like'","'dislike'");j.setAttribute("onclick",l)}else{var e=l.toString().replace("'like'","'dislike'");e=e.substring(e.indexOf("{")+1,e.lastIndexOf("}")-1);j.setAttribute("onclick",new Function(e))}j.innerHTML="いいね！を取り消す";if(n){aipo.timeline.increaseComLikeValue(h,k)}else{aipo.timeline.increaseLikeValue(h,k)}}else{if(g=="dislike"){c.onsubmit=function(a){aimluck.io.submit(c,"",h,aipo.timeline.onReceiveLikeMessage(h,k,"like",n))};var l=j.getAttribute("onclick");if(typeof l=="string"){l=l.replace("'dislike'","'like'");j.setAttribute("onclick",l)}else{var e=l.toString().replace("'dislike'","'like'");e=e.substring(e.indexOf("{")+1,e.lastIndexOf("}")-1);j.setAttribute("onclick",new Function(e))}j.innerHTML="いいね！";if(n){aipo.timeline.decreaseComLikeValue(h,k)}else{aipo.timeline.decreaseLikeValue(h,k)}}}};aipo.timeline.increaseLikeValue=function(f,e){var g=dojo.query("#like_"+f+"_"+e)[0];var b=dojo.query("#like_"+f+"_"+e+" > a")[0];if(dojo.isFF>0){var d=b.textContent}else{var d=b.innerText}var c=parseInt(d.substring(0,d.length-1))+1;if(g.style.display=="none"){if(g.parentElement.nextElementSibling==null){g.parentElement.className="comments"}else{if(g.parentElement.nextElementSibling.tagName=="P"){g.parentElement.className="comments"}}g.style.display=""}if(dojo.isFF>0){b.textContent=c+d.charAt(d.length-1)}else{b.innerText=c+d.charAt(d.length-1)}};aipo.timeline.increaseComLikeValue=function(f,e){var b=dojo.query("#likeCount_"+f+"_"+e)[0];if(dojo.isFF>0){var d=b.textContent}else{var d=b.innerText}var c=parseInt(d)+1;if(b.style.display=="none"){b.style.display="";c=1}if(dojo.isFF>0){b.innerHTML=b.innerHTML.replace(b.textContent,c)}else{b.innerHTML=b.innerHTML.replace(b.innerText,c)}};aipo.timeline.decreaseLikeValue=function(f,e){var b=dojo.query("#like_"+f+"_"+e+" > a")[0];if(dojo.isFF>0){var d=b.textContent}else{var d=b.innerText}var c=parseInt(d.substring(0,d.length-1))-1;if(c<=0){b.parentElement.style.display="none"}if(dojo.isFF>0){b.textContent=c+d.charAt(d.length-1)}else{b.innerText=c+d.charAt(d.length-1)}};aipo.timeline.decreaseComLikeValue=function(f,e){var b=dojo.query("#likeCount_"+f+"_"+e)[0];if(dojo.isFF>0){var d=b.textContent}else{var d=b.innerText}var c=parseInt(d)-1;if(c<=0){b.style.display="none"}if(dojo.isFF>0){b.innerHTML=b.innerHTML.replace(b.textContent,c)}else{b.innerHTML=b.innerHTML.replace(b.innerText,c)}};aipo.timeline.onListReceiveMessage=function(b){if(!b){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("timeline")}if(dojo.byId("listmessageDiv")){dojo.byId("listmessageDiv").innerHTML=b}};aipo.timeline.hideDialog=function(){var a=dijit.byId("modalDialog");if(a){a.hide()}aipo.portletReload("timeline")};aipo.timeline.ellipse_message=function(c){var b=c.parentElement;var a=b.parentElement;dojo.query(b).addClass("opened");dojo.query(".text_exposed_show",a).removeClass("ellipsis")};aipo.timeline.onFocus=function(a){dojo.byId("guide_"+a).style.display="none"};aipo.timeline.onBlur=function(a){var b=dojo.byId("note_"+a);if(b.value==""){dojo.byId("guide_"+a).style.display=""}};aipo.timeline.onBlurCommentField=function(a,e){var b=dojo.byId("note_"+a+"_"+e);var d=dojo.byId("commentInputDummy_"+a+"_"+e);var c=dojo.byId("commentField_"+a+"_"+e);if(b.value==""){b.value=dojo.byId("note_"+a+"_"+e).defaultValue;d.style.display="";c.style.display="none"}};aipo.timeline.addText=function(b,a){if(dojo.byId("tlInputClip_"+a).innerHTML.length>1){var c=dojo.byId("TimelinePage_"+a);if(dojo.byId("tlClipImage_"+a+"_"+c.value)!=null&&dojo.byId("tlClipImage_"+a+"_"+c.value).style.display!="none"){aipo.timeline.addHiddenValue(b,"tlClipImage",dojo.byId("tlClipImage_"+a+"_"+c.value).children[0].name)}if(dojo.byId("tlClipUrl_"+a).children[0].innerHTML){aipo.timeline.addHiddenValue(b,"tlClipUrl",dojo.byId("tlClipUrl_"+a).children[0].getAttribute("href"))}}};aipo.timeline.viewThumbnail=function(a){var c=dojo.byId("TimelinePage_"+a);var b=parseInt(c.value);if(dojo.byId("checkbox_"+a).checked){dojo.byId("tlClipImage_"+a+"_"+c.value).style.display="none";dojo.addClass(dojo.byId("auiSummaryMeta_"+a),"hide")}else{dojo.byId("tlClipImage_"+a+"_"+c.value).style.display="";dojo.removeClass(dojo.byId("auiSummaryMeta_"+a),"hide")}};aipo.timeline.deleteClip=function(a){dojo.byId("tlInputClip_"+a).innerHTML="";dojo.byId("flag_"+a).value="forbidden"};aipo.timeline.submit=function(e,d,a,f,b){var c=dojo.byId("note_"+a);if(dojo.byId(d+a).style.display=="none"||b>=8){aimluck.io.createSelectFromFileList(e,a);if(c.value!=c.defaultValue){aimluck.io.submit(e,d,a,f)}}else{setTimeout(function(){aipo.timeline.submit(e,d,a,f,b+1)},Math.pow(2,b)*1000)}};aipo.timeline.write=function(c,b,a){aipo.timeline.addText(dojo.byId("form"+a),a);aipo.timeline.addHiddenValue(dojo.byId("form"+a),"mode","insert");aimluck.io.setHiddenValue(c);dojo.byId("getTimelineOnClick").innerHTML="true"};aipo.timeline.setMinHeight=function(a){var b=0;if(document.all){b+=(document.documentElement.clientHeight-dojo.byId("message_"+a).getBoundingClientRect().top)}else{b+=(innerHeight-dojo.byId("message_"+a).getBoundingClientRect().top)}dojo.byId("message_"+a).style.minHeight=b+"px"};aipo.timeline.changeDisplayCallback=function(a){if(dojo.byId("menubar_tlDisplayChanger_"+a).style.display=="none"){dojo.byId("menubar_tlDisplayChanger_"+a).style.display="block"}else{dojo.byId("menubar_tlDisplayChanger_"+a).style.display="none"}};aipo.timeline.changeDisplay=function(a){if(dojo.byId("menubar_tlDisplayChanger_"+a).style.display=="none"){setTimeout(function(){aipo.timeline.changeDisplayCallback(a)},0)}else{aipo.timeline.changeDisplayCallback(a)}};aipo.timeline.getNewMessage=function(b,a){var c=dojo.byId("newMessage_"+a);if(c){dojo.style(c,"display","none")}try{dojo.xhrPost({portletId:a,url:b,content:{lastTimelineId:dojo.byId("last_timelineId_"+a).value},encoding:"utf-8",handleAs:"text",headers:{X_REQUESTED_WITH:"XMLHttpRequest"},load:function(g,f){dojo.query(".message.first").removeClass("first");if(g.length>0){var h=dojo.byId("timeline_"+a);var e=document.createElement("div");e.innerHTML=g;h.insertBefore(e,h.childNodes[1])}}})}catch(d){alert(d)}};aipo.timeline.displayIndicator=function(a,d,c,b){dojo.byId("tlDisplayGroup_"+d).innerHTML=dojo.byId("PostName_"+d+"_"+b).innerHTML;var e=dojo.byId(c+d);if(e){dojo.style(e,"display","")}aipo.viewPage(a,d);e=dojo.byId(c+d)};aipo.timeline.displayIndicatorNotViewPage=function(b,a){var c=dojo.byId(a+b);if(c){dojo.style(c,"display","")}c=dojo.byId(a+b)};aipo.timeline.resizeThumbnailTag=function(c){function b(e){var d=new Image();d.src=e;return d}var a=b(c.src);if(a.width>0&&a.width<86){dojo.style(c,"width",a.width+"px");dojo.style(c,"padding","0 "+(86-a.width)/2+"px")}dojo.style(c,"visibility","visible")};aipo.timeline.inactiveFileAttachments=function(a){var b=dojo.byId("attachments_"+a);if(b){b.id="attachments_"+a+"-dialog"}b=dojo.byId("folderName_"+a);if(b){b.id="folderName_"+a+"-dialog"}};aipo.timeline.activeFileAttachments=function(a){var b=dojo.byId("attachments_"+a+"-dialog");if(b){b.id="attachments_"+a}b=dojo.byId("folderName_"+a+"-dialog");if(b){b.id="folderName_"+a}};aipo.timeline.onFocusSearch=function(a){var b=dojo.byId("timelineSearchForm_"+a);if(b){dojo.addClass(b,"focus")}};aipo.timeline.onBlurSearch=function(a){var b=dojo.byId("timelineSearchForm_"+a);if(b){if(!b.keyword.value){dojo.removeClass(b,"focus")}}};